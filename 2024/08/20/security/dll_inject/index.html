<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>DLL注入 | I0gan's blog</title><script src="//unpkg.com/valine/dist/Valine.min.js"></script><script>var config = {"root":"/","path":"search.json"}</script><script src="//unpkg.com/mermaid@8.13.5/dist/mermaid.min.js"></script><script>mermaid.initialize({
 startOnLoad: true
 , theme: 'dark'
});</script><link rel="stylesheet" href="/css/arknights.css"><link rel="stylesheet" href="//unpkg.com/@highlightjs/cdn-assets@11.4.0/styles/atom-one-dark-reasonable.min.css"><style>@font-face {
 font-family: BenderLight;
 src: local('Bender'), url("/font/BenderLight.ttf");
}
@font-face {
 font-family: 'JetBrains Mono';
 src: local('JetBrains Mono'), url('/font/JetBrainsMono-Regular.woff2') format('woff2');
}</style><meta name="generator" content="Hexo 6.3.0"></head><body style="background-image:url(/img/bg.jpg);"><main><header class="closed"><nav><div class="navBtn"><i class="navBtnIcon"><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span></i></div><ol class="navContent"><li class="navItem" id="search-header"><span class="navItemTitle"><input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="Search" spellcheck="false" maxlength="50" type="text" id="search-input"></span></li><li class="navItem"><a class="navBlock" href="/"><span class="navItemTitle">Home</span></a></li><li class="navItem"><a class="navBlock" href="/about/"><span class="navItemTitle">About</span></a></li><li class="navItem" matchdata="categories,tags"><a class="navBlock" href="/archives/"><span class="navItemTitle">Archives</span></a></li><li class="navItem"><a class="navBlock" href="/shell/"><span class="navItemTitle">Shell</span></a></li></ol></nav><div class="search-popup"><div id="search-result"></div></div></header><article><div id="post-bg"><div id="post-title"><h1>DLL注入</h1><div id="post-info"><span>First Post: <div class="control"><time datetime="2024-08-20T08:28:21.000Z" id="date"> 2024-08-20</time></div></span><br><span>Last Update: <div class="control"><time datetime="2024-10-07T08:17:07.913Z" id="updated"> 2024-10-07</time></div></span><br><span>Word Count: <div class="control">2.8k</div></span><br><span>Read Time: <div class="control">12 min</div></span></div></div><hr><div id="post-content"><h1 id="DLL注入"><a href="#DLL注入" class="headerlink" title="DLL注入"></a>DLL注入</h1><h2 id="远程线程注入"><a href="#远程线程注入" class="headerlink" title="远程线程注入"></a>远程线程注入</h2><p>参考：</p>
<p><a target="_blank" rel="noopener" href="https://bbs.kanxue.com/thread-282885.htm">https://bbs.kanxue.com/thread-282885.htm</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/Cody_Ren/article/details/100053434">https://blog.csdn.net/Cody_Ren/article/details/100053434</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/y281252548/article/details/120265888">https://blog.csdn.net/y281252548/article/details/120265888</a></p>
<h3 id="注入代码"><a href="#注入代码" class="headerlink" title="注入代码"></a>注入代码</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">//main.cpp</span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;windows.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;tlhelp32.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;vector&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;map&gt;</span></span><br><span class="hljs-type">char</span> dllPath[] = <span class="hljs-string">R&quot;(C:\Users\15386\Desktop\temp\hookDll.dll)&quot;</span>;<br><span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;DWORD64&gt;ve;<br><span class="hljs-built_in">std</span>::<span class="hljs-built_in">map</span>&lt;DWORD64, <span class="hljs-type">bool</span>&gt;mp;<br>BYTE jmpBytes[] = &#123;<br><span class="hljs-number">0xE9</span>, <span class="hljs-number">0xE0</span>, <span class="hljs-number">0x26</span>, <span class="hljs-number">0x16</span>, <span class="hljs-number">0x00</span><br>&#125;;<br>BYTE originBytes[] = &#123;<br><span class="hljs-number">0x4C</span>, <span class="hljs-number">0x8B</span>, <span class="hljs-number">0xD1</span>, <span class="hljs-number">0xB8</span>, <span class="hljs-number">0x50</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0xF6</span>, <span class="hljs-number">0x04</span>, <span class="hljs-number">0x25</span>, <span class="hljs-number">0x08</span>, <span class="hljs-number">0x03</span>, <span class="hljs-number">0xFE</span>, <span class="hljs-number">0x7F</span>, <span class="hljs-number">0x01</span>,<br> <span class="hljs-number">0x75</span>, <span class="hljs-number">0x03</span>, <span class="hljs-number">0x0F</span>, <span class="hljs-number">0x05</span>, <span class="hljs-number">0xC3</span>, <span class="hljs-number">0xCD</span>, <span class="hljs-number">0x2E</span>, <span class="hljs-number">0xC3</span><br>&#125;;<br><span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;DWORD64&gt; <span class="hljs-title function_">GetPidByProcName</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span>* processName)</span> &#123;<br>    HANDLE hProcessSnap = INVALID_HANDLE_VALUE;<br>    PROCESSENTRY32 pe32 = &#123; <span class="hljs-number">0</span> &#125;;<br> <br>    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;DWORD64&gt; vec;<br>    vec.clear();<br>    hProcessSnap = CreateToolhelp32Snapshot(TH32CS_SNAPPROCESS, <span class="hljs-number">0</span>);<br>    <span class="hljs-keyword">if</span> (hProcessSnap == INVALID_HANDLE_VALUE) &#123;<br>        vec;<br>    &#125;<br> <br>    pe32.dwSize = <span class="hljs-keyword">sizeof</span>(PROCESSENTRY32);<br> <br>    <span class="hljs-keyword">if</span> (Process32First(hProcessSnap, &amp;pe32)) &#123;<br>        <span class="hljs-keyword">do</span> &#123;<br>            <span class="hljs-keyword">if</span> (<span class="hljs-built_in">strcmp</span>(pe32.szExeFile, processName) == <span class="hljs-number">0</span>) &#123;<br>                vec.push_back(pe32.th32ProcessID);<br>            &#125;<br>        &#125; <span class="hljs-keyword">while</span> (Process32Next(hProcessSnap, &amp;pe32));<br>    &#125;<br>    CloseHandle(hProcessSnap);<br>    <span class="hljs-keyword">return</span> vec;<br>&#125;<br> <br>DWORD64 <span class="hljs-title function_">GetModuleBase</span><span class="hljs-params">(DWORD64 pid,<span class="hljs-type">const</span> <span class="hljs-type">char</span>* ModuleName)</span><br>&#123;<br>    HANDLE hModuleSnap = CreateToolhelp32Snapshot(TH32CS_SNAPMODULE, pid);<br>    <span class="hljs-keyword">if</span> (hModuleSnap != INVALID_HANDLE_VALUE) &#123;<br>        MODULEENTRY32 me32;<br>        me32.dwSize = <span class="hljs-keyword">sizeof</span>(MODULEENTRY32);<br>        <span class="hljs-keyword">if</span> (Module32First(hModuleSnap, &amp;me32)) &#123;<br>            <span class="hljs-keyword">do</span> &#123;<br>                <span class="hljs-keyword">if</span> (_stricmp(me32.szModule, ModuleName) == <span class="hljs-number">0</span>) &#123;<br>                    <span class="hljs-keyword">return</span> (DWORD64)me32.modBaseAddr;<br>                &#125;<br>            &#125; <span class="hljs-keyword">while</span> (Module32Next(hModuleSnap, &amp;me32));<br>        &#125;<br>        CloseHandle(hModuleSnap);<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br> <br>BOOL <span class="hljs-title function_">InjectDll</span><span class="hljs-params">(HANDLE hProcess, LPCSTR dllPath)</span> &#123;<br> <br>    LPVOID pRemoteDllPath = VirtualAllocEx(hProcess, <span class="hljs-literal">NULL</span>, <span class="hljs-built_in">strlen</span>(dllPath) + <span class="hljs-number">1</span>, MEM_COMMIT, PAGE_READWRITE);<br>    <span class="hljs-keyword">if</span> (pRemoteDllPath == <span class="hljs-literal">NULL</span>) &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;VirtualAllocEx Failed:[%d]\n&quot;</span>, GetLastError());<br>        <span class="hljs-keyword">return</span> FALSE;<br>    &#125;<br> <br>    <span class="hljs-keyword">if</span> (!WriteProcessMemory(hProcess, pRemoteDllPath, dllPath, <span class="hljs-built_in">strlen</span>(dllPath) + <span class="hljs-number">1</span>, <span class="hljs-literal">NULL</span>)) &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;WriteProcessMemory Failed:[%d]\n&quot;</span>, GetLastError());<br>        VirtualFreeEx(hProcess, pRemoteDllPath, <span class="hljs-number">0</span>, MEM_RELEASE);<br>        <span class="hljs-keyword">return</span> FALSE;<br>    &#125;<br> <br>    LPTHREAD_START_ROUTINE lpLoadLibrary = (LPTHREAD_START_ROUTINE)GetProcAddress(GetModuleHandleA(<span class="hljs-string">&quot;kernel32.dll&quot;</span>), <span class="hljs-string">&quot;LoadLibraryA&quot;</span>);<br>    <span class="hljs-keyword">if</span> (lpLoadLibrary == <span class="hljs-literal">NULL</span>) &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;GetProcAddress Failed:[%d]\n&quot;</span>, GetLastError());<br>        VirtualFreeEx(hProcess, pRemoteDllPath, <span class="hljs-number">0</span>, MEM_RELEASE);<br>        <span class="hljs-keyword">return</span> FALSE;<br>    &#125;<br> <br>    HANDLE hThread = CreateRemoteThread(hProcess, <span class="hljs-literal">NULL</span>, <span class="hljs-number">0</span>, lpLoadLibrary, pRemoteDllPath, <span class="hljs-number">0</span>, <span class="hljs-literal">NULL</span>);<br>    <span class="hljs-keyword">if</span> (hThread == <span class="hljs-literal">NULL</span>) &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;CreateRemoteThread Failed:[%d]\n&quot;</span>, GetLastError());<br>        VirtualFreeEx(hProcess, pRemoteDllPath, <span class="hljs-number">0</span>, MEM_RELEASE);<br>        <span class="hljs-keyword">return</span> FALSE;<br>    &#125;<br> <br>    WaitForSingleObject(hThread, INFINITE);<br> <br>    DWORD dwExitCode;<br>    <span class="hljs-keyword">if</span> (GetExitCodeThread(hThread, &amp;dwExitCode) &amp;&amp; dwExitCode == <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;LoadLibraryA Failed in remote process\n&quot;</span>);<br>        CloseHandle(hThread);<br>        VirtualFreeEx(hProcess, pRemoteDllPath, <span class="hljs-number">0</span>, MEM_RELEASE);<br>        <span class="hljs-keyword">return</span> FALSE;<br>    &#125;<br> <br>    CloseHandle(hThread);<br>    VirtualFreeEx(hProcess, pRemoteDllPath, <span class="hljs-number">0</span>, MEM_RELEASE);<br> <br>    <span class="hljs-keyword">return</span> TRUE;<br>&#125;<br> <br>BOOL <span class="hljs-title function_">RemoveHook</span><span class="hljs-params">(HANDLE hProcess,PVOID unHookAddr, BYTE* originBytes)</span><br>&#123;<br>   PDWORD oldProtect = <span class="hljs-number">0</span>;<br>   <span class="hljs-keyword">if</span> (!WriteProcessMemory(hProcess, (PVOID)unHookAddr, originBytes, <span class="hljs-keyword">sizeof</span>(originBytes), <span class="hljs-number">0</span>))<br>   &#123;<br>       <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;RemoveHook Failed!!!: [%d]\n&quot;</span>, GetLastError());<br>       <span class="hljs-keyword">return</span> FALSE;<br>   &#125;<br>&#125;<br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>)<br>    &#123;<br>        <span class="hljs-type">int</span> Num = <span class="hljs-number">0</span>;<br>        ve  = GetPidByProcName(<span class="hljs-string">&quot;WorkingService.exe&quot;</span>);<span class="hljs-comment">//获取所有进程pid</span><br>        <span class="hljs-keyword">if</span> (!ve.empty())<br>        &#123;<br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;There are currently %d processes\n&quot;</span>, ve.size());<br>            <span class="hljs-comment">//依次注入并用map标记是否被注入过</span><br>            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">auto</span> i : ve)<br>            &#123;<br>                <span class="hljs-keyword">auto</span> it = mp.find(i);<br>                <span class="hljs-keyword">if</span> (it == mp.end())<span class="hljs-comment">//没有被注入过</span><br>                &#123;<br>                    HANDLE hProcess = OpenProcess(PROCESS_ALL_ACCESS, FALSE, i);<span class="hljs-comment">//要用管理员权限运行，要不然为返回空</span><br>                    <span class="hljs-keyword">if</span> (!hProcess) <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;OpenProcess Error:[%d]&quot;</span>, GetLastError());<br>                    DWORD64 unHookAddr = GetModuleBase(i,<span class="hljs-string">&quot;ntdll.dll&quot;</span>) + <span class="hljs-number">0xA0990</span>;<span class="hljs-comment">//NtProtectVirtualMemory地址，ntdll + 0xA0990</span><br>                    <span class="hljs-keyword">if</span> (RemoveHook(hProcess, (PVOID)unHookAddr, originBytes))<span class="hljs-comment">//先取消NtProtectVirtualMemory钩子再注入</span><br>                    &#123;<br>                        <span class="hljs-keyword">if</span> (InjectDll(hProcess, dllPath))<br>                        &#123;<br>                            Num++;<br>                            mp.insert(&#123; i,<span class="hljs-literal">true</span> &#125;);<span class="hljs-comment">//注入成功后进行标记</span><br>                            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Inject  process Success!\n&quot;</span>, Num);<br>                        &#125;<br>                    &#125;<br>                     <br>                &#125;<br>                <span class="hljs-keyword">else</span>  <span class="hljs-keyword">continue</span>;<span class="hljs-comment">//曾经注入过该进程</span><br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">else</span> <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Wating WorkingService.exe ...\n&quot;</span>);<br>        Sleep(<span class="hljs-number">1000</span>);<br>        system(<span class="hljs-string">&quot;cls&quot;</span>);<br>        <br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br></code></pre></td></tr></table></figure>



<h3 id="DLL代码"><a href="#DLL代码" class="headerlink" title="DLL代码"></a>DLL代码</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">//dllmain.cpp</span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;pch.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;windows.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;shellapi.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;detours.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;tlhelp32.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">pragma</span> comment(lib,<span class="hljs-string">&quot;detours.lib&quot;</span>)</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> _KDEBUG</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> DBGMGEBOX(fmt, ...) \</span><br><span class="hljs-meta">    do &#123; \</span><br><span class="hljs-meta">         <span class="hljs-comment">/* 假设最大长度为1024，根据需要调整大小 */</span> \</span><br><span class="hljs-meta">        wsprintfA(out, fmt, __VA_ARGS__); \</span><br><span class="hljs-meta">        MessageBoxA(NULL, out, <span class="hljs-string">&quot;提示&quot;</span>, MB_OK); \</span><br><span class="hljs-meta">    &#125; while(0)</span><br><span class="hljs-type">char</span> out[<span class="hljs-number">100</span>];<br>DWORD tlsIndex;<span class="hljs-comment">//tls索引</span><br><span class="hljs-keyword">typedef</span> <span class="hljs-title function_">BOOL</span><span class="hljs-params">(WINAPI* ShellExecuteExA_t)</span><span class="hljs-params">(SHELLEXECUTEINFOA*)</span>;<br><span class="hljs-keyword">typedef</span> <span class="hljs-title function_">HANDLE</span> <span class="hljs-params">(WINAPI* CreateFileA_t)</span><span class="hljs-params">(</span><br><span class="hljs-params">    LPCSTR                lpFileName,</span><br><span class="hljs-params">    DWORD                 dwDesiredAccess,</span><br><span class="hljs-params">    DWORD                 dwShareMode,</span><br><span class="hljs-params">    LPSECURITY_ATTRIBUTES lpSecurityAttributes,</span><br><span class="hljs-params">    DWORD                 dwCreationDisposition,</span><br><span class="hljs-params">    DWORD                 dwFlagsAndAttributes,</span><br><span class="hljs-params">    HANDLE                hTemplateFile</span><br><span class="hljs-params">)</span>;<br>ShellExecuteExA_t TrueShellExecuteExA = <span class="hljs-literal">NULL</span>;<br>CreateFileA_t TrueCreateFileA = <span class="hljs-literal">NULL</span>;<br>BOOL WINAPI <span class="hljs-title function_">HookedShellExecuteExA</span><span class="hljs-params">(SHELLEXECUTEINFOA* pExecInfo)</span> &#123;<br><span class="hljs-meta">#<span class="hljs-keyword">if</span> 1</span><br>    <span class="hljs-comment">//执行第一个ShellExecuteExA守护进程</span><br>    <span class="hljs-type">static</span> <span class="hljs-type">int</span> Num = <span class="hljs-number">0</span>;<br>    DBGMGEBOX(<span class="hljs-string">&quot;ShellExecuteExA 被调用:Num = %d\nhProcess = %p&quot;</span>, Num, pExecInfo-&gt;hProcess);<br>    <span class="hljs-keyword">if</span> (Num == <span class="hljs-number">0</span>)<br>    &#123;<br>        Num++;<br>        <span class="hljs-keyword">return</span> TrueShellExecuteExA(pExecInfo);<br>    &#125;<br>    <span class="hljs-keyword">else</span><br>    &#123;<br>        <span class="hljs-keyword">return</span> TrueShellExecuteExA(pExecInfo);<br>    &#125;<br><span class="hljs-meta">#<span class="hljs-keyword">else</span></span><br>    <span class="hljs-comment">//执行第二个ShellExecuteExA病毒进程</span><br>    <span class="hljs-type">static</span> <span class="hljs-type">int</span> Num = <span class="hljs-number">0</span>;<br>    DBGMGEBOX(<span class="hljs-string">&quot;ShellExecuteExA 被调用:Num = %d \n调用者窗口句柄 = 0x%p\n&quot;</span>, Num, pExecInfo-&gt;hwnd);<br>    <span class="hljs-keyword">if</span> (Num == <span class="hljs-number">0</span>)<br>    &#123;<br>        Num++;<br>        DBGMGEBOX(<span class="hljs-string">&quot;[2]:当前线程ID：%d&quot;</span>, GetCurrentThreadId());<br>        pExecInfo-&gt;lpFile = <span class="hljs-string">&quot;C:\\Users\\Administrator\\Desktop\\自动F8直到call.txt&quot;</span>;<span class="hljs-comment">//修改参数导致重启失败;</span><br>        <span class="hljs-keyword">return</span> TrueShellExecuteExA(pExecInfo);<br> <br>    &#125;<br>    <span class="hljs-keyword">else</span><br>    &#123;<br> <br>        DBGMGEBOX(<span class="hljs-string">&quot;[1]:当前线程ID：%d&quot;</span>, GetCurrentThreadId());<br>        <span class="hljs-keyword">return</span> TrueShellExecuteExA(pExecInfo);<br>    &#125;<br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br>&#125;<br>HANDLE WINAPI <span class="hljs-title function_">HookCreateFileA</span><span class="hljs-params">(</span><br><span class="hljs-params">    LPCSTR                lpFileName,</span><br><span class="hljs-params">    DWORD                 dwDesiredAccess,</span><br><span class="hljs-params">    DWORD                 dwShareMode,</span><br><span class="hljs-params">    LPSECURITY_ATTRIBUTES lpSecurityAttributes,</span><br><span class="hljs-params">    DWORD                 dwCreationDisposition,</span><br><span class="hljs-params">    DWORD                 dwFlagsAndAttributes,</span><br><span class="hljs-params">    HANDLE                hTemplateFile</span><br><span class="hljs-params">)</span><br>&#123;<br> <br>    <span class="hljs-comment">//判断线程是否是第一次运行CreateFileA，是的话就放行，不是第一次运行就终止线程</span><br>    <span class="hljs-comment">// 获取当前线程的TLS值</span><br>    LPVOID tlsValue = TlsGetValue(tlsIndex);<br>    <span class="hljs-keyword">if</span> ((DWORD_PTR)tlsValue &lt;= <span class="hljs-number">0x10</span>)<br>    &#123;<br>        <span class="hljs-comment">//</span><br><span class="hljs-meta">#<span class="hljs-keyword">ifdef</span> _KDEBUG</span><br>        DBGMGEBOX(<span class="hljs-string">&quot;放行\nlpFileName:%s\n&quot;</span>, lpFileName);<br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br>        dwFlagsAndAttributes = FILE_ATTRIBUTE_NORMAL;<br>        TlsSetValue(tlsIndex, (LPVOID)((DWORD_PTR)tlsValue + <span class="hljs-number">1</span>));<br>    &#125;<br>    <span class="hljs-keyword">else</span><br>    &#123;<br>        <span class="hljs-type">static</span> <span class="hljs-type">int</span> Num = <span class="hljs-number">0</span>;<span class="hljs-comment">//如果终止了十六个线程，再终止进程，使得守护线程再生工作进程</span><br>        <span class="hljs-comment">// 不是第一次运行，终止线程</span><br><span class="hljs-meta">#<span class="hljs-keyword">ifdef</span> _KDEBUG</span><br>        DBGMGEBOX(<span class="hljs-string">&quot;终止\nlpFileName:%s\n&quot;</span>, lpFileName);<br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br>        Num++;<br>        ExitThread(<span class="hljs-number">0</span>);<br>        <span class="hljs-keyword">if</span> (Num == <span class="hljs-number">16</span>) <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>    &#125;<br>    <span class="hljs-keyword">return</span> TrueCreateFileA(lpFileName, dwDesiredAccess, dwShareMode, lpSecurityAttributes, dwCreationDisposition, dwFlagsAndAttributes, hTemplateFile);<br>&#125;<br> <br>BOOL APIENTRY <span class="hljs-title function_">DllMain</span><span class="hljs-params">(HMODULE hModule, DWORD ul_reason_for_call, LPVOID lpReserved)</span> &#123;<br>    <span class="hljs-keyword">switch</span> (ul_reason_for_call) &#123;<br>    <span class="hljs-keyword">case</span> DLL_PROCESS_ATTACH:<br> <br>        DetourTransactionBegin();<br>        DetourUpdateThread(GetCurrentThread());<br> <br>        <span class="hljs-comment">//ShellExecuteExA hook</span><br>        <span class="hljs-comment">/*TrueShellExecuteExA = (ShellExecuteExA_t)DetourFindFunction(&quot;shell32.dll&quot;, &quot;ShellExecuteExA&quot;);</span><br><span class="hljs-comment">        DetourAttach(&amp;(PVOID&amp;)TrueShellExecuteExA, HookedShellExecuteExA);*/</span><br> <br>        tlsIndex = TlsAlloc();<span class="hljs-comment">//初始化TLS</span><br>        TrueCreateFileA = (CreateFileA_t)DetourFindFunction(<span class="hljs-string">&quot;kernelbase.dll&quot;</span>, <span class="hljs-string">&quot;CreateFileA&quot;</span>);<br>        DetourAttach(&amp;(PVOID&amp;)TrueCreateFileA, HookCreateFileA);<br>        <br>        DetourTransactionCommit();<br>        <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">case</span> DLL_PROCESS_DETACH:<br>        DetourTransactionBegin();<br>        DetourUpdateThread(GetCurrentThread());<br>        DetourDetach(&amp;(PVOID&amp;)TrueShellExecuteExA, HookedShellExecuteExA);<br>        DetourDetach(&amp;(PVOID&amp;)TrueCreateFileA, HookCreateFileA);<br>        TlsFree(tlsIndex);<span class="hljs-comment">//清理TLS</span><br> <br>        DetourTransactionCommit();<br>        <span class="hljs-keyword">break</span>;<br>    &#125;<br>    <span class="hljs-keyword">return</span> TRUE;<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="APC注入"><a href="#APC注入" class="headerlink" title="APC注入"></a>APC注入</h2><p>APC注入的原理？</p>
<p>APC是一个简称，即“异步过程调用”。APC注入的原理是利用当线程被唤醒时，APC中的注册函数会被执行，并以此去执行我们的DLL加载代码，进而完成DLL注入的目的。在线程下一次被调度的时候，就会执行APC函数，APC有两种形式，由系统产生的APC称为内核模式APC，由应用程序产生的APC被称为用户模式APC。</p>
<p>其实现流程为：</p>
<pre><code>1）当EXE里某个线程执行到SleepEx()或者WaitForSingleObjectEx()时，系统就会产生一个软中断。
2）当线程再次被唤醒时，此线程会首先执行APC队列中的被注册的函数。
3）利用QueueUserAPC()这个API可以在软中断时向线程的APC队列插入一个函数指针，如果我们插入的是Loadlibrary()执行函数的话，就能达到注入DLL的目的。
</code></pre>
<p>使用方法：</p>
<p>1.利用快照枚举所有的线程</p>
<p>2.写入远程内存,写入的是Dll的路径</p>
<p>3.插入我们的DLL即可</p>
<h3 id="注入代码-1"><a href="#注入代码-1" class="headerlink" title="注入代码"></a>注入代码</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span> <span class="hljs-title function_">CAPCInjectorDlg::OnBnClickedApcattack</span><span class="hljs-params">()</span><br>&#123;<br>	<span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> 在此添加控件通知处理程序代码</span><br>	<span class="hljs-comment">//1.查找窗口</span><br>  HWND hWnd = ::FindWindow(<span class="hljs-literal">NULL</span>, TEXT(<span class="hljs-string">&quot;APCTest&quot;</span>));<br>  <span class="hljs-keyword">if</span> (<span class="hljs-literal">NULL</span> == hWnd)<br>  &#123;<br>    <span class="hljs-keyword">return</span>;<br>  &#125;<br>  <span class="hljs-comment">/*2.获得进程的PID,当然通用的则是你把进程PID当做要注入的程序,这样不局限</span><br><span class="hljs-comment">  于窗口了.这里简单编写,进程PID可以快照遍历获取</span><br><span class="hljs-comment">  */</span><br>  DWORD dwPid = <span class="hljs-number">0</span>;<br>  DWORD dwTid = <span class="hljs-number">0</span>;<br>  dwTid = GetWindowThreadProcessId(hWnd, &amp;dwPid);<br> <br>  <span class="hljs-comment">//3.打开进程</span><br>  HANDLE hProcess = <span class="hljs-literal">NULL</span>;<br>  hProcess = OpenProcess(PROCESS_ALL_ACCESS, FALSE, dwPid);<br>  <span class="hljs-keyword">if</span> (<span class="hljs-literal">NULL</span> == hProcess)<br>  &#123;<br>    <span class="hljs-keyword">return</span>;<br>  &#125;<br>  <span class="hljs-comment">//4.成功了,申请远程内存</span><br>  <span class="hljs-type">void</span> *lpAddr = <span class="hljs-literal">NULL</span>;<br>  lpAddr = VirtualAllocEx(hProcess, <span class="hljs-number">0</span>, <span class="hljs-number">0x1000</span>, MEM_COMMIT, PAGE_EXECUTE_READWRITE);<br>  <span class="hljs-keyword">if</span> (<span class="hljs-literal">NULL</span> == lpAddr)<br>  &#123;<br>    <span class="hljs-keyword">return</span>;<br>  &#125;<br>  <span class="hljs-comment">//5.写入我们的DLL路径,这里我写入当前根目录下的路径</span><br>  <span class="hljs-type">char</span> szBuf[] = <span class="hljs-string">&quot;MyDll.dll&quot;</span>;<br>  BOOL bRet = WriteProcessMemory(hProcess, lpAddr, szBuf, <span class="hljs-built_in">strlen</span>(szBuf) + <span class="hljs-number">1</span>, <span class="hljs-literal">NULL</span>);<br>  <span class="hljs-keyword">if</span> (!bRet)<br>  &#123;<br>    <span class="hljs-keyword">return</span>;<br>  &#125;<br>  <span class="hljs-comment">//6.根据线程Tid,打开线程句柄</span><br>  HANDLE hThread = <span class="hljs-literal">NULL</span>;<br>  hThread = OpenThread(THREAD_ALL_ACCESS, FALSE, dwTid);<br>  <span class="hljs-keyword">if</span> (<span class="hljs-literal">NULL</span> == hThread)<br>  &#123;<br>    <span class="hljs-keyword">return</span>;<br>  &#125;<br>  <span class="hljs-comment">//7.给APC队列中插入回调函数</span><br>  QueueUserAPC((PAPCFUNC)LoadLibraryA, hThread, (ULONG_PTR)lpAddr);<br> <br>  CloseHandle(hThread);<br>  CloseHandle(hProcess);<br>&#125;<br></code></pre></td></tr></table></figure>





<h2 id="注册表注入"><a href="#注册表注入" class="headerlink" title="注册表注入"></a>注册表注入</h2><p>利用在Windows系统中，当REG中的以下键值中存在有DLL文件路径时，会跟随EXE文件的启动加载这个DLL文件路径中的DLL文件。当如果遇到有多个DLL文件时，需要用逗号或者空格隔开多个DLL文件的路径。</p>
<p>注册表项：HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Windows\AppInit_DLL</p>
<p>REG注入就是Windows 系统在给EXE文件加载DLL文件的过程中，多加载了一个比如说AppInit_DLL中的DLL文件，这个DLL文件可以是合法的，也可以是病毒文件的DLL，这就要看使用者是怎么利用这个特性了。</p>
<p>换个说法理解一下：</p>
<p>在系统中每一个进程加载User32.dll时，会收到DLL_PROCESS_ATTACH通知，当User32.dll对其进行处理时，会取得注册表键值HKEY_LOCAL_MACHINE\Software\Microsoft\windowsNT\CurrentVresion\Windows\AppInit_Dlls，并调用LoadLibrary来载入这个字符串中指定的每个DLL。被调用的DLL会在系统调用它们的DllMain函数，并将参数fdwReason的值设为DLL_PROCESS_ATTACH时，对自己进行初始化。所以我们在这个键值中添加我们的Dll路径，即可实现注入。</p>
<p>再换个说法理解一下：</p>
<p>注册表中默认提供了AppInit_Dlls与LoadAppInit_Dlls两个注册表项</p>
<p>在注册表编辑器中，将要注入的DLL路径字符串写入AppInit_Dlls项目，然后把LoadAppInit_Dlls项目值设置为1，重启后，指定DLL会注入所有运行进程。</p>
<p>工作原理：User32.dll被加载到进程是，会读取AppInit_DLLs注册表项，若有值，则调用LoadLibrary()API加载用户DLL,所以，严格的说，想应DLL并不会被加载到所有进程，而只是加载user32.dll的进程，Windows Xp忽略LoadAppInit.DLLs项。</p>
<p>注入流程：</p>
<p>打开注册表键值如下：<br>HKEY_LOCAL_MACHINE\SoftWare\MicroSoft\Windows NT\CurrentVersion\Windows\</p>
<ol>
<li><p>在上面的注册表项中操作 AppInit_DLLs 键值，在该键值中添加自己的DLL的全路径加dll名，多个DLL以逗号或者空格分开（因此在文件名中应该尽量不要存在空格），该键值只有第一个dll文件名可以包含路径，后面的都不能包含，因此我们最好将dll放在系统路径    下，这样就可以不用包含路径也能被加载了。</p>
</li>
<li><p>在该注册表项中添加键值 LoadAppInit_DLLs ，类型为 DWORD，并将其值置为 1 。</p>
</li>
</ol>
<p>总结</p>
<p>REG注入操作简单易懂，甚至不用写程序都可以完成注入操作，但是正是由于他的简单性，每个EXE都被注入，效率低，程序的扩展性差。</p>
<h2 id="ComRes注入"><a href="#ComRes注入" class="headerlink" title="ComRes注入"></a>ComRes注入</h2><p>ComRes注入的原理是利用Windows系统中C:\WINDOWS\system32目录下的ComRes.dll这个文件，当待注入EXE如果使用CoCreateInstance()这个API时，COM服务器会加载ComRes.dll到EXE中，利用这个加载过程，我们可以将ComRes.dll替换掉，并在伪造的ComRes.dll，然后利用LoadLibrary()将事先准备好的DLL加载到目标EXE中。</p>
<p>注意事项：</p>
<p>由于直接拷贝comres.dll文件到C:\WINDOWS\system32目录下会引起winows的文件系统保护机制，所以首先需要将C:\WINDOWS\system32\dllcache下的文件替换掉，然后再将其C:\WINDOWS\system32文件替换为我们伪造的文件。</p>
<p>ComRes注入只需伪造与替换就可以完成，编程要求不高，方便使用，但是由于加载了ComRes.dll后，再想替换ComRes.dll文件就不可能了，因此想反复测试ComRes.dll文件就比较麻烦。</p>
<h2 id="劫持进程创建注入"><a href="#劫持进程创建注入" class="headerlink" title="劫持进程创建注入"></a>劫持进程创建注入</h2><p>劫持进程创建注入原理是利用Windows系统中的CreateProcess()这个API创建一个进程，并且将第六个参数设置为CREATE_SUSPENDED，进而创建一个挂起状态的进程，利用这个进程状态进行远程线程注入DLL，然后用ResumeThread()函数回复进程。</p>
<p>劫持进程创建注入其实就是远程线程注入的前期加强版，他可以在进程启动前进行注入，由于进程的线程没有启动，这样就可以躲过待注入进程的检测，提高注入的成功率。</p>
<h2 id="消息钩子注入"><a href="#消息钩子注入" class="headerlink" title="消息钩子注入"></a>消息钩子注入</h2><p>消息钩子注入原理是利用Windows系统中的SetWindowsHookEx()这个API，他可以拦截目标进程的消息到指定的DLL中的导出函数，利用这个特性，我们可以将DLL注入到指定的进程中。</p>
<p>注意：</p>
<p>消息钩子注入只需要对SetWindowsHookEx()和DLL导出函数有深刻的认识就可以很容编写，所以代码简单，比较容易实现。</p>
<div id="paginator"></div></div><div id="post-footer"><div id="pages"><div id="footer-link" style="right: calc(50% - 1px);order: 1;border-right: 1px solid #fe2;padding-left: unset;max-width: calc(50% - 4px);"><a href="/2024/08/20/security/reverse_debug/">← Next 反调试技术</a></div><div id="footer-link" style="left: 50%;order: 0;border-left: 1px solid #fe2;padding-right: unset;max-width: calc(50% - 5px);"><a href="/2024/08/20/security/dnf_sec/">DNF外挂对抗学习记录 Prev →</a></div></div></div><details id="reward"><summary>打赏点小钱</summary><div id="alipay"><span>支付宝 | Alipay</span><br><img src="/img/Alipay.png"></div><div id="wechat"><span>微信 | WeChat</span><br><img src="/img/WeChat.png"></div></details><div id="Valine"></div></div><div id="bottom-btn"><a id="to-index" href="#toc-div" title="index">≡</a><a id="to-top" onClick="scrolls.scrolltop();" title="to top" style="opacity: 0; display: none;">∧</a></div></article><aside><div id="aside-top"><div id="about"><a href="/" id="logo"><img src="/images/header.jpg" alt="Logo"></a><h1 id="Dr"><a target="_blank" rel="noopener" href="https://github.com/i0gan">I0gan</a></h1><div id="description"></div></div><div id="aside-block"><div id="toc-div"><h1>INDEX</h1><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#DLL%E6%B3%A8%E5%85%A5"><span class="toc-text">DLL注入</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%9C%E7%A8%8B%E7%BA%BF%E7%A8%8B%E6%B3%A8%E5%85%A5"><span class="toc-text">远程线程注入</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%A8%E5%85%A5%E4%BB%A3%E7%A0%81"><span class="toc-text">注入代码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DLL%E4%BB%A3%E7%A0%81"><span class="toc-text">DLL代码</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#APC%E6%B3%A8%E5%85%A5"><span class="toc-text">APC注入</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%A8%E5%85%A5%E4%BB%A3%E7%A0%81-1"><span class="toc-text">注入代码</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B3%A8%E5%86%8C%E8%A1%A8%E6%B3%A8%E5%85%A5"><span class="toc-text">注册表注入</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ComRes%E6%B3%A8%E5%85%A5"><span class="toc-text">ComRes注入</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8A%AB%E6%8C%81%E8%BF%9B%E7%A8%8B%E5%88%9B%E5%BB%BA%E6%B3%A8%E5%85%A5"><span class="toc-text">劫持进程创建注入</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B6%88%E6%81%AF%E9%92%A9%E5%AD%90%E6%B3%A8%E5%85%A5"><span class="toc-text">消息钩子注入</span></a></li></ol></li></ol></div></div></div><footer><nobr><span class="text-title">ICP</span><a class="text-content" target="_blank" rel="noopener" href="https://beian.miit.gov.cn/">沪ICP备2021037250号-1  </a></nobr><nobr><span class="text-title">©</span><span class="text-content">2022 by i0gan</span></nobr><br></footer></aside></main><canvas id="canvas-dust"></canvas><div id="cursor-container"><div id="cursor-outer"></div><div id="cursor-effect"></div></div><script src="/js/search.js"></script><script class="pjax-js">reset=_=>{new Valine({
 el: '#Valine'
 , appId: 'TzNey4n3v0Sx6vdBbytYLoH9-gzGzoHsz'
 , appKey: 'GIXXrK9zLxt0bZLww1hte0Oq' , placeholder: '此条评论委托企鹅物流发送'
});code.findCode();mermaid.init(undefined, ('.mermaid'));}</script><script src="//unpkg.com/@highlightjs/cdn-assets@11.4.0/highlight.min.js"></script><script src="/js/arknights.js"></script><script>window.addEventListener("load",()=>{reset()})</script></body></html>