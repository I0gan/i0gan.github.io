<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Squick游戏服务器框架 | I0gan's blog</title><script src="//unpkg.com/valine/dist/Valine.min.js"></script><script>var config = {"root":"/","path":""}</script><script src="//unpkg.com/mermaid@8.13.5/dist/mermaid.min.js"></script><script>mermaid.initialize({
 startOnLoad: true
 , theme: 'dark'
});</script><link rel="stylesheet" href="/css/arknights.css"><link rel="stylesheet" href="//unpkg.com/@highlightjs/cdn-assets@11.4.0/styles/atom-one-dark-reasonable.min.css"><style>@font-face {
 font-family: BenderLight;
 src: local('Bender'), url("/font/BenderLight.ttf");
}
@font-face {
 font-family: 'JetBrains Mono';
 src: local('JetBrains Mono'), url('/font/JetBrainsMono-Regular.woff2') format('woff2');
}</style><meta name="generator" content="Hexo 6.3.0"></head><body style="background-image:url(https://ak.hypergryph.com/assets/index/images/ak/pc/bk.jpg);"><main><header class="closed"><nav><div class="navBtn"><i class="navBtnIcon"><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span></i></div><ol class="navContent"><li class="navItem" id="search-header"><span class="navItemTitle"><input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="Search" spellcheck="false" maxlength="50" type="text" id="search-input"></span></li><li class="navItem"><a class="navBlock" href="/"><span class="navItemTitle">Home</span></a></li><li class="navItem"><a class="navBlock" href="/about/"><span class="navItemTitle">About</span></a></li><li class="navItem" matchdata="categories,tags"><a class="navBlock" href="/archives/"><span class="navItemTitle">Archives</span></a></li><li class="navItem"><a class="navBlock" href="/shell/"><span class="navItemTitle">Shell</span></a></li></ol></nav><div class="search-popup"><div id="search-result"></div></div></header><article><div id="post-bg"><div id="post-title"><h1>Squick游戏服务器框架</h1><div id="post-info"><span>First Post: <div class="control"><time datetime="2022-09-17T03:04:08.000Z" id="date"> 2022-09-17</time></div></span><br><span>Last Update: <div class="control"><time datetime="2022-10-24T09:46:26.498Z" id="updated"> 2022-10-24</time></div></span><br><span>Word Count: <div class="control">1.3k</div></span><br><span>Read Time: <div class="control">6 min</div></span></div></div><hr><div id="post-content"><h1 id="Squick游戏服务器框架"><a href="#Squick游戏服务器框架" class="headerlink" title="Squick游戏服务器框架"></a>Squick游戏服务器框架</h1><h2 id="Squick是什么"><a href="#Squick是什么" class="headerlink" title="Squick是什么?"></a>Squick是什么?</h2><p>Squick是一款可快速开发拓展的游戏服务器开发框架，轻量，插件化，易拓展，支持lua脚本。</p>
<p>Github: <a target="_blank" rel="noopener" href="https://github.com/pwnsky/squick">https://github.com/pwnsky/squick</a></p>
<p>目前正在极速开发Unity客户端SDK中，客户端sdk: <a target="_blank" rel="noopener" href="https://github.com/i0gan/Uquick">https://github.com/i0gan/Uquick</a></p>
<h2 id="特性"><a href="#特性" class="headerlink" title="特性"></a>特性</h2><ul>
<li><p>易使用，采用。</p>
</li>
<li><p>采用动态连链接库方式动态加载插件，开发拓展插件，让开发服务器变成开发插件。</p>
</li>
<li><p>遵守谷歌C++编程规范</p>
</li>
<li><p>事件和属性驱动，让开发变得更简单。</p>
</li>
<li><p>Excel实现服务端配置</p>
</li>
<li><p>日志捕获系统</p>
</li>
<li><p>支持Lua脚本开发</p>
</li>
<li><p>支持部分不用停服即可热更</p>
</li>
<li><p>默认拥有服务器插件：代理服务器、世界服务器、导航系统、数据库服务器、中心服务器、登录服务器</p>
</li>
</ul>
<h2 id="快速运行Demo"><a href="#快速运行Demo" class="headerlink" title="快速运行Demo"></a>快速运行Demo</h2><h3 id="编译服务端"><a href="#编译服务端" class="headerlink" title="编译服务端"></a>编译服务端</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">git clone https://github.com/pwnsky/squick.git<br>cd squick<br>bash install.sh<br></code></pre></td></tr></table></figure>

<p>如果不能编译，可能是缺少依赖，打开third_party&#x2F;install.sh 里查看需要安装的依赖。</p>
<p>编译</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">./build.sh<br></code></pre></td></tr></table></figure>

<p>编译成功后，可执行以及插件会在{project_path}&#x2F;build&#x2F;server 下，如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">server<br>├── lib<br>│   ├── skcore.so<br>│   ├── squick_plugin_loader.so<br>│   └── squick_struct.so<br>├── plugin<br>│   ├── core<br>│   │   ├── actor.so<br>│   │   ├── config.so<br>│   │   ├── kernel.so<br>│   │   ├── log.so<br>│   │   ├── lua.so<br>│   │   ├── navigation.so<br>│   │   ├── net.so<br>│   │   ├── nosql.so<br>│   │   ├── security.so<br>│   │   └── test.so<br>│   └── extend<br>│       ├── db<br>│       │   ├── client.so<br>│       │   ├── logic.so<br>│       │   └── server.so<br>│       ├── game<br>│       │   ├── client.so<br>│       │   ├── logic.so<br>│       │   └── server.so<br>│       ├── login<br>│       │   ├── client.so<br>│       │   ├── http_server.so<br>│       │   ├── logic.so<br>│       │   └── server.so<br>│       ├── master<br>│       │   ├── http_server.so<br>│       │   ├── logic.so<br>│       │   └── server.so<br>│       ├── others<br>│       │   ├── chat.so<br>│       │   ├── consume_manager.so<br>│       │   └── inventory.so<br>│       ├── proxy<br>│       │   ├── client.so<br>│       │   ├── logic.so<br>│       │   └── server.so<br>│       └── world<br>│           ├── client.so<br>│           └── server.so<br>└── squick<br></code></pre></td></tr></table></figure>



<h3 id="运行服务端"><a href="#运行服务端" class="headerlink" title="运行服务端"></a>运行服务端</h3><p>通过debug.sh脚本或者start.sh启动服务，debug.sh用于方便实时查看输出信息，start.sh后台启动，主要用于发布版本的启动。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">cd ./build<br>./debug.sh # 或 ./start.sh<br></code></pre></td></tr></table></figure>



<h4 id="搭建redis服务器"><a href="#搭建redis服务器" class="headerlink" title="搭建redis服务器"></a>搭建redis服务器</h4><p>服务器的数据库默认为redis服务器，这里采用docker来进行搭建。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker pull redis<br>docker run --name redis-cache -p 10086:6379  -d redis --requirepass pwnsky <span class="hljs-comment"># pwnsky 是密码</span><br></code></pre></td></tr></table></figure>

<p>打开： build&#x2F;config&#x2F;excel&#x2F;side&#x2F;NoSqlServer.xlsx 修改数据库连接IP和端口</p>
<p>但是在修改后，需要重新生成新的配置文件，执行以下命令。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> ./build/config/tools<br>./gen_config.sh<br></code></pre></td></tr></table></figure>

<p><strong>tips:</strong></p>
<p>redis查看</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">redis-cli -h 127.0.0.1 -p 10086<br>auth pwnsky    # pwnsky 是密码<br>keys *         # 查看所有key<br></code></pre></td></tr></table></figure>

<p>redis常用命令: <a target="_blank" rel="noopener" href="https://blog.csdn.net/Kristabo/article/details/125384059">https://blog.csdn.net/Kristabo/article/details/125384059</a></p>
<h4 id="客户端"><a href="#客户端" class="headerlink" title="客户端"></a>客户端</h4><p><a target="_blank" rel="noopener" href="https://github.com/i0gan/Uquick">https://github.com/i0gan/Uquick</a> 下载下来，采用Unity打开，我采用的是2020.03.xx。</p>
<h2 id="快速入门"><a href="#快速入门" class="headerlink" title="快速入门"></a>快速入门</h2><h3 id="了解Squick"><a href="#了解Squick" class="headerlink" title="了解Squick"></a>了解Squick</h3><h3 id="制作插件"><a href="#制作插件" class="headerlink" title="制作插件"></a>制作插件</h3><h3 id="服务端教学"><a href="#服务端教学" class="headerlink" title="服务端教学"></a>服务端教学</h3><h4 id="自定义实现登录"><a href="#自定义实现登录" class="headerlink" title="自定义实现登录"></a>自定义实现登录</h4><p>自定义消息ID，在<code>src/squick/struct/define.proto</code>, 默认已经定义</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">REQ_LOGIN								= 101;     	//<br>ACK_LOGIN								= 102;     	//<br></code></pre></td></tr></table></figure>

<p>定义消息结构，<code>NFComm/NFMessageDefine/NFMsgPreGame.proto</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">message ReqAccountLogin<br>&#123; <br>    bytes 			account = 2;<br>    bytes 			password = 3;<br>    bytes 			security_code = 4;<br>    bytes 			signBuff = 5;<br>    int32 			clientVersion = 6;<br>    ELoginMode		loginMode = 7;<br>    int32 			clientIP = 8;<br>    int64 			clientMAC = 9;<br>    bytes 			device_info = 10;<br>    bytes 			extra_info = 11;<br>    int32 			platform_type = 12;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>修改完毕后，需要通过protoc重新生成新的C++和CS代码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">cd &#123;project_path&#125;/src/squick/struct<br>./gen_code.sh<br></code></pre></td></tr></table></figure>

<p>运行后会自动将生成代码文件，并将CS代码复制到客户端项目<code>Assets/Resources/SquickConfig/</code></p>
<p>增加一个登录系统模块，默认已经实现。</p>
<p>打开<code>src/server/login/plugin/server/server_module.cc</code></p>
<p>在AfterInit函数李增加回调，默认已实现</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c++">m_pNetModule-&gt;<span class="hljs-built_in">AddReceiveCallBack</span>(NFMsg::REQ_LOGIN, <span class="hljs-keyword">this</span>, &amp;NFLoginNet_ServerModule::OnLoginProcess);<br></code></pre></td></tr></table></figure>

<p>OnLoginProcess回调函数如下：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">NFLoginNet_ServerModule::OnLoginProcess</span><span class="hljs-params">(<span class="hljs-type">const</span> NFSOCK sockIndex, <span class="hljs-type">const</span> <span class="hljs-type">int</span> msgID, <span class="hljs-type">const</span> <span class="hljs-type">char</span>* msg, <span class="hljs-type">const</span> <span class="hljs-type">uint32_t</span> len)</span></span><br><span class="hljs-function"></span>&#123;<br>	NFGUID nPlayerID;<br>	NFMsg::ReqAccountLogin xMsg;<br>	<span class="hljs-keyword">if</span> (!m_pNetModule-&gt;<span class="hljs-built_in">ReceivePB</span>( msgID, msg, len, xMsg, nPlayerID))<br>	&#123;<br>		<span class="hljs-keyword">return</span>;<br>	&#125;<br><br>	NetObject* pNetObject = m_pNetModule-&gt;<span class="hljs-built_in">GetNet</span>()-&gt;<span class="hljs-built_in">GetNetObject</span>(sockIndex);<br>	<span class="hljs-keyword">if</span> (pNetObject)<br>	&#123;<br>		<span class="hljs-keyword">if</span> (pNetObject-&gt;<span class="hljs-built_in">GetConnectKeyState</span>() == <span class="hljs-number">0</span>)<br>		&#123;<br>			<span class="hljs-comment">//Normally, you could check the account and password is correct or not, but for our situation, it will correct by default as here is the tutorial code.</span><br>			<span class="hljs-type">int</span> loginResult = <span class="hljs-number">0</span>;<span class="hljs-comment">//0 means successful, else means error code from account platform.</span><br>			<span class="hljs-keyword">if</span> (<span class="hljs-number">0</span> != loginResult)<br>			&#123;<br>				std::ostringstream strLog;<br>				strLog &lt;&lt; <span class="hljs-string">&quot;Check password failed, Account = &quot;</span> &lt;&lt; xMsg.<span class="hljs-built_in">account</span>() &lt;&lt; <span class="hljs-string">&quot; Password = &quot;</span> &lt;&lt; xMsg.<span class="hljs-built_in">password</span>();<br>				m_pLogModule-&gt;<span class="hljs-built_in">LogError</span>(<span class="hljs-built_in">NFGUID</span>(<span class="hljs-number">0</span>, sockIndex), strLog, __FUNCTION__, __LINE__);<br><br>				NFMsg::AckEventResult xMsg;<br>				xMsg.<span class="hljs-built_in">set_event_code</span>(NFMsg::ACCOUNTPWD_INVALID);<br><br>				m_pNetModule-&gt;<span class="hljs-built_in">SendMsgPB</span>(NFMsg::EGameMsgID::ACK_LOGIN, xMsg, sockIndex);<br>				<span class="hljs-keyword">return</span>;<br>			&#125;<br><br>			pNetObject-&gt;<span class="hljs-built_in">SetConnectKeyState</span>(<span class="hljs-number">1</span>);<br>			pNetObject-&gt;<span class="hljs-built_in">SetAccount</span>(xMsg.<span class="hljs-built_in">account</span>());<br><br>			NFMsg::AckEventResult xData;<br>			xData.<span class="hljs-built_in">set_event_code</span>(NFMsg::ACCOUNT_LOGIN_SUCCESS);<br><br>			<span class="hljs-comment">//The login server responds the login result to the player by sock id.</span><br>			m_pNetModule-&gt;<span class="hljs-built_in">SendMsgPB</span>(NFMsg::EGameMsgID::ACK_LOGIN, xData, sockIndex);<br><br>			m_pLogModule-&gt;<span class="hljs-built_in">LogInfo</span>(<span class="hljs-built_in">NFGUID</span>(<span class="hljs-number">0</span>, sockIndex), <span class="hljs-string">&quot;Login succeeded :&quot;</span>, xMsg.<span class="hljs-built_in">account</span>().<span class="hljs-built_in">c_str</span>());<br>		&#125;<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>





<h4 id="消息系统"><a href="#消息系统" class="headerlink" title="消息系统"></a>消息系统</h4><p>在同一个房间内如何让玩家之前可以互相发送消息。</p>
<p>在<code>NFComm/NFMessageDefine/NFDefine.proto</code>里定义了请求响应枚举，默认已经定义了。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">REQ_CHAT								= 350;<br>ACK_CHAT								= 351;<br></code></pre></td></tr></table></figure>

<p>消息结构定义在<code>NFComm/NFMessageDefine/NFMsgShare.proto</code></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs c++">message ReqAckPlayerChat<br>&#123;<br>	<span class="hljs-keyword">enum</span> <span class="hljs-title class_">EGameChatChannel</span><br>	&#123;<br>		EGCC_GLOBAL = <span class="hljs-number">0</span>;<br>		EGCC_CLAN = <span class="hljs-number">1</span>;<br>		EGCC_FRIEND = <span class="hljs-number">2</span>;<br>		EGCC_BATTLE = <span class="hljs-number">3</span>;<br>		EGCC_TEAM = <span class="hljs-number">4</span>;<br>		EGCC_ROOM = <span class="hljs-number">5</span>;<br>	&#125;<br>	<span class="hljs-keyword">enum</span> <span class="hljs-title class_">EGameChatType</span><br>	&#123;<br>		EGCT_TEXT= <span class="hljs-number">0</span>;<br>		EGCT_VOICE = <span class="hljs-number">1</span>;<br>		EGCT_EMOJI = <span class="hljs-number">2</span>;<br>		EGCT_DONATE_HERO = <span class="hljs-number">10</span>;<br>		EGCT_DONATE_BUILDING = <span class="hljs-number">11</span>;<br>		EGCT_DONATE_ITEM = <span class="hljs-number">12</span>;<br>	&#125;<br><br>	Ident	player_id = <span class="hljs-number">1</span>;<br>	bytes 	player_name = <span class="hljs-number">2</span>;<br>	bytes 	player_hero_id = <span class="hljs-number">3</span>;<br>	bytes 	player_hero_level = <span class="hljs-number">4</span>;<br>	EGameChatChannel  chat_channel = <span class="hljs-number">5</span>;<br>	EGameChatType  chat_type = <span class="hljs-number">6</span>;<br>	bytes chat_info = <span class="hljs-number">7</span>;<br>	Ident	target_id = <span class="hljs-number">8</span>;<br>&#125;<br></code></pre></td></tr></table></figure>



<p>运行<code>NFComm/NFMessageDefine/cpp.sh</code> 生成对应的C++和CS代码文件</p>
<p>将生成的<code>_Out/NFDataCfg/client/</code>里生成的CS文件复制到客户端项目<code>Assets/Resources/NFDataCfg/</code></p>
<p>增加一个模块到程序中 <code>NFExamples/NFChatPlugin</code>，NF已经实现了。</p>
<p>编辑NFExamples&#x2F;NFChatPlugin&#x2F;NFChatModule.cpp文件，如下（默认已经实现）</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">NFChatModule::AfterInit</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>	m_pNetModule-&gt;<span class="hljs-built_in">AddReceiveCallBack</span>(NFMsg::REQ_CHAT, <span class="hljs-keyword">this</span>, &amp;NFChatModule::OnClientChatProcess);<br><br>	<span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>&#125;<br><br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">NFChatModule::OnClientChatProcess</span><span class="hljs-params">(<span class="hljs-type">const</span> NFSOCK sockIndex, <span class="hljs-type">const</span> <span class="hljs-type">int</span> msgID, <span class="hljs-type">const</span> <span class="hljs-type">char</span>* msg, <span class="hljs-type">const</span> <span class="hljs-type">uint32_t</span> len)</span></span><br><span class="hljs-function"></span>&#123;<br>	<span class="hljs-built_in">CLIENT_MSG_PROCESS</span>( msgID, msg, len, NFMsg::ReqAckPlayerChat);<br><br>	<span class="hljs-keyword">switch</span> (xMsg.<span class="hljs-built_in">chat_channel</span>())<br>	&#123;<br>	<span class="hljs-keyword">case</span> NFMsg::ReqAckPlayerChat::EGCC_GLOBAL:<br>	&#123;<br>		<span class="hljs-comment">//this code means the game server will sends a message to all players who playing game</span><br>		m_pNetModule-&gt;<span class="hljs-built_in">SendMsgPBToAllClient</span>(NFMsg::ACK_CHAT, xMsg);<br>	&#125;<br>	<span class="hljs-keyword">break</span>;<br>	<span class="hljs-keyword">case</span> NFMsg::ReqAckPlayerChat::EGCC_ROOM:<br>	&#123;<br>		<span class="hljs-type">const</span> <span class="hljs-type">int</span> sceneID = m_pKernelModule-&gt;<span class="hljs-built_in">GetPropertyInt</span>(nPlayerID, NFrame::Player::<span class="hljs-built_in">SceneID</span>());<br>		<span class="hljs-type">const</span> <span class="hljs-type">int</span> groupID = m_pKernelModule-&gt;<span class="hljs-built_in">GetPropertyInt</span>(nPlayerID, NFrame::Player::<span class="hljs-built_in">GroupID</span>());<br><br>		<span class="hljs-comment">//this code means the game server will sends a message to all players who in the same room</span><br>		m_pGameServerNet_ServerModule-&gt;<span class="hljs-built_in">SendGroupMsgPBToGate</span>(NFMsg::ACK_CHAT, xMsg, sceneID, groupID);<br>	&#125;<br>	<span class="hljs-keyword">break</span>;<br>	<span class="hljs-keyword">default</span>:<br>	&#123;<br>		<span class="hljs-comment">//this code means the game server will sends a message yourself(nPlayerID)</span><br>		m_pGameServerNet_ServerModule-&gt;<span class="hljs-built_in">SendMsgPBToGate</span>(NFMsg::ACK_CHAT, xMsg, nPlayerID);<br>	&#125;<br>	<span class="hljs-keyword">break</span>;;<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<div id="paginator"></div></div><div id="post-footer"><div id="pages"><div id="footer-link" style="right: calc(50% - 1px);order: 1;border-right: 1px solid #fe2;padding-left: unset;max-width: calc(50% - 4px);"><a href="/2022/09/25/dev/code/nowcoder/%E9%93%BE%E8%A1%A8/">← Next 链表</a></div><div id="footer-link" style="left: 50%;order: 0;border-left: 1px solid #fe2;padding-right: unset;max-width: calc(50% - 5px);"><a href="/2022/09/17/dev/game/server/ProtoBuf/">ProtoBuf Prev →</a></div></div></div><details id="reward"><summary>打赏点小钱</summary><div id="alipay"><span>支付宝 | Alipay</span><br><img src="/img/Alipay.png"></div><div id="wechat"><span>微信 | WeChat</span><br><img src="/img/WeChat.png"></div></details><div id="Valine"></div></div><div id="bottom-btn"><a id="to-index" href="#toc-div" title="index">≡</a><a id="to-top" onClick="scrolls.scrolltop();" title="to top" style="opacity: 0; display: none;">∧</a></div></article><aside><div id="aside-top"><div id="about"><a href="/" id="logo"><img src="https://ak.hypergryph.com/assets/index/images/ak/pc/faction/1.png" alt="Logo"></a><h1 id="Dr"><a target="_blank" rel="noopener" href="https://github.com/i0gan">I0gan</a></h1><div id="description"></div></div><div id="aside-block"><div id="toc-div"><h1>INDEX</h1><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Squick%E6%B8%B8%E6%88%8F%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%A1%86%E6%9E%B6"><span class="toc-text">Squick游戏服务器框架</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Squick%E6%98%AF%E4%BB%80%E4%B9%88"><span class="toc-text">Squick是什么?</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%89%B9%E6%80%A7"><span class="toc-text">特性</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BF%AB%E9%80%9F%E8%BF%90%E8%A1%8CDemo"><span class="toc-text">快速运行Demo</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%96%E8%AF%91%E6%9C%8D%E5%8A%A1%E7%AB%AF"><span class="toc-text">编译服务端</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%90%E8%A1%8C%E6%9C%8D%E5%8A%A1%E7%AB%AF"><span class="toc-text">运行服务端</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%90%AD%E5%BB%BAredis%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-text">搭建redis服务器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%A2%E6%88%B7%E7%AB%AF"><span class="toc-text">客户端</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8"><span class="toc-text">快速入门</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%86%E8%A7%A3Squick"><span class="toc-text">了解Squick</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%B6%E4%BD%9C%E6%8F%92%E4%BB%B6"><span class="toc-text">制作插件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E7%AB%AF%E6%95%99%E5%AD%A6"><span class="toc-text">服务端教学</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E5%AE%9E%E7%8E%B0%E7%99%BB%E5%BD%95"><span class="toc-text">自定义实现登录</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B6%88%E6%81%AF%E7%B3%BB%E7%BB%9F"><span class="toc-text">消息系统</span></a></li></ol></li></ol></li></ol></li></ol></div></div></div><footer><nobr><span class="text-title">ICP</span><a class="text-content" target="_blank" rel="noopener" href="https://beian.miit.gov.cn/">沪ICP备2021037250号-1  </a></nobr><nobr><span class="text-title">©</span><span class="text-content">2022 by i0gan</span></nobr><br></footer></aside></main><canvas id="canvas-dust"></canvas><div id="cursor-container"><div id="cursor-outer"></div><div id="cursor-effect"></div></div><script src="/js/search.js"></script><script class="pjax-js">reset=_=>{new Valine({
 el: '#Valine'
 , appId: 'TzNey4n3v0Sx6vdBbytYLoH9-gzGzoHsz'
 , appKey: 'GIXXrK9zLxt0bZLww1hte0Oq' , placeholder: '此条评论委托企鹅物流发送'
});code.findCode();mermaid.init(undefined, ('.mermaid'));}</script><script src="//unpkg.com/@highlightjs/cdn-assets@11.4.0/highlight.min.js"></script><script src="/js/arknights.js"></script><script>window.addEventListener("load",()=>{reset()})</script></body></html>