<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>虎符网络安全大赛之零解 | I0gan's blog</title><script src="//unpkg.com/valine/dist/Valine.min.js"></script><script>var config = {"root":"/","path":""}</script><script src="//unpkg.com/mermaid@8.13.5/dist/mermaid.min.js"></script><script>mermaid.initialize({
 startOnLoad: true
 , theme: 'dark'
});</script><link rel="stylesheet" href="/css/arknights.css"><link rel="stylesheet" href="//unpkg.com/@highlightjs/cdn-assets@11.4.0/styles/atom-one-dark-reasonable.min.css"><style>@font-face {
 font-family: BenderLight;
 src: local('Bender'), url("/font/BenderLight.ttf");
}
@font-face {
 font-family: 'JetBrains Mono';
 src: local('JetBrains Mono'), url('/font/JetBrainsMono-Regular.woff2') format('woff2');
}</style><meta name="generator" content="Hexo 6.3.0"></head><body style="background-image:url(https://ak.hypergryph.com/assets/index/images/ak/pc/bk.jpg);"><main><header class="closed"><nav><div class="navBtn"><i class="navBtnIcon"><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span></i></div><ol class="navContent"><li class="navItem" id="search-header"><span class="navItemTitle"><input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="数据检索" spellcheck="false" maxlength="50" type="text" id="search-input"></span></li><li class="navItem"><a class="navBlock" href="/"><span class="navItemTitle">Home</span></a></li><li class="navItem"><a class="navBlock" href="/about/"><span class="navItemTitle">About</span></a></li><li class="navItem" matchdata="categories,tags"><a class="navBlock" href="/archives/"><span class="navItemTitle">Archives</span></a></li><li class="navItem"><a class="navBlock" href="/shell/"><span class="navItemTitle">Shell</span></a></li></ol></nav><div class="search-popup"><div id="search-result"></div></div></header><article><div id="post-bg"><div id="post-title"><h1>虎符网络安全大赛之零解</h1><div id="post-info"><span>First Post: <div class="control"><time datetime="2021-04-05T11:07:00.000Z" id="date"> 2021-04-05</time></div></span><br><span>Last Update: <div class="control"><time datetime="2022-10-24T08:55:29.657Z" id="updated"> 2022-10-24</time></div></span><br><span>Word Count: <div class="control">5.4k</div></span><br><span>Read Time: <div class="control">29 min</div></span></div></div><hr><div id="post-content"><h1 id="Hu-Fu-2021-Online-之零解"><a href="#Hu-Fu-2021-Online-之零解" class="headerlink" title="Hu Fu 2021 Online 之零解"></a>Hu Fu 2021 Online 之零解</h1><h2 id="Intro"><a href="#Intro" class="headerlink" title="Intro"></a>Intro</h2><p>这次比赛一个都没做出来，菜～，这篇文章主要重新复现一下没做出来的PWN题，这次比赛既然把两个区块链的题放入了PWN中，我们队伍也没人去研究那玩意儿，以后有时间可以去了解一下。。。这次主要还是WEB输出高，REVERSE也不错，我菜得抠脚QAQ。</p>
<h2 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h2><h3 id="你会分析日志吗"><a href="#你会分析日志吗" class="headerlink" title="你会分析日志吗"></a>你会分析日志吗</h3><p>通过分析日志，发现请求长度有两个399和377，都是采用sql注入，将日志中sleep函数前面的一个数字提取出来即可。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">192.168.52.156 - - [11/Mar/2021:18:04:27 +0000] &quot;GET /index.php?id=1&#x27;%20and%20if(ord(substr((select%20flag%20from%20flllag),34,1))=83,sleep(2),1)--+ HTTP/1.1&quot; 200 399 &quot;-&quot; &quot;python-requests/2.21.0&quot;<br></code></pre></td></tr></table></figure>

<p>这里也就是83</p>
<p>通过提取长度为377请求中的数字，执行命令进行提取</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">cat access.log| grep &quot;377&quot; | grep &quot;select%20flag%20from%20flllag&quot; | tr -d &quot;a-z()[]\&quot;&#x27;/A-Z %.+?-&quot; |  awk -F &#x27;=&#x27; &#x27;&#123;print $3 &#125;&#x27; | cut -d &#x27;,&#x27; -f 1 | tr &quot;\n&quot; &quot;,&quot;<br></code></pre></td></tr></table></figure>

<p>或</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">cat access.log| grep &quot;377&quot; | grep &quot;select%20flag%20from%20flllag&quot; | cut -d &#x27;=&#x27; -f 3 | cut -d &#x27;,&#x27; -f 1 | tr &quot;\n&quot; &quot;,&quot;<br></code></pre></td></tr></table></figure>

<p>输出如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">90,109,120,104,90,51,116,90,98,51,86,102,89,88,74,108,88,51,78,118,88,50,100,121,90,87,70,48,102,81,61,61,<br></code></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python">a = [<span class="hljs-number">90</span>,<span class="hljs-number">109</span>,<span class="hljs-number">120</span>,<span class="hljs-number">104</span>,<span class="hljs-number">90</span>,<span class="hljs-number">51</span>,<span class="hljs-number">116</span>,<span class="hljs-number">90</span>,<span class="hljs-number">98</span>,<span class="hljs-number">51</span>,<span class="hljs-number">86</span>,<span class="hljs-number">102</span>,<span class="hljs-number">89</span>,<span class="hljs-number">88</span>,<span class="hljs-number">74</span>,<span class="hljs-number">108</span>,<span class="hljs-number">88</span>,<span class="hljs-number">51</span>,<span class="hljs-number">78</span>,<span class="hljs-number">118</span>,<span class="hljs-number">88</span>,<span class="hljs-number">50</span>,<span class="hljs-number">100</span>,<span class="hljs-number">121</span>,<span class="hljs-number">90</span>,<span class="hljs-number">87</span>,<span class="hljs-number">70</span>,<span class="hljs-number">48</span>,<span class="hljs-number">102</span>,<span class="hljs-number">81</span>,<span class="hljs-number">61</span>,<span class="hljs-number">61</span>]<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> a:<br>	<span class="hljs-built_in">print</span>(<span class="hljs-built_in">chr</span>(i), end=<span class="hljs-string">&#x27;&#x27;</span>)<br></code></pre></td></tr></table></figure>

<p>打印出该字符为: ZmxhZ3tZb3VfYXJlX3NvX2dyZWF0fQ&#x3D;&#x3D;</p>
<p>base64进行解密: </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">echo &quot;ZmxhZ3tZb3VfYXJlX3NvX2dyZWF0fQ==&quot; | base64 -d <br>flag&#123;You_are_so_great&#125;<br></code></pre></td></tr></table></figure>



<h2 id="PWN"><a href="#PWN" class="headerlink" title="PWN"></a>PWN</h2><p>PWN逆了半天，调试了半天。。。逻辑都没进入，一个字菜～。这次PWN题基本算是VM类型的，grira没办法把某些代码反编译，IDA虽然能反编译汇编，但是伪代码还是存在不能完全反编译。aarch64指令又难看，ememme~。另一个题我看了下，感觉也跟这个差不多，然后我也没很细的看那道题，继续分析apollo，下午太困了，搞不出来，睡觉～～～。这次比赛采用跳转表，只能看汇编动态分析，c伪代码根本不知道在干啥玩意儿！</p>
<h3 id="apollo"><a href="#apollo" class="headerlink" title="apollo"></a>apollo</h3><h4 id="hint"><a href="#hint" class="headerlink" title="hint"></a>hint</h4><p>hint1: 附件补充aarch64库，同时此题的难点在于vm虚拟机的分析。 <a target="_blank" rel="noopener" href="https://pan.baidu.com/s/1_RgBNGCBzJeBqlFKDBV0xg">https://pan.baidu.com/s/1_RgBNGCBzJeBqlFKDBV0xg</a> 提取码：GAME。</p>
<p>hint2: 漏洞点在于车辆前方的绿灯或红灯的转化，使车辆到达了地图外</p>
<p>各个函数伪c代码如下</p>
<h5 id="main-函数"><a href="#main-函数" class="headerlink" title="main 函数"></a>main 函数</h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> __cdecl <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **argv, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **envp)</span><br>&#123;<br>  <span class="hljs-type">int</span> v3; <span class="hljs-comment">// w0</span><br>  <span class="hljs-type">const</span> <span class="hljs-type">char</span> **v4; <span class="hljs-comment">// x1</span><br>  <span class="hljs-type">const</span> <span class="hljs-type">char</span> **v5; <span class="hljs-comment">// x2</span><br><br>  init_();<br>  v3 = logo();<br>  run(v3, v4, v5);<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<h5 id="run-函数"><a href="#run-函数" class="headerlink" title="run 函数"></a>run 函数</h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> __cdecl <span class="hljs-title function_">run</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **argv, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **envp)</span><br>&#123;<br>  <span class="hljs-type">int</span> v4; <span class="hljs-comment">// [xsp+18h] [xbp+18h]</span><br><br>  input_ptr = (__int64)<span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x1000</span>uLL);<br>  <span class="hljs-keyword">if</span> ( !input_ptr )<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Init fail!&quot;</span>);<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;cmd&gt; &quot;</span>);<br>  read(<span class="hljs-number">0</span>, (<span class="hljs-type">void</span> *)input_ptr, <span class="hljs-number">0x1000</span>uLL);<br>  parse();<br>  <span class="hljs-keyword">return</span> v4 ^ _stack_chk_guard;<br>&#125;<br></code></pre></td></tr></table></figure>

<h5 id="parse函数"><a href="#parse函数" class="headerlink" title="parse函数"></a>parse函数</h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span> <span class="hljs-title function_">sub_E14</span><span class="hljs-params">()</span><br>&#123;<br>  _QWORD v0[<span class="hljs-number">12</span>]; <span class="hljs-comment">// [xsp+58h] [xbp+58h]</span><br><br>  v0[<span class="hljs-number">0</span>] = func_0;<br>  v0[<span class="hljs-number">1</span>] = func_1[<span class="hljs-number">0</span>];<br>  v0[<span class="hljs-number">2</span>] = func_2[<span class="hljs-number">0</span>];<br>  v0[<span class="hljs-number">3</span>] = func_3[<span class="hljs-number">0</span>];<br>  v0[<span class="hljs-number">4</span>] = func_4[<span class="hljs-number">0</span>];<br>  v0[<span class="hljs-number">5</span>] = func_5[<span class="hljs-number">0</span>];<br>  v0[<span class="hljs-number">6</span>] = func_6[<span class="hljs-number">0</span>];<br>  v0[<span class="hljs-number">7</span>] = func_7[<span class="hljs-number">0</span>];<br>  v0[<span class="hljs-number">8</span>] = func_8[<span class="hljs-number">0</span>];<br>  v0[<span class="hljs-number">9</span>] = func_9;<br>  v0[<span class="hljs-number">10</span>] = func_a;<br>  v0[<span class="hljs-number">11</span>] = func_b;<br>  __asm &#123; BR              X0 &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h5 id="mul-1018函数"><a href="#mul-1018函数" class="headerlink" title="mul_1018函数"></a>mul_1018函数</h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span> <span class="hljs-title function_">mul_1018</span><span class="hljs-params">()</span><br>&#123;<br>  __int64 v0; <span class="hljs-comment">// x29</span><br>  <span class="hljs-type">int</span> v1; <span class="hljs-comment">// w19</span><br><br>  <span class="hljs-keyword">if</span> ( enter_flag )<br>  &#123;<br>    *(_DWORD *)(v0 + <span class="hljs-number">48</span>) = *(<span class="hljs-type">unsigned</span> __int8 *)(*(_QWORD *)(v0 + <span class="hljs-number">72</span>) + <span class="hljs-number">1LL</span>);<span class="hljs-comment">// var_1 = *(opcode_ptr + 1)</span><br>    *(_DWORD *)(v0 + <span class="hljs-number">52</span>) = *(<span class="hljs-type">unsigned</span> __int8 *)(*(_QWORD *)(v0 + <span class="hljs-number">72</span>) + <span class="hljs-number">2LL</span>);<span class="hljs-comment">// var_2 = *(opcode_ptr + 2)</span><br>    *(_DWORD *)(v0 + <span class="hljs-number">60</span>) = *(<span class="hljs-type">unsigned</span> __int8 *)(*(_QWORD *)(v0 + <span class="hljs-number">72</span>) + <span class="hljs-number">3LL</span>);<span class="hljs-comment">// var_3 = *(opcode_ptr + 3)</span><br>    *(_DWORD *)(v0 + <span class="hljs-number">64</span>) = *(<span class="hljs-type">unsigned</span> __int8 *)(*(_QWORD *)(v0 + <span class="hljs-number">72</span>) + <span class="hljs-number">4LL</span>);<span class="hljs-comment">// var_4 = *(opcode_ptr + 4)</span><br>    *(_DWORD *)(v0 + <span class="hljs-number">68</span>) = *(_DWORD *)(v0 + <span class="hljs-number">60</span>) + (*(_DWORD *)(v0 + <span class="hljs-number">64</span>) &lt;&lt; <span class="hljs-number">8</span>);<span class="hljs-comment">// size = var_4 * 0x10 + var_3</span><br>    <span class="hljs-keyword">if</span> ( *(_DWORD *)(v0 + <span class="hljs-number">48</span>) &lt; size_l          <span class="hljs-comment">// check (var_1 &lt; size_l &amp;&amp; var_2 &lt; size_r)</span><br>      &amp;&amp; *(_DWORD *)(v0 + <span class="hljs-number">52</span>) &lt; size_r<br>      &amp;&amp; !*(_BYTE *)(buf_1 + size_r * *(_DWORD *)(v0 + <span class="hljs-number">48</span>) + *(_DWORD *)(v0 + <span class="hljs-number">52</span>))<span class="hljs-comment">// *(buf_1 + size_r * var_1 + var_2) == 0</span><br>      &amp;&amp; *(<span class="hljs-type">int</span> *)(v0 + <span class="hljs-number">68</span>) &gt; <span class="hljs-number">0</span>                  <span class="hljs-comment">// check (size &gt; 0 &amp;&amp; size &lt;= 0x600)</span><br>      &amp;&amp; *(<span class="hljs-type">int</span> *)(v0 + <span class="hljs-number">68</span>) &lt;= <span class="hljs-number">0x600</span> )<br>    &#123;<br>      *(_BYTE *)(buf_1 + size_r * *(_DWORD *)(v0 + <span class="hljs-number">48</span>) + *(_DWORD *)(v0 + <span class="hljs-number">52</span>)) = <span class="hljs-number">1</span>;<span class="hljs-comment">// *(buf_1 + size_r * var_1 + var_2) = 1, malloc_flag</span><br>      v1 = size_r * *(_DWORD *)(v0 + <span class="hljs-number">48</span>) + *(_DWORD *)(v0 + <span class="hljs-number">52</span>);<span class="hljs-comment">// v1 = size_r * var_1 + var_2</span><br>      *((_QWORD *)&amp;ptr_ + v1) = <span class="hljs-built_in">malloc</span>(*(<span class="hljs-type">int</span> *)(v0 + <span class="hljs-number">68</span>));<span class="hljs-comment">// *(ptr + size_r * var_1 + var_2) =  malloc(size)</span><br>      read(<span class="hljs-number">0</span>, *((<span class="hljs-type">void</span> **)&amp;ptr_ + size_r * *(_DWORD *)(v0 + <span class="hljs-number">48</span>) + *(_DWORD *)(v0 + <span class="hljs-number">52</span>)), *(<span class="hljs-type">int</span> *)(v0 + <span class="hljs-number">68</span>));<span class="hljs-comment">// read(0, *(ptr + size_r * var_1 + var_2), size)</span><br>      *(_QWORD *)(v0 + <span class="hljs-number">72</span>) += <span class="hljs-number">5LL</span>;              <span class="hljs-comment">// opcode ptr += 5</span><br>      JUMPOUT(<span class="hljs-number">0xED0</span>LL);                         <span class="hljs-comment">// jump table</span><br>    &#125;<br>    JUMPOUT(<span class="hljs-number">0x256C</span>LL);                          <span class="hljs-comment">// abort</span><br>  &#125;<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Abort&quot;</span>);<br>  <span class="hljs-built_in">exit</span>(<span class="hljs-number">255</span>);<br>&#125;<br></code></pre></td></tr></table></figure>



<h5 id="div-11f4"><a href="#div-11f4" class="headerlink" title="div_11f4"></a>div_11f4</h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span> <span class="hljs-title function_">div_11F4</span><span class="hljs-params">()</span><br>&#123;<br>  __int64 v0; <span class="hljs-comment">// x29</span><br><br>  <span class="hljs-keyword">if</span> ( enter_flag )<br>  &#123;                                             <span class="hljs-comment">// just tack two param</span><br>    *(_DWORD *)(v0 + <span class="hljs-number">48</span>) = *(<span class="hljs-type">unsigned</span> __int8 *)(*(_QWORD *)(v0 + <span class="hljs-number">72</span>) + <span class="hljs-number">1LL</span>);<span class="hljs-comment">// var_1 = *(opcode_ptr + 1)</span><br>    *(_DWORD *)(v0 + <span class="hljs-number">52</span>) = *(<span class="hljs-type">unsigned</span> __int8 *)(*(_QWORD *)(v0 + <span class="hljs-number">72</span>) + <span class="hljs-number">2LL</span>);<span class="hljs-comment">// var_2 = *(opcode_ptr + 2)</span><br>    <span class="hljs-keyword">if</span> ( *(_DWORD *)(v0 + <span class="hljs-number">48</span>) &lt; size_l          <span class="hljs-comment">// check (var_1 &lt; size_l &amp;&amp; var_2 &lt; size_r)</span><br>      &amp;&amp; *(_DWORD *)(v0 + <span class="hljs-number">52</span>) &lt; size_r<br>      &amp;&amp; *(_BYTE *)(buf_1 + size_r * *(_DWORD *)(v0 + <span class="hljs-number">48</span>) + *(_DWORD *)(v0 + <span class="hljs-number">52</span>)) == <span class="hljs-number">1</span><span class="hljs-comment">// check malloc flag</span><br>      &amp;&amp; *((_QWORD *)&amp;ptr_ + size_r * *(_DWORD *)(v0 + <span class="hljs-number">48</span>) + *(_DWORD *)(v0 + <span class="hljs-number">52</span>)) )<span class="hljs-comment">// check buf is not null</span><br>    &#123;<br>      <span class="hljs-built_in">free</span>(*((<span class="hljs-type">void</span> **)&amp;ptr_ + size_r * *(_DWORD *)(v0 + <span class="hljs-number">48</span>) + *(_DWORD *)(v0 + <span class="hljs-number">52</span>)));<span class="hljs-comment">// free(buf);</span><br>      *((_QWORD *)&amp;ptr_ + size_r * *(_DWORD *)(v0 + <span class="hljs-number">48</span>) + *(_DWORD *)(v0 + <span class="hljs-number">52</span>)) = <span class="hljs-number">0LL</span>;<span class="hljs-comment">// buf=0;</span><br>      *(_BYTE *)(buf_1 + size_r * *(_DWORD *)(v0 + <span class="hljs-number">48</span>) + *(_DWORD *)(v0 + <span class="hljs-number">52</span>)) = <span class="hljs-number">0</span>;<span class="hljs-comment">// set malloc flag as 0</span><br>      *(_QWORD *)(v0 + <span class="hljs-number">72</span>) += <span class="hljs-number">3LL</span>;              <span class="hljs-comment">// opcode_ptr +=3</span><br>      JUMPOUT(<span class="hljs-number">0xED0</span>LL);<br>    &#125;<br>    JUMPOUT(<span class="hljs-number">0x256C</span>LL);<br>  &#125;<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Abort&quot;</span>);<br>  <span class="hljs-built_in">exit</span>(<span class="hljs-number">255</span>);<br>&#125;<br></code></pre></td></tr></table></figure>

<h5 id="plus-1394"><a href="#plus-1394" class="headerlink" title="plus_1394"></a>plus_1394</h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span> <span class="hljs-title function_">plus_1394</span><span class="hljs-params">()</span><br>&#123;<br>  __int64 v0; <span class="hljs-comment">// x29</span><br><br>  <span class="hljs-keyword">if</span> ( enter_flag )<br>  &#123;<br>    *(_DWORD *)(v0 + <span class="hljs-number">48</span>) = *(<span class="hljs-type">unsigned</span> __int8 *)(*(_QWORD *)(v0 + <span class="hljs-number">72</span>) + <span class="hljs-number">1LL</span>);<span class="hljs-comment">// var_1 = *(opcode_ptr + 1)</span><br>    *(_DWORD *)(v0 + <span class="hljs-number">52</span>) = *(<span class="hljs-type">unsigned</span> __int8 *)(*(_QWORD *)(v0 + <span class="hljs-number">72</span>) + <span class="hljs-number">2LL</span>);<span class="hljs-comment">// var_2 = *(opcode_ptr + 2)</span><br>    *(_DWORD *)(v0 + <span class="hljs-number">56</span>) = *(<span class="hljs-type">unsigned</span> __int8 *)(*(_QWORD *)(v0 + <span class="hljs-number">72</span>) + <span class="hljs-number">3LL</span>);<span class="hljs-comment">// var_3 = *(opcode_ptr + 3)</span><br>    <span class="hljs-keyword">if</span> ( *(_DWORD *)(v0 + <span class="hljs-number">48</span>) &lt; size_l          <span class="hljs-comment">// check (var_1 &lt; size_l &amp;&amp; var_2 &lt; size_r)</span><br>      &amp;&amp; *(_DWORD *)(v0 + <span class="hljs-number">52</span>) &lt; size_r<br>      &amp;&amp; !*(_BYTE *)(buf_1 + size_r * *(_DWORD *)(v0 + <span class="hljs-number">48</span>) + *(_DWORD *)(v0 + <span class="hljs-number">52</span>))<span class="hljs-comment">// *(buf_1 + size_r * var_1 + var_2) != 0</span><br>      &amp;&amp; *(<span class="hljs-type">int</span> *)(v0 + <span class="hljs-number">56</span>) &gt; <span class="hljs-number">1</span>                  <span class="hljs-comment">// check (var_1 &gt; 1  &amp;&amp; var_2 &lt;= 4)</span><br>      &amp;&amp; *(<span class="hljs-type">int</span> *)(v0 + <span class="hljs-number">56</span>) &lt;= <span class="hljs-number">4</span> )<br>    &#123;<br>      *(_BYTE *)(buf_1 + size_r * *(_DWORD *)(v0 + <span class="hljs-number">48</span>) + *(_DWORD *)(v0 + <span class="hljs-number">52</span>)) = *(_DWORD *)(v0 + <span class="hljs-number">56</span>);<span class="hljs-comment">// *(buf_1 + size_r * var_1 + var_2) = var_3</span><br>      *(_QWORD *)(v0 + <span class="hljs-number">72</span>) += <span class="hljs-number">4LL</span>;              <span class="hljs-comment">// opcode ptr += 4</span><br>      JUMPOUT(<span class="hljs-number">0xED0</span>LL);<br>    &#125;<br>    JUMPOUT(<span class="hljs-number">0x256C</span>LL);<br>  &#125;<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Abort&quot;</span>);<br>  <span class="hljs-built_in">exit</span>(<span class="hljs-number">255</span>);<br>&#125;<br></code></pre></td></tr></table></figure>



<h5 id="sub-14d4"><a href="#sub-14d4" class="headerlink" title="_sub_14d4"></a>_sub_14d4</h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span> <span class="hljs-title function_">sub_14D4</span><span class="hljs-params">()</span><br>&#123;<br>  __int64 v0; <span class="hljs-comment">// x29</span><br><br>  <span class="hljs-keyword">if</span> ( enter_flag )<br>  &#123;<br>    *(_DWORD *)(v0 + <span class="hljs-number">48</span>) = *(<span class="hljs-type">unsigned</span> __int8 *)(*(_QWORD *)(v0 + <span class="hljs-number">72</span>) + <span class="hljs-number">1LL</span>);<span class="hljs-comment">// var_1 = *(opcode_ptr + 1)</span><br>    *(_DWORD *)(v0 + <span class="hljs-number">52</span>) = *(<span class="hljs-type">unsigned</span> __int8 *)(*(_QWORD *)(v0 + <span class="hljs-number">72</span>) + <span class="hljs-number">2LL</span>);<span class="hljs-comment">// var_2 = *(opcode_ptr + 2)</span><br>    <span class="hljs-keyword">if</span> ( *(_DWORD *)(v0 + <span class="hljs-number">48</span>) &lt; size_l          <span class="hljs-comment">// check (var_1 &lt; size_l &amp;&amp; var_2 &lt; size_r)</span><br>      &amp;&amp; *(_DWORD *)(v0 + <span class="hljs-number">52</span>) &lt; size_r<br>      &amp;&amp; *(<span class="hljs-type">unsigned</span> __int8 *)(buf_1 + size_r * *(_DWORD *)(v0 + <span class="hljs-number">48</span>) + *(_DWORD *)(v0 + <span class="hljs-number">52</span>)) &gt; <span class="hljs-number">1u</span><br>      &amp;&amp; *(<span class="hljs-type">unsigned</span> __int8 *)(buf_1 + size_r * *(_DWORD *)(v0 + <span class="hljs-number">48</span>) + *(_DWORD *)(v0 + <span class="hljs-number">52</span>)) &lt;= <span class="hljs-number">4u</span> )<span class="hljs-comment">// check (var_1 &gt; 1  &amp;&amp; var_2 &lt;= 4)</span><br>    &#123;<br>      *(_BYTE *)(buf_1 + size_r * *(_DWORD *)(v0 + <span class="hljs-number">48</span>) + *(_DWORD *)(v0 + <span class="hljs-number">52</span>)) = <span class="hljs-number">0</span>;<span class="hljs-comment">// *(buf_1 + size_r * var_1 + var_2) = 0</span><br>      *(_QWORD *)(v0 + <span class="hljs-number">72</span>) += <span class="hljs-number">3LL</span>;              <span class="hljs-comment">// opcode ptr += 3</span><br>      JUMPOUT(<span class="hljs-number">0xED0</span>LL);<br>    &#125;<br>    JUMPOUT(<span class="hljs-number">0x256C</span>LL);<br>  &#125;<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Abort&quot;</span>);<br>  <span class="hljs-built_in">exit</span>(<span class="hljs-number">255</span>);<br>&#125;<br></code></pre></td></tr></table></figure>





<h5 id="w-1620"><a href="#w-1620" class="headerlink" title="w_1620"></a>w_1620</h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span> <span class="hljs-title function_">w_1620</span><span class="hljs-params">()</span><br>&#123;<br>  __int64 v0; <span class="hljs-comment">// x29</span><br>  <span class="hljs-type">char</span> v1; <span class="hljs-comment">// w0</span><br><br>  <span class="hljs-keyword">if</span> ( enter_flag )<br>  &#123;<br>    <span class="hljs-keyword">if</span> ( vertical &gt; <span class="hljs-number">0</span><br>      &amp;&amp; *(_BYTE *)(base_ + (vertical - <span class="hljs-number">1</span>) * size_r + horizontal) != <span class="hljs-number">1</span><br>      &amp;&amp; *(_BYTE *)(base_ + (vertical - <span class="hljs-number">1</span>) * size_r + horizontal) != <span class="hljs-number">4</span> )<br>    &#123;<br>      *(_BYTE *)(base_ + vertical * size_r + horizontal) = <span class="hljs-number">0</span>;<br>      <span class="hljs-keyword">if</span> ( *(_BYTE *)(base_ + (vertical - <span class="hljs-number">1</span>) * size_r + horizontal) )<br>      &#123;<br>        <span class="hljs-keyword">if</span> ( *(_BYTE *)(base_ + (vertical - <span class="hljs-number">1</span>) * size_r + horizontal) == <span class="hljs-number">2</span><br>          || *(_BYTE *)(base_ + (vertical - <span class="hljs-number">1</span>) * size_r + horizontal) == <span class="hljs-number">3</span> )<br>        &#123;<br>          *(_BYTE *)(base_ + (vertical - <span class="hljs-number">2</span>) * size_r + horizontal) = <span class="hljs-number">5</span>;<br>          vertical -= <span class="hljs-number">2</span>;<br>        &#125;<br>      &#125;<br>      <span class="hljs-keyword">else</span><br>      &#123;<br>        *(_BYTE *)(base_ + --vertical * size_r + horizontal) = <span class="hljs-number">5</span>;<br>      &#125;<br>    &#125;<br>    v1 = dword_14080++;<br>    *(_BYTE *)(qword_14090 + vertical * size_r + horizontal) = v1;<br>    ++*(_QWORD *)(v0 + <span class="hljs-number">72</span>);                     <span class="hljs-comment">// opcode_ptr ++</span><br>    JUMPOUT(<span class="hljs-number">0xED0</span>LL);<br>  &#125;<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Abort&quot;</span>);<br>  <span class="hljs-built_in">exit</span>(<span class="hljs-number">255</span>);<br>&#125;<br></code></pre></td></tr></table></figure>



<h5 id="s-1990"><a href="#s-1990" class="headerlink" title="s_1990"></a>s_1990</h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span> <span class="hljs-title function_">s_1990</span><span class="hljs-params">()</span><br>&#123;<br>  __int64 v0; <span class="hljs-comment">// x29</span><br>  <span class="hljs-type">char</span> v1; <span class="hljs-comment">// w0</span><br><br>  <span class="hljs-keyword">if</span> ( enter_flag )<br>  &#123;<br>    <span class="hljs-keyword">if</span> ( size_l - <span class="hljs-number">1</span> &gt; vertical<br>      &amp;&amp; *(_BYTE *)(base_ + (vertical + <span class="hljs-number">1</span>) * size_r + horizontal) != <span class="hljs-number">1</span><br>      &amp;&amp; *(_BYTE *)(base_ + (vertical + <span class="hljs-number">1</span>) * size_r + horizontal) != <span class="hljs-number">4</span> )<br>    &#123;<br>      *(_BYTE *)(base_ + vertical * size_r + horizontal) = <span class="hljs-number">0</span>;<br>      <span class="hljs-keyword">if</span> ( *(_BYTE *)(base_ + (vertical + <span class="hljs-number">1</span>) * size_r + horizontal) )<br>      &#123;<br>        <span class="hljs-keyword">if</span> ( *(_BYTE *)(base_ + (vertical + <span class="hljs-number">1</span>) * size_r + horizontal) == <span class="hljs-number">2</span><br>          || *(_BYTE *)(base_ + (vertical + <span class="hljs-number">1</span>) * size_r + horizontal) == <span class="hljs-number">3</span> )<br>        &#123;<br>          *(_BYTE *)(base_ + (vertical + <span class="hljs-number">2</span>) * size_r + horizontal) = <span class="hljs-number">5</span>;<br>          vertical += <span class="hljs-number">2</span>;<br>        &#125;<br>      &#125;<br>      <span class="hljs-keyword">else</span><br>      &#123;<br>        *(_BYTE *)(base_ + ++vertical * size_r + horizontal) = <span class="hljs-number">5</span>;<br>      &#125;<br>    &#125;<br>    v1 = dword_14080++;<br>    *(_BYTE *)(qword_14090 + vertical * size_r + horizontal) = v1;<br>    ++*(_QWORD *)(v0 + <span class="hljs-number">72</span>);                     <span class="hljs-comment">// opcode_ptr ++</span><br>    JUMPOUT(<span class="hljs-number">0xED0</span>LL);<br>  &#125;<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Abort&quot;</span>);<br>  <span class="hljs-built_in">exit</span>(<span class="hljs-number">255</span>);<br>&#125;<br></code></pre></td></tr></table></figure>





<h5 id="a-1d10"><a href="#a-1d10" class="headerlink" title="a_1d10"></a>a_1d10</h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span> <span class="hljs-title function_">a_1d10</span><span class="hljs-params">()</span><br>&#123;<br>  __int64 v0; <span class="hljs-comment">// x29</span><br>  <span class="hljs-type">char</span> v1; <span class="hljs-comment">// w0</span><br><br>  <span class="hljs-keyword">if</span> ( enter_flag )<br>  &#123;<br>    <span class="hljs-keyword">if</span> ( horizontal &gt; <span class="hljs-number">0</span><br>      &amp;&amp; *(_BYTE *)(base_ + vertical * size_r + horizontal - <span class="hljs-number">1LL</span>) != <span class="hljs-number">1</span><br>      &amp;&amp; *(_BYTE *)(base_ + vertical * size_r + horizontal - <span class="hljs-number">1LL</span>) != <span class="hljs-number">4</span> )<br>    &#123;<br>      *(_BYTE *)(base_ + vertical * size_r + horizontal) = <span class="hljs-number">0</span>;<br>      <span class="hljs-keyword">if</span> ( *(_BYTE *)(base_ + vertical * size_r + horizontal - <span class="hljs-number">1LL</span>) )<br>      &#123;<br>        <span class="hljs-keyword">if</span> ( *(_BYTE *)(base_ + vertical * size_r + horizontal - <span class="hljs-number">1LL</span>) == <span class="hljs-number">2</span><br>          || *(_BYTE *)(base_ + vertical * size_r + horizontal - <span class="hljs-number">1LL</span>) == <span class="hljs-number">3</span> )<br>        &#123;<br>          *(_BYTE *)(base_ + vertical * size_r + horizontal - <span class="hljs-number">2LL</span>) = <span class="hljs-number">5</span>;<br>          horizontal -= <span class="hljs-number">2</span>;<br>        &#125;<br>      &#125;<br>      <span class="hljs-keyword">else</span><br>      &#123;<br>        *(_BYTE *)(base_ + vertical * size_r + horizontal-- - <span class="hljs-number">1LL</span>) = <span class="hljs-number">5</span>;<br>      &#125;<br>    &#125;<br>    v1 = dword_14080++;<br>    *(_BYTE *)(qword_14090 + vertical * size_r + horizontal) = v1;<br>    ++*(_QWORD *)(v0 + <span class="hljs-number">72</span>);                     <span class="hljs-comment">// opcode_ptr ++</span><br>    JUMPOUT(<span class="hljs-number">0xED0</span>LL);                           <span class="hljs-comment">// loop jump</span><br>  &#125;<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Abort&quot;</span>);<br>  <span class="hljs-built_in">exit</span>(<span class="hljs-number">255</span>);<br>&#125;<br></code></pre></td></tr></table></figure>



<h5 id="d-2080"><a href="#d-2080" class="headerlink" title="d_2080"></a>d_2080</h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span> <span class="hljs-title function_">d_2080</span><span class="hljs-params">()</span><br>&#123;<br>  __int64 v0; <span class="hljs-comment">// x29</span><br>  <span class="hljs-type">char</span> v1; <span class="hljs-comment">// w0</span><br><br>  <span class="hljs-keyword">if</span> ( enter_flag )<br>  &#123;<br>    <span class="hljs-keyword">if</span> ( size_r - <span class="hljs-number">1</span> &gt; horizontal<br>      &amp;&amp; *(_BYTE *)(base_ + vertical * size_r + horizontal + <span class="hljs-number">1LL</span>) != <span class="hljs-number">1</span><br>      &amp;&amp; *(_BYTE *)(base_ + vertical * size_r + horizontal + <span class="hljs-number">1LL</span>) != <span class="hljs-number">4</span> )<br>    &#123;<br>      *(_BYTE *)(base_ + vertical * size_r + horizontal) = <span class="hljs-number">0</span>;<br>      <span class="hljs-keyword">if</span> ( *(_BYTE *)(base_ + vertical * size_r + horizontal + <span class="hljs-number">1LL</span>) )<br>      &#123;<br>        <span class="hljs-keyword">if</span> ( *(_BYTE *)(base_ + vertical * size_r + horizontal + <span class="hljs-number">1LL</span>) == <span class="hljs-number">2</span><br>          || *(_BYTE *)(base_ + vertical * size_r + horizontal + <span class="hljs-number">1LL</span>) == <span class="hljs-number">3</span> )<br>        &#123;<br>          *(_BYTE *)(base_ + vertical * size_r + horizontal + <span class="hljs-number">2LL</span>) = <span class="hljs-number">5</span>;<br>          horizontal += <span class="hljs-number">2</span>;<br>        &#125;<br>      &#125;<br>      <span class="hljs-keyword">else</span><br>      &#123;<br>        *(_BYTE *)(base_ + vertical * size_r + horizontal++ + <span class="hljs-number">1LL</span>) = <span class="hljs-number">5</span>;<br>      &#125;<br>    &#125;<br>    v1 = dword_14080++;<br>    *(_BYTE *)(qword_14090 + vertical * size_r + horizontal) = v1;<br>    ++*(_QWORD *)(v0 + <span class="hljs-number">72</span>);                     <span class="hljs-comment">// opcode_ptr ++</span><br>    JUMPOUT(<span class="hljs-number">0xED0</span>LL);                           <span class="hljs-comment">// abort</span><br>  &#125;<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Abort&quot;</span>);<br>  <span class="hljs-built_in">exit</span>(<span class="hljs-number">255</span>);<br>&#125;<br></code></pre></td></tr></table></figure>

<h5 id="print-2400"><a href="#print-2400" class="headerlink" title="print_2400"></a>print_2400</h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span> <span class="hljs-title function_">print_2400</span><span class="hljs-params">()</span><br>&#123;<br>  __int64 v0; <span class="hljs-comment">// x29</span><br><br>  <span class="hljs-keyword">if</span> ( enter_flag )<br>  &#123;<br>    *(_DWORD *)(v0 + <span class="hljs-number">36</span>) = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">for</span> ( *(_DWORD *)(v0 + <span class="hljs-number">36</span>) = <span class="hljs-number">0</span>; *(_DWORD *)(v0 + <span class="hljs-number">36</span>) &lt; size_l * size_r - <span class="hljs-number">1</span>; ++*(_DWORD *)(v0 + <span class="hljs-number">36</span>) )<br>    &#123;<br>      *(_DWORD *)(v0 + <span class="hljs-number">40</span>) = *(_DWORD *)(v0 + <span class="hljs-number">36</span>) / size_r;<br>      *(_DWORD *)(v0 + <span class="hljs-number">44</span>) = *(_DWORD *)(v0 + <span class="hljs-number">36</span>) - size_r * *(_DWORD *)(v0 + <span class="hljs-number">40</span>);<br>      <span class="hljs-keyword">if</span> ( *(_BYTE *)(base_ + *(<span class="hljs-type">int</span> *)(v0 + <span class="hljs-number">36</span>)) == <span class="hljs-number">1</span> )<br>      &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;pos:%d,%d\n&quot;</span>, *(<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> *)(v0 + <span class="hljs-number">40</span>), *(<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> *)(v0 + <span class="hljs-number">44</span>));<br>        <span class="hljs-built_in">puts</span>(*((<span class="hljs-type">const</span> <span class="hljs-type">char</span> **)&amp;ptr_ + *(<span class="hljs-type">int</span> *)(v0 + <span class="hljs-number">36</span>)));<br>      &#125;<br>    &#125;<br>    ++*(_QWORD *)(v0 + <span class="hljs-number">72</span>);                     <span class="hljs-comment">// opcode_ptr ++</span><br>    JUMPOUT(<span class="hljs-number">0xED0</span>LL);<br>  &#125;<br>  JUMPOUT(<span class="hljs-number">0x25B8</span>LL);<br>&#125;<br></code></pre></td></tr></table></figure>

<h5 id="get-next"><a href="#get-next" class="headerlink" title="get_next"></a>get_next</h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span> <span class="hljs-title function_">sub_2514</span><span class="hljs-params">()</span><br>&#123;<br>  __int64 v0; <span class="hljs-comment">// x29</span><br><br>  ++*(_QWORD *)(v0 + <span class="hljs-number">0x48</span>);                     <span class="hljs-comment">// opcode_ptr ++</span><br>  JUMPOUT(<span class="hljs-number">0xED0</span>LL);<br>&#125;<br></code></pre></td></tr></table></figure>

<h5 id="exit"><a href="#exit" class="headerlink" title="exit_"></a>exit_</h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span> __noreturn <span class="hljs-title function_">exit_</span><span class="hljs-params">()</span><br>&#123;<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Finish&quot;</span>);<br>  <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>&#125;<br></code></pre></td></tr></table></figure>

<p>I dubugging this program, I found just input ‘awdsp+-*&#x2F;‘ making the program aborted.</p>
<p>So input map followings:</p>
<p>set breaking pinter: b *(0x5500000000 + 0xED0 ) </p>
<p>a: 0x5500001d10</p>
<p>w:0x5500001620</p>
<p>d: 0x5500002080</p>
<p>s: 0x5500001990</p>
<p>+: 0x5500001394</p>
<p>-: 0x55000014d4</p>
<p>*: 0x5500001018</p>
<p>&#x2F;: 0x55000011f4</p>
<p>p: 0x5500002400</p>
<p>enter_flag: 0x5500014098</p>
<p>基本上能翻译为c伪装代码的就这几个函数，但是，enter_flag不知道该怎么设置为0。逻辑都进不去@_@。上面这个是在比赛那天分析的一部分。</p>
<h4 id="复现"><a href="#复现" class="headerlink" title="复现"></a>复现</h4><p>该程序存在一些函数跳转表，在parse函数下，ida反编译如下:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span> <span class="hljs-title function_">sub_E14</span><span class="hljs-params">()</span><br>&#123;<br>  _QWORD v0[<span class="hljs-number">12</span>]; <span class="hljs-comment">// [xsp+58h] [xbp+58h]</span><br><br>  v0[<span class="hljs-number">0</span>] = func_0;<br>  v0[<span class="hljs-number">1</span>] = func_1[<span class="hljs-number">0</span>];<br>  v0[<span class="hljs-number">2</span>] = func_2[<span class="hljs-number">0</span>];<br>  v0[<span class="hljs-number">3</span>] = func_3[<span class="hljs-number">0</span>];<br>  v0[<span class="hljs-number">4</span>] = func_4[<span class="hljs-number">0</span>];<br>  v0[<span class="hljs-number">5</span>] = func_5[<span class="hljs-number">0</span>];<br>  v0[<span class="hljs-number">6</span>] = func_6[<span class="hljs-number">0</span>];<br>  v0[<span class="hljs-number">7</span>] = func_7[<span class="hljs-number">0</span>];<br>  v0[<span class="hljs-number">8</span>] = func_8[<span class="hljs-number">0</span>];<br>  v0[<span class="hljs-number">9</span>] = func_9;<br>  v0[<span class="hljs-number">10</span>] = func_a;<br>  v0[<span class="hljs-number">11</span>] = func_b;<br>  __asm &#123; BR              X0 &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>当时我还以为是寄存器的初始化，一直搞不明白它是怎么跳的。通过看汇编代码，通过下断点进行动态分析:</p>
<p><code>b *(0x5500000000 + 0xe14)</code> 如下:</p>
<p>sub_E14</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">.text:0000000000000E14                 STP             X29, X30, [SP,#var_C0]!<br>.text:0000000000000E18                 MOV             X29, SP<br>.text:0000000000000E1C                 STR             X19, [SP,#0xC0+var_B0]<br>.text:0000000000000E20                 ADRP            X0, #__stack_chk_guard_ptr@PAGE<br>.text:0000000000000E24                 LDR             X0, [X0,#__stack_chk_guard_ptr@PAGEOFF]; 获取只读页基址,<br>.text:0000000000000E28                 LDR             X1, [X0] ; 获取cannary值<br>.text:0000000000000E2C                 STR             X1, [X29,#0xC0+var_8]; 储存cannary值在堆栈里<br>.text:0000000000000E30                 MOV             X1, #0<br>.text:0000000000000E34                 ADRP            X0, #reg_1@PAGE ; 获取data段基址，这里存放的是函数跳转表<br>.text:0000000000000E38                 ADD             X1, X0, #reg_1@PAGEOFF ; x1, x0, #0x10<br>.text:0000000000000E3C                 ADD             X0, X29, #0x58 ; 开始从虚函数表中赋值到堆栈中<br>.text:0000000000000E40                 LDP             X2, X3, [X1]; 加载第一个函数地址, 0x5500000eb8<br>.text:0000000000000E44                 STP             X2, X3, [X0]; 赋值到堆栈中<br>.text:0000000000000E48                 LDP             X2, X3, [X1,#0x10] ; 加载第二个函数地址, 0x55000011f4<br>.text:0000000000000E4C                 STP             X2, X3, [X0,#0x10]<br>.text:0000000000000E50                 LDP             X2, X3, [X1,#0x20] ; 加载第三个函数地址, 0x55000014d4<br>.text:0000000000000E54                 STP             X2, X3, [X0,#0x20]<br>.text:0000000000000E58                 LDP             X2, X3, [X1,#0x30] ; 加载第三个函数地址, 0x5500001990<br>.text:0000000000000E5C                 STP             X2, X3, [X0,#0x30]<br>.text:0000000000000E60                 LDP             X2, X3, [X1,#0x40] ; 加载第四个函数地址, 0x5500002080<br>.text:0000000000000E64                 STP             X2, X3, [X0,#0x40]<br>.text:0000000000000E68                 LDP             X1, X2, [X1,#0x50] ; 加载第四个函数地址, 0x5500002514<br>.text:0000000000000E6C                 STP             X1, X2, [X0,#0x50]<br>.text:0000000000000E70                 ADRP            X0, #off_13F98@PAGE ; 获取堆栈基址<br>.text:0000000000000E74                 LDR             X0, [X0,#off_13F98@PAGEOFF] ; 通过堆栈某变量获取在bss段储存输入的指针变量<br>.text:0000000000000E78                 LDR             X0, [X0] ; 通过该变量获取储存输入的堆指针<br>.text:0000000000000E7C                 STR             X0, [X29,#0xC0+var_78] ; 将该指针储存在堆栈 var_78 处<br>.text:0000000000000E80                 LDR             X0, [X29,#0xC0+var_78] ;<br>.text:0000000000000E84                 STR             X0, [X29,#0xC0+var_70] ; 将该指针储存在堆栈 var_78 处<br>.text:0000000000000E88                 LDR             X0, [X29,#0xC0+var_78] ;<br>.text:0000000000000E8C                 LDRB            W0, [X0] ; 取出输入的地一个字节<br>.text:0000000000000E90                 MOV             W1, W0 ;将第一个字节放在w1中<br>.text:0000000000000E94                 ADRP            X0, #off_13FE8@PAGE ; 获取只读页的base address<br>.text:0000000000000E98                 LDR             X0, [X0,#off_13FE8@PAGEOFF] ;opcode跳转表 0x5500003770 ◂— 0xb0000000a<br>.text:0000000000000E9C                 SXTW            X1, W1 ;拓展为64位, 这里还是输入数据的第一个字节<br>.text:0000000000000EA0                 LDR             W0, [X0,X1,LSL#2]; ；x0 + x1*4计算出来的地址读取一字节到w0中，这里x1是我们输入的一字节, x0就是opcode跳转表地址<br>.text:0000000000000EA4                 SXTW            X0, W0  # 拓展为64位<br>.text:0000000000000EA8                 LSL             X0, X0, #3 ;左移3位<br>.text:0000000000000EAC                 ADD             X1, X29, #0x58 ; 获取之前加载的函数跳转表<br>.text:0000000000000EB0                 LDR             X0, [X1,X0] ; 计算通过获取[x1 + x0]得到真正的函数地址<br>.text:0000000000000EB4                 B               loc_ED0<br></code></pre></td></tr></table></figure>



<p>loc_ED0</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">.text:0000000000000ED0 loc_ED0                                 ; CODE XREF: parse+A0↑j<br>.text:0000000000000ED0                                         ; parse+200↓j ...<br>.text:0000000000000ED0                 BR              X0 ; 跳到x0指向的地址<br></code></pre></td></tr></table></figure>



<p>函数跳转表如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">.data:0000000000014010 func_0          DCQ init_program        ; DATA XREF: parse+20↑o<br>.data:0000000000014010                                         ; parse+24↑o<br>.data:0000000000014018 func_1          DCQ mul_1018<br>.data:0000000000014020 func_2          DCQ div_11F4<br>.data:0000000000014028 func_3          DCQ plus_1394<br>.data:0000000000014030 func_4          DCQ _sub_14d4<br>.data:0000000000014038 func_5          DCQ w_1620<br>.data:0000000000014040 func_6          DCQ s_1990<br>.data:0000000000014048 func_7          DCQ a_1d10<br>.data:0000000000014050 func_8          DCQ d_2080<br>.data:0000000000014058 func_9          DCQ print_2400<br>.data:0000000000014060 func_a          DCQ exit_<br>.data:0000000000014068 func_b          DCQ get_next<br></code></pre></td></tr></table></figure>





<p>opcode 跳转表如下: 0x5500003770</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">0A 00 00 00 0B 00 00 00  0B 00 00 00 0B 00 00 00 ; 00   [00 -&gt; exit_]<br>0B 00 00 00 0B 00 00 00  0B 00 00 00 0B 00 00 00<br>0B 00 00 00 0B 00 00 00  0B 00 00 00 0B 00 00 00 ; 08<br>0B 00 00 00 0B 00 00 00  0B 00 00 00 0B 00 00 00 <br>0B 00 00 00 0B 00 00 00  0B 00 00 00 0B 00 00 00 ; 10<br>0B 00 00 00 0B 00 00 00  0B 00 00 00 0B 00 00 00<br>0B 00 00 00 0B 00 00 00  0B 00 00 00 0B 00 00 00 ; 18<br>0B 00 00 00 0B 00 00 00  0B 00 00 00 0B 00 00 00<br>0B 00 00 00 0B 00 00 00  0B 00 00 00 0B 00 00 00 ; 20<br>0B 00 00 00 0B 00 00 00  0B 00 00 00 0B 00 00 00<br>0B 00 00 00 0B 00 00 00  01 00 00 00 03 00 00 00 ; 28   [2a -&gt; mul_1018, 2b -&gt; plus_1394]<br>0B 00 00 00 04 00 00 00  0B 00 00 00 02 00 00 00 ;      [2d -&gt; _sub_14d4, 2f -&gt; div_11F4]<br>0B 00 00 00 0B 00 00 00  0B 00 00 00 0B 00 00 00 ; 30<br>0B 00 00 00 0B 00 00 00  0B 00 00 00 0B 00 00 00 <br>0B 00 00 00 0B 00 00 00  0B 00 00 00 0B 00 00 00 ; 38<br>0B 00 00 00 0B 00 00 00  0B 00 00 00 0B 00 00 00<br>0B 00 00 00 0B 00 00 00  0B 00 00 00 0B 00 00 00 ; 40<br>0B 00 00 00 0B 00 00 00  0B 00 00 00 0B 00 00 00<br>0B 00 00 00 0B 00 00 00  0B 00 00 00 0B 00 00 00 ; 48<br>0B 00 00 00 00 00 00 00  0B 00 00 00 0B 00 00 00        [4d -&gt; init_program]<br>0B 00 00 00 0B 00 00 00  0B 00 00 00 0B 00 00 00 ; 50<br>0B 00 00 00 0B 00 00 00  0B 00 00 00 0B 00 00 00<br>0B 00 00 00 0B 00 00 00  0B 00 00 00 0B 00 00 00 ; 58<br>0B 00 00 00 0B 00 00 00  0B 00 00 00 0B 00 00 00<br>0B 00 00 00 07 00 00 00  0B 00 00 00 0B 00 00 00 ; 60   [61 -&gt; a_1d10]<br>08 00 00 00 0B 00 00 00  0B 00 00 00 0B 00 00 00        [64 -&gt; d_2080]<br>0B 00 00 00 0B 00 00 00  0B 00 00 00 0B 00 00 00 ; 68<br>0B 00 00 00 0B 00 00 00  0B 00 00 00 0B 00 00 00<br>09 00 00 00 0B 00 00 00  0B 00 00 00 06 00 00 00 ; 70   [70 -&gt; print_2400, 73 -&gt; s_1990]<br>0B 00 00 00 0B 00 00 00  0B 00 00 00 05 00 00 00        [77 -&gt; w_1620]<br>0B 00 00 00 0B 00 00 00  0B 00 00 00 0B 00 00 00 ; 78<br>0B 00 00 00 0B 00 00 00  0B 00 00 00 0B 00 00 00 <br>0B 00 00 00 0B 00 00 00  0B 00 00 00 0B 00 00 00 ; 80<br>0B 00 00 00 0B 00 00 00  0B 00 00 00 0B 00 00 00<br>0B 00 00 00 0B 00 00 00  0B 00 00 00 0B 00 00 00 ; 88<br>0B 00 00 00 0B 00 00 00  0B 00 00 00 0B 00 00 00<br>0B 00 00 00 0B 00 00 00  0B 00 00 00 0B 00 00 00 ; 90<br>0B 00 00 00 0B 00 00 00  0B 00 00 00 0B 00 00 00<br>0B 00 00 00 0B 00 00 00  0B 00 00 00 0B 00 00 00 ; 98<br>0B 00 00 00 0B 00 00 00  0B 00 00 00 0B 00 00 00<br>0B 00 00 00 0B 00 00 00  0B 00 00 00 0B 00 00 00 ; a0<br>0B 00 00 00 0B 00 00 00  0B 00 00 00 0B 00 00 00<br>0B 00 00 00 0B 00 00 00  0B 00 00 00 0B 00 00 00 ; a8<br>0B 00 00 00 0B 00 00 00  0B 00 00 00 0B 00 00 00<br>0B 00 00 00 0B 00 00 00  0B 00 00 00 0B 00 00 00 ; b0<br>0B 00 00 00 0B 00 00 00  0B 00 00 00 0B 00 00 00<br>0B 00 00 00 0B 00 00 00  0B 00 00 00 0B 00 00 00 ; b8<br>0B 00 00 00 0B 00 00 00  0B 00 00 00 0B 00 00 00<br>0B 00 00 00 0B 00 00 00  0B 00 00 00 0B 00 00 00 ; c0<br>0B 00 00 00 0B 00 00 00  0B 00 00 00 0B 00 00 00<br>0B 00 00 00 0B 00 00 00  0B 00 00 00 0B 00 00 00 ; c8<br>0B 00 00 00 0B 00 00 00  0B 00 00 00 0B 00 00 00<br>0B 00 00 00 0B 00 00 00  0B 00 00 00 0B 00 00 00 ; d0<br>0B 00 00 00 0B 00 00 00  0B 00 00 00 0B 00 00 00<br>0B 00 00 00 0B 00 00 00  0B 00 00 00 0B 00 00 00 ; d8<br>0B 00 00 00 0B 00 00 00  0B 00 00 00 0B 00 00 00<br>0B 00 00 00 0B 00 00 00  0B 00 00 00 0B 00 00 00 ; e0<br>0B 00 00 00 0B 00 00 00  0B 00 00 00 0B 00 00 00<br>0B 00 00 00 0B 00 00 00  0B 00 00 00 0B 00 00 00 ; e8<br>0B 00 00 00 0B 00 00 00  0B 00 00 00 0B 00 00 00<br>0B 00 00 00 0B 00 00 00  0B 00 00 00 0B 00 00 00 ; f0<br>0B 00 00 00 0B 00 00 00  0B 00 00 00 0B 00 00 00<br>0B 00 00 00 0B 00 00 00  0B 00 00 00 0B 00 00 00 ; f8<br>0B 00 00 00 0B 00 00 00  0B 00 00 00 0B 00 00 00<br></code></pre></td></tr></table></figure>



<p>经过调试, 对应opcode * 4之后跳转如下:</p>
<p>通过分析，程序采用 function_table[opcode_table[opcode * 4]]</p>
<p>所以对应查找出opcode对应函数如下:</p>
<p>00 -&gt; exit_</p>
<p>2a -&gt; mul_1018</p>
<p>2b -&gt; plus_1394</p>
<p>2d -&gt; _sub_14d4</p>
<p>2f -&gt; div_11F4</p>
<p>4d -&gt; init_program (EB8)</p>
<p>61 -&gt; a_1d10</p>
<p>64 -&gt; d_2080</p>
<p>70 -&gt; print_2400</p>
<p>73 -&gt; s_1990</p>
<p>77 -&gt; w_1620</p>
<p>而其他的opcode在opcode_table[opcode * 4]之后，都会去执行 get_next (2514) 函数</p>
<p>通过逆向分析，程序进行逻辑交互，则必须要的使enter_flag(14098)变量赋值为1才能进行交互，不然都是执行abort，然而init_program这个分支是不能伪代码反编译的，应该加了花指令，在ghidra下直接不能反编译为汇编。这只能得看汇编了。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">.text:0000000000000EB8 init_program                            ; DATA XREF: .data:func_0↓o<br>.text:0000000000000EB8                 ADRP            X0, #off_13F90@PAGE ; 获取bss段base adreess<br>.text:0000000000000EBC                 LDR             X0, [X0,#off_13F90@PAGEOFF] ; 获取enter_flag变量地址<br>.text:0000000000000EC0                 LDR             W0, [X0] ; 获取enter_flag变量的值<br>.text:0000000000000EC4                 CMP             W0, #0 ; 与0做对比，若等于0跳到 loc_ED4处,初始化的时候,enter_flag值是为0的<br>.text:0000000000000EC8                 B.NE            loc_2564<br>.text:0000000000000ECC                 B               loc_ED4<br></code></pre></td></tr></table></figure>



<p>跳到loc_ED4，这里也没办法反编译，又只能看汇编QAQ。。。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">.text:0000000000000ED4 loc_ED4                                 ; CODE XREF: parse+B8↑j<br>.text:0000000000000ED4                 LDR             X0, [X29,#0xC0+var_78] ; 获取输入数据的指针 opcode_ptr = buf_ptr<br>.text:0000000000000ED8                 ADD             X0, X0, #1 ; opcode_ptr += 1<br>.text:0000000000000EDC                 LDRB            W0, [X0]; 获取opcode_ptr指向的该值<br>.text:0000000000000EE0                 MOV             W1, W0 ; 赋值给w1<br>.text:0000000000000EE4                 ADRP            X0, #off_13FD8@PAGE <br>.text:0000000000000EE8                 LDR             X0, [X0,#off_13FD8@PAGEOFF] ; 获取对应变量size_l (1409C)<br>.text:0000000000000EEC                 STR             W1, [X0] ; 将opcde_ptr对应的一字节赋值给size_l<br>.text:0000000000000EF0                 LDR             X0, [X29,#0xC0+var_78] ; 重新获取输入数据指针, 相当于 opcode_ptr = buf_ptr<br>.text:0000000000000EF4                 ADD             X0, X0, #2 ; opcode_ptr += 2<br>.text:0000000000000EF8                 LDRB            W0, [X0] ; 获取输入数据的第3个值<br>.text:0000000000000EFC                 MOV             W1, W0 ; 赋值给w1<br>.text:0000000000000F00                 ADRP            X0, #off_13F68@PAGE<br>.text:0000000000000F04                 LDR             X0, [X0,#off_13F68@PAGEOFF] ; 获取对应变量size_r (140A0)<br>.text:0000000000000F08                 STR             W1, [X0] ; 将输入数据的第3个值赋值给该变量<br>.text:0000000000000F0C                 ADRP            X0, #off_13FD8@PAGE<br>.text:0000000000000F10                 LDR             X0, [X0,#off_13FD8@PAGEOFF] ; 获取变量size_l地址<br>.text:0000000000000F14                 LDR             W0, [X0] ; 获取size_l中的单字节数据<br>.text:0000000000000F18                 CMP             W0, #0x10 ; 判断size_l == 0x10<br>.text:0000000000000F1C                 B.GT            loc_256C ; 大于的话，退出<br>.text:0000000000000F20                 ADRP            X0, #off_13F68@PAGE<br>.text:0000000000000F24                 LDR             X0, [X0,#off_13F68@PAGEOFF] ; 获取size_r地址<br>.text:0000000000000F28                 LDR             W0, [X0] ; 获取size_r中的单字节数据<br>.text:0000000000000F2C                 CMP             W0, #0x10 ; 判断size_r == 0x10<br>.text:0000000000000F30                 B.GT            loc_256C  ; 大于的话，退出<br>.text:0000000000000F34                 ADRP            X0, #off_13FD8@PAGE<br>.text:0000000000000F38                 LDR             X0, [X0,#off_13FD8@PAGEOFF] ; 获取变量size_l地址<br>.text:0000000000000F3C                 LDR             W0, [X0]  ; 获取size_l中的单字节数据<br>.text:0000000000000F40                 CMP             W0, #3  ; size_l与3做比较，若小于等于3，退出<br>.text:0000000000000F44                 B.LE            loc_256C<br>.text:0000000000000F48                 ADRP            X0, #off_13F68@PAGE <br>.text:0000000000000F4C                 LDR             X0, [X0,#off_13F68@PAGEOFF] ; 获取变量size_r地址<br>.text:0000000000000F50                 LDR             W0, [X0]<br>.text:0000000000000F54                 CMP             W0, #3 ; size_r与3做比较，若小于等于3，退出<br>.text:0000000000000F58                 B.LE            loc_256C<br>.text:0000000000000F5C                 ADRP            X0, #off_13FD8@PAGE<br>.text:0000000000000F60                 LDR             X0, [X0,#off_13FD8@PAGEOFF] ; 获取变量size_l地址<br>.text:0000000000000F64                 LDR             W1, [X0]<br>.text:0000000000000F68                 ADRP            X0, #off_13F68@PAGE<br>.text:0000000000000F6C                 LDR             X0, [X0,#off_13F68@PAGEOFF] ; 获取变量size_r地址<br>.text:0000000000000F70                 LDR             W0, [X0]<br>.text:0000000000000F74                 MUL             W0, W1, W0 ; w0 = size_l * size_r<br>.text:0000000000000F78                 SXTW            X0, W0  ; nmemb<br>.text:0000000000000F7C                 MOV             X1, #1  ; size<br>.text:0000000000000F80                 BL              .calloc ; 调用calloc(size_l * size_r)<br>.text:0000000000000F84                 MOV             X1, X0  ; 将返回值赋给x1<br>.text:0000000000000F88                 ADRP            X0, #off_13F80@PAGE<br>.text:0000000000000F8C                 LDR             X0, [X0,#off_13F80@PAGEOFF] ; 获取变量 buf_1 (14088) 地址<br>.text:0000000000000F90                 STR             X1, [X0] ; 开辟的内存指针 放在变量 buf_1中<br>.text:0000000000000F94                 ADRP            X0, #off_13FD8@PAGE<br>.text:0000000000000F98                 LDR             X0, [X0,#off_13FD8@PAGEOFF] ; 获取变量size_l地址<br>.text:0000000000000F9C                 LDR             W1, [X0]<br>.text:0000000000000FA0                 ADRP            X0, #off_13F68@PAGE<br>.text:0000000000000FA4                 LDR             X0, [X0,#off_13F68@PAGEOFF] ; 获取变量size_r地址<br>.text:0000000000000FA8                 LDR             W0, [X0]<br>.text:0000000000000FAC                 MUL             W0, W1, W0 ; w0 = size_l * size_r<br>.text:0000000000000FB0                 SXTW            X0, W0  ; nmemb<br>.text:0000000000000FB4                 MOV             X1, #1  ; size<br>.text:0000000000000FB8                 BL              .calloc ; 再开辟一次 calloc(size_l * size_r)<br>.text:0000000000000FBC                 MOV             X1, X0<br>.text:0000000000000FC0                 ADRP            X0, #off_13FF0@PAGE<br>.text:0000000000000FC4                 LDR             X0, [X0,#off_13FF0@PAGEOFF] ; 获取变量 buf_2 (14090) 地址<br>.text:0000000000000FC8                 STR             X1, [X0] ; 开辟的内存指针 放在变量 buf_2中<br>.text:0000000000000FCC                 ADRP            X0, #off_13F90@PAGE<br>.text:0000000000000FD0                 LDR             X0, [X0,#off_13F90@PAGEOFF] ; 获取enter_flag变量的地址<br>.text:0000000000000FD4                 MOV             W1, #1<br>.text:0000000000000FD8                 STR             W1, [X0] ; 给enter_flag变量赋值为1<br>.text:0000000000000FDC                 LDR             X0, [X29,#0xC0+var_78] ; 获取输入数据的指针 opcode_ptr = buf_ptr<br>.text:0000000000000FE0                 ADD             X0, X0, #3 ; opcode += 3<br>.text:0000000000000FE4                 STR             X0, [X29,#0xC0+var_78] ; 设置buf_ptr = opcode_ptr<br>.text:0000000000000FE8                 LDR             X0, [X29,#0xC0+var_78] ; 获取该opcode_ptr<br>.text:0000000000000FEC                 LDRB            W0, [X0] ; 获取该opcode_ptr指向的值<br>.text:0000000000000FF0                 MOV             W1, W0<br>.text:0000000000000FF4                 ADRP            X0, #off_13FE8@PAGE<br>.text:0000000000000FF8                 LDR             X0, [X0,#off_13FE8@PAGEOFF] ; opcode_table的地址<br>.text:0000000000000FFC                 SXTW            X1, W1<br>.text:0000000000001000                 LDR             W0, [X0,X1,LSL#2] ;通过opcode查找函数跳转表的索引<br>.text:0000000000001004                 SXTW            X0, W0<br>.text:0000000000001008                 LSL             X0, X0, #3<br>.text:000000000000100C                 ADD             X1, X29, #0x58 ; 获取函数跳转表地址<br>.text:0000000000001010                 LDR             X0, [X1,X0] ; 获取真正要跳转的地址<br>.text:0000000000001014                 B               loc_ED0<br>.text:0000000000001014 ; End of function parse<br></code></pre></td></tr></table></figure>



<p>通过以上我大致写一下伪c代码吧:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span> <span class="hljs-title function_">init_program</span><span class="hljs-params">(<span class="hljs-type">char</span> **opcode_ptr_ptr)</span> &#123;<br>	<span class="hljs-type">char</span> *opcode_ptr = *opcode_ptr_ptr;<br>	opcode_ptr += <span class="hljs-number">1</span>;<br>	size_l = *opcode_ptr;<br>	opcode_ptr += <span class="hljs-number">1</span>;<br>	size_r = *opcode_ptr;<br>	<span class="hljs-keyword">if</span>(size_r &gt; <span class="hljs-number">0x10</span> || size_l &gt; <span class="hljs-number">0x10</span> || size_r &lt;= <span class="hljs-number">3</span> || size_l &lt;= <span class="hljs-number">3</span>) &#123;<br>		exit_();<br>	&#125;<br>	buf_1 = <span class="hljs-built_in">calloc</span>(size_l * size_r);<br>	buf_2 = <span class="hljs-built_in">calloc</span>(size_l * size_r);<br>	enter_flag = <span class="hljs-number">1</span>;<br>	*opcode_ptr_ptr += <span class="hljs-number">3</span>;<br>	jump function_table[opcode_table(**opcode_ptr_ptr)] <span class="hljs-comment">// 这里的opcode_table()代表是通过一系列操作得到的函数表索引</span><br>&#125;<br></code></pre></td></tr></table></figure>

<p>进入该函数 opcode &#x3D; ‘4d’ + ‘0x00’ + ‘0x01’, 然后这里的’0x00’是要赋值给size_l，’0x01’赋值给size_r。</p>
<p>想要进入其他函数，不abort的情况下就的使enter_flag不为0了，调用init_program这个分支是第一步，这样才能操作其他函数。</p>
<p>好了基本所有函数逻辑已经清楚明白了，我没该怎么利用？漏洞在哪？</p>
<p>hint2提示: 漏洞点在于车辆前方的绿灯或红灯的转化，使车辆到达了地图外</p>
<p>车是什么玩意？ 红绿灯？地图？</p>
<p>通过分析<code>mul_1018</code>, <code>div_11f4</code>，<code>plus_1394</code>，<code>_sub_14d4</code> 都没发现漏洞QAQ。</p>
<p>WEB</p>
<h3 id="签到"><a href="#签到" class="headerlink" title="签到"></a>签到</h3><p>师傅们常说，要善于学习，细致入微；师傅们也常说，要善于分享，总结归纳。 </p>
<p>hint:</p>
<p>2021年3月28日，PHP维护的官方Git服务器 git.php.net 被袭击，其Git仓库遭到恶意篡改。如果开发者使用这些遭到篡改的源代码进行网页的开发的话，网站就会在不知情的情况下被感染。</p>
<p>不知道什么东西</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext"><br></code></pre></td></tr></table></figure>



<p>是一个个人博客</p>
<div id="paginator"></div></div><div id="post-footer"><div id="pages"><div id="footer-link" style="right: calc(50% - 1px);order: 1;border-right: 1px solid #fe2;padding-left: unset;max-width: calc(50% - 4px);"><a href="/2021/04/22/life/%E8%A7%89%E9%86%92%E4%B9%8B%E8%B7%AF/">← Next 觉醒之路</a></div><div id="footer-link" style="left: 50%;order: 0;border-left: 1px solid #fe2;padding-right: unset;max-width: calc(50% - 5px);"><a href="/2021/04/03/security/blockchain/blockchain/">Blockchain Prev →</a></div></div></div><details id="reward"><summary>打赏点小钱</summary><div id="alipay"><span>支付宝 | Alipay</span><br><img src="/img/Alipay.png"></div><div id="wechat"><span>微信 | WeChat</span><br><img src="/img/WeChat.png"></div></details><div id="Valine"></div></div><div id="bottom-btn"><a id="to-index" href="#toc-div" title="index">≡</a><a id="to-top" onClick="scrolls.scrolltop();" title="to top" style="opacity: 0; display: none;">∧</a></div></article><aside><div id="aside-top"><div id="about"><a href="/" id="logo"><img src="https://ak.hypergryph.com/assets/index/images/ak/pc/faction/1.png" alt="Logo"></a><h1 id="Dr"><a target="_blank" rel="noopener" href="https://github.com/i0gan">I0gan</a></h1><div id="description"></div></div><div id="aside-block"><div id="toc-div"><h1>INDEX</h1><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Hu-Fu-2021-Online-%E4%B9%8B%E9%9B%B6%E8%A7%A3"><span class="toc-text">Hu Fu 2021 Online 之零解</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Intro"><span class="toc-text">Intro</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Misc"><span class="toc-text">Misc</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%A0%E4%BC%9A%E5%88%86%E6%9E%90%E6%97%A5%E5%BF%97%E5%90%97"><span class="toc-text">你会分析日志吗</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#PWN"><span class="toc-text">PWN</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#apollo"><span class="toc-text">apollo</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#hint"><span class="toc-text">hint</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#main-%E5%87%BD%E6%95%B0"><span class="toc-text">main 函数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#run-%E5%87%BD%E6%95%B0"><span class="toc-text">run 函数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#parse%E5%87%BD%E6%95%B0"><span class="toc-text">parse函数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#mul-1018%E5%87%BD%E6%95%B0"><span class="toc-text">mul_1018函数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#div-11f4"><span class="toc-text">div_11f4</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#plus-1394"><span class="toc-text">plus_1394</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#sub-14d4"><span class="toc-text">_sub_14d4</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#w-1620"><span class="toc-text">w_1620</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#s-1990"><span class="toc-text">s_1990</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#a-1d10"><span class="toc-text">a_1d10</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#d-2080"><span class="toc-text">d_2080</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#print-2400"><span class="toc-text">print_2400</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#get-next"><span class="toc-text">get_next</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#exit"><span class="toc-text">exit_</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%8D%E7%8E%B0"><span class="toc-text">复现</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AD%BE%E5%88%B0"><span class="toc-text">签到</span></a></li></ol></li></ol></li></ol></div></div></div><footer><nobr><span class="text-title">ICP</span><a class="text-content" target="_blank" rel="noopener" href="https://beian.miit.gov.cn/">沪ICP备2021037250号-1  </a></nobr><nobr><span class="text-title">©</span><span class="text-content">2022 by i0gan</span></nobr><br></footer></aside></main><canvas id="canvas-dust"></canvas><div id="cursor-container"><div id="cursor-outer"></div><div id="cursor-effect"></div></div><script src="/js/search.js"></script><script class="pjax-js">reset=_=>{new Valine({
 el: '#Valine'
 , appId: 'TzNey4n3v0Sx6vdBbytYLoH9-gzGzoHsz'
 , appKey: 'GIXXrK9zLxt0bZLww1hte0Oq' , placeholder: '此条评论委托企鹅物流发送'
});code.findCode();mermaid.init(undefined, ('.mermaid'));}</script><script src="//unpkg.com/@highlightjs/cdn-assets@11.4.0/highlight.min.js"></script><script src="/js/arknights.js"></script><script>window.addEventListener("load",()=>{reset()})</script></body></html>