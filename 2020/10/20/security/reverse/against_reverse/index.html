<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>反逆向分析 | I0gan's blog</title><script src="//unpkg.com/valine/dist/Valine.min.js"></script><script>var config = {"root":"/","path":""}</script><script src="//unpkg.com/mermaid@8.13.5/dist/mermaid.min.js"></script><script>mermaid.initialize({
 startOnLoad: true
 , theme: 'dark'
});</script><link rel="stylesheet" href="/css/arknights.css"><link rel="stylesheet" href="//unpkg.com/@highlightjs/cdn-assets@11.4.0/styles/atom-one-dark-reasonable.min.css"><style>@font-face {
 font-family: BenderLight;
 src: local('Bender'), url("/font/BenderLight.ttf");
}
@font-face {
 font-family: 'JetBrains Mono';
 src: local('JetBrains Mono'), url('/font/JetBrainsMono-Regular.woff2') format('woff2');
}</style><meta name="generator" content="Hexo 6.3.0"></head><body style="background-image:url(https://ak.hypergryph.com/assets/index/images/ak/pc/bk.jpg);"><main><header class="closed"><nav><div class="navBtn"><i class="navBtnIcon"><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span></i></div><ol class="navContent"><li class="navItem" id="search-header"><span class="navItemTitle"><input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="Search" spellcheck="false" maxlength="50" type="text" id="search-input"></span></li><li class="navItem"><a class="navBlock" href="/"><span class="navItemTitle">Home</span></a></li><li class="navItem"><a class="navBlock" href="/about/"><span class="navItemTitle">About</span></a></li><li class="navItem" matchdata="categories,tags"><a class="navBlock" href="/archives/"><span class="navItemTitle">Archives</span></a></li><li class="navItem"><a class="navBlock" href="/shell/"><span class="navItemTitle">Shell</span></a></li></ol></nav><div class="search-popup"><div id="search-result"></div></div></header><article><div id="post-bg"><div id="post-title"><h1>反逆向分析</h1><div id="post-info"><span>First Post: <div class="control"><time datetime="2020-10-20T10:24:50.000Z" id="date"> 2020-10-20</time></div></span><br><span>Last Update: <div class="control"><time datetime="2022-10-24T09:05:35.574Z" id="updated"> 2022-10-24</time></div></span><br><span>Word Count: <div class="control">1.4k</div></span><br><span>Read Time: <div class="control">6 min</div></span></div></div><hr><div id="post-content"><h1 id="反逆向分析"><a href="#反逆向分析" class="headerlink" title="反逆向分析"></a>反逆向分析</h1><h2 id="Ollvm"><a href="#Ollvm" class="headerlink" title="Ollvm"></a>Ollvm</h2><h3 id="0x01-Ollvm介绍"><a href="#0x01-Ollvm介绍" class="headerlink" title="0x01 Ollvm介绍"></a>0x01 Ollvm介绍</h3><p>OLLVM（Obfuscator-LLVM）是瑞士西北应用科技大学安全实验室于2010年6月份发起的一个项目，该项目旨在提供一套<strong>开源的针对LLVM的代码混淆工具</strong>，以增加逆向工程的难度, 只不过Ollvm仅更新到llvm的4.0，2017年开始就没再更新。</p>
<h3 id="0x02-Ollvm混淆介绍"><a href="#0x02-Ollvm混淆介绍" class="headerlink" title="0x02 Ollvm混淆介绍"></a>0x02 Ollvm混淆介绍</h3><p>Ollvm混淆主要分成三种模式，这三种模式主要是流程平坦化，指令替换，以及控制流伪造。</p>
<p><strong>流程平坦化</strong> ：这个模式主要通过将if-else语句替换成do-while语句，然后通过switch语句来对流程的控制，这样就能模糊基本块之间的前后关系。</p>
<p><strong>指令替换</strong> ：这个模式主要通过使用更复杂的指令序列来替换一些标准的二元运算符，从而增加逆向的难度。</p>
<p><strong>控制流伪造</strong> ：这个模式主要是会在一个简单的运算中外包好几层if-else的判断，从而增加逆向的难度。</p>
<blockquote>
<p>对Ollvm有更深入的理解，可参阅论文《Obfuscating C++ programs via control flow flattening》</p>
</blockquote>
<h3 id="0x03-Ollvm编译"><a href="#0x03-Ollvm编译" class="headerlink" title="0x03 Ollvm编译"></a>0x03 Ollvm编译</h3><p>env: arch-linux</p>
<p>使用apt源安装g++和cmake，从github获取ollvm的源码，并进行编译。</p>
<p>Ollvm 6.0: <a target="_blank" rel="noopener" href="https://github.com/yazhiwang/ollvm-tll.git">https://github.com/yazhiwang/ollvm-tll.git</a> (编译成功!)</p>
<p>原版src: <a target="_blank" rel="noopener" href="https://github.com/obfuscator-llvm/obfuscator/tree/llvm-4.0">https://github.com/obfuscator-llvm/obfuscator/tree/llvm-4.0</a>  (编译失败!)</p>
<h4 id="ollvm-til编译"><a href="#ollvm-til编译" class="headerlink" title="ollvm-til编译"></a>ollvm-til编译</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">mkdir</span> build<br><span class="hljs-built_in">cd</span> build<br>cmake -DCMAKE_BUILD_TYPE=Release ../ollvm-tll-master<br>make -j8<br></code></pre></td></tr></table></figure>



<h4 id="官方编译"><a href="#官方编译" class="headerlink" title="官方编译"></a>官方编译</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cd</span> <br><span class="hljs-built_in">mkdir</span> build<br>cmake  -DCMAKE_BUILD_TYPE=Release  -DLLVM_INCLUDE_TESTS=OFF  ../<br>make -j8<br></code></pre></td></tr></table></figure>

<h3 id="0x4-命令介绍"><a href="#0x4-命令介绍" class="headerlink" title="0x4 命令介绍"></a>0x4 命令介绍</h3><h4 id="控制流扁平化"><a href="#控制流扁平化" class="headerlink" title="控制流扁平化"></a>控制流扁平化</h4><p>这个模式主要是把一些if-else语句，嵌套成do-while语句</p>
<p> -mllvm -fla：激活控制流扁平化</p>
<p> -mllvm -split：激活基本块分割。在一起使用时改善展平。</p>
<p> -mllvm -split_num&#x3D;3：如果激活了传递，则在每个基本块上应用3次。默认值：1</p>
<h4 id="指令替换"><a href="#指令替换" class="headerlink" title="指令替换"></a>指令替换</h4><p>这个模式主要用功能上等效但更复杂的指令序列替换标准二元运算符(+ , – , &amp; , | 和 ^)</p>
<p> -mllvm -sub：激活指令替换</p>
<p> -mllvm -sub_loop&#x3D;3：如果激活了传递，则在函数上应用3次。默认值：1</p>
<h4 id="虚假控制流程"><a href="#虚假控制流程" class="headerlink" title="虚假控制流程"></a>虚假控制流程</h4><p>这个模式主要嵌套几层判断逻辑，一个简单的运算都会在外面包几层if-else，所以这个模式加上编译速度会慢很多因为要做几层假的逻辑包裹真正有用的代码。</p>
<p> -mllvm -bcf：激活虚假控制流程<br> -mllvm -bcf_loop&#x3D;3：如果激活了传递，则在函数上应用3次。默认值：1<br> -mllvm -bcf_prob&#x3D;40：如果激活了传递，基本块将以40％的概率进行模糊处理。默认值：30</p>
<h4 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h4><p> -mllvm -sobf 开启字符串混淆</p>
<p> -mllvm -seed&#x3D;0xdeadbeaf 指定随机数种子生成器 bcf可以配合下面参数使用</p>
<h3 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h3><p>对a.c进行混淆</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-type">void</span> <span class="hljs-title function_">exec</span><span class="hljs-params">()</span> &#123;<br>	<span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;OOOKKKK!&quot;</span>);<br>&#125;<br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span> &#123;<br>    <span class="hljs-type">int</span> a = <span class="hljs-number">0</span>;<br>    a ++;<br>	<span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Hello World&quot;</span>);<br>    <span class="hljs-keyword">if</span>(a &gt;= <span class="hljs-number">1</span>) &#123;<br>        exec();<br>    &#125;<br>	<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>



<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">~/tools/ollvm/bin/clang a.c -mllvm -fla  -mllvm -sobf  -mllvm -bcf  -o a<br></code></pre></td></tr></table></figure>

<p>ida64打开F5</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> __cdecl <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **argv, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **envp)</span><br>&#123;<br>  <span class="hljs-type">signed</span> <span class="hljs-type">int</span> v3; <span class="hljs-comment">// eax</span><br>  __int64 *v4; <span class="hljs-comment">// rcx</span><br>  <span class="hljs-type">int</span> v5; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">signed</span> <span class="hljs-type">int</span> v6; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">signed</span> <span class="hljs-type">int</span> v7; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">signed</span> <span class="hljs-type">int</span> v8; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">signed</span> <span class="hljs-type">int</span> v9; <span class="hljs-comment">// eax</span><br>  __int64 *v11; <span class="hljs-comment">// rcx</span><br>  <span class="hljs-type">int</span> v12; <span class="hljs-comment">// eax</span><br>  __int64 v13; <span class="hljs-comment">// [rsp+0h] [rbp-50h]</span><br>  <span class="hljs-type">int</span> v14; <span class="hljs-comment">// [rsp+8h] [rbp-48h]</span><br>  <span class="hljs-type">int</span> v15; <span class="hljs-comment">// [rsp+Ch] [rbp-44h]</span><br>  __int64 *v16; <span class="hljs-comment">// [rsp+10h] [rbp-40h]</span><br>  <span class="hljs-type">int</span> v17; <span class="hljs-comment">// [rsp+18h] [rbp-38h]</span><br>  <span class="hljs-type">int</span> v18; <span class="hljs-comment">// [rsp+1Ch] [rbp-34h]</span><br>  <span class="hljs-type">int</span> v19; <span class="hljs-comment">// [rsp+20h] [rbp-30h]</span><br>  <span class="hljs-type">int</span> v20; <span class="hljs-comment">// [rsp+24h] [rbp-2Ch]</span><br>  <span class="hljs-type">int</span> v21; <span class="hljs-comment">// [rsp+28h] [rbp-28h]</span><br>  <span class="hljs-type">int</span> v22; <span class="hljs-comment">// [rsp+2Ch] [rbp-24h]</span><br>  <span class="hljs-type">int</span> v23; <span class="hljs-comment">// [rsp+30h] [rbp-20h]</span><br>  <span class="hljs-type">int</span> v24; <span class="hljs-comment">// [rsp+34h] [rbp-1Ch]</span><br>  <span class="hljs-type">int</span> v25; <span class="hljs-comment">// [rsp+38h] [rbp-18h]</span><br>  <span class="hljs-type">int</span> v26; <span class="hljs-comment">// [rsp+3Ch] [rbp-14h]</span><br>  <span class="hljs-type">int</span> v27; <span class="hljs-comment">// [rsp+40h] [rbp-10h]</span><br>  <span class="hljs-type">bool</span> v28; <span class="hljs-comment">// [rsp+45h] [rbp-Bh]</span><br>  <span class="hljs-type">bool</span> v29; <span class="hljs-comment">// [rsp+46h] [rbp-Ah]</span><br>  <span class="hljs-type">bool</span> v30; <span class="hljs-comment">// [rsp+47h] [rbp-9h]</span><br><br>  v28 = (((_BYTE)x_2 - <span class="hljs-number">1</span>) * (_BYTE)x_2 &amp; <span class="hljs-number">1</span>) == <span class="hljs-number">0</span>;<br>  v29 = y_3 &lt; <span class="hljs-number">10</span>;<br>  v27 = <span class="hljs-number">1567572003</span>;<br>  <span class="hljs-keyword">while</span> ( <span class="hljs-number">1</span> )<br>  &#123;<br>    <span class="hljs-keyword">while</span> ( <span class="hljs-number">1</span> )<br>    &#123;<br>      <span class="hljs-keyword">while</span> ( <span class="hljs-number">1</span> )<br>      &#123;<br>        v26 = v27;<br>        v25 = v27 + <span class="hljs-number">1130483098</span>;<br>        <span class="hljs-keyword">if</span> ( v27 != <span class="hljs-number">-1130483098</span> )<br>          <span class="hljs-keyword">break</span>;<br>        v9 = <span class="hljs-number">-1065940243</span>;<br>        <span class="hljs-keyword">if</span> ( y_3 &lt; <span class="hljs-number">10</span> || (((_BYTE)x_2 - <span class="hljs-number">1</span>) * (_BYTE)x_2 &amp; <span class="hljs-number">1</span>) == <span class="hljs-number">0</span> )<br>          v9 = <span class="hljs-number">-714366873</span>;<br>        v27 = v9;<br>      &#125;<br>      v24 = v26 + <span class="hljs-number">1065940243</span>;<br>      <span class="hljs-keyword">if</span> ( v26 != <span class="hljs-number">-1065940243</span> )<br>        <span class="hljs-keyword">break</span>;<br>      v27 = <span class="hljs-number">-1130483098</span>;<br>    &#125;<br>    v23 = v26 + <span class="hljs-number">714366873</span>;<br>    <span class="hljs-keyword">if</span> ( v26 == <span class="hljs-number">-714366873</span> )<br>      <span class="hljs-keyword">break</span>;<br>    v22 = v26 + <span class="hljs-number">511865542</span>;<br>    <span class="hljs-keyword">if</span> ( v26 == <span class="hljs-number">-511865542</span> )<br>    &#123;<br>      v8 = <span class="hljs-number">-1065940243</span>;<br>      <span class="hljs-keyword">if</span> ( y_3 &lt; <span class="hljs-number">10</span> || (((_BYTE)x_2 - <span class="hljs-number">1</span>) * (_BYTE)x_2 &amp; <span class="hljs-number">1</span>) == <span class="hljs-number">0</span> )<br>        v8 = <span class="hljs-number">-1130483098</span>;<br>      v27 = v8;<br>    &#125;<br>    <span class="hljs-keyword">else</span><br>    &#123;<br>      v21 = v26 + <span class="hljs-number">329192939</span>;<br>      <span class="hljs-keyword">if</span> ( v26 == <span class="hljs-number">-329192939</span> )<br>      &#123;<br>        v11 = &amp;v13 - <span class="hljs-number">2</span>;<br>        *((_DWORD *)&amp;v13 - <span class="hljs-number">4</span>) = <span class="hljs-number">0</span>;<br>        *(_DWORD *)v11 = <span class="hljs-number">0</span>;<br>        *(_DWORD *)v11 = *((_DWORD *)&amp;v13 - <span class="hljs-number">4</span>) + <span class="hljs-number">1</span>;<br>        v12 = <span class="hljs-built_in">printf</span>(&amp;byte_404030);<br>        v27 = <span class="hljs-number">191033970</span>;<br>        v14 = v12;<br>      &#125;<br>      <span class="hljs-keyword">else</span><br>      &#123;<br>        v20 = v26 - <span class="hljs-number">191033970</span>;<br>        <span class="hljs-keyword">if</span> ( v26 == <span class="hljs-number">191033970</span> )<br>        &#123;<br>          v4 = &amp;v13 - <span class="hljs-number">2</span>;<br>          *((_DWORD *)&amp;v13 - <span class="hljs-number">4</span>) = <span class="hljs-number">0</span>;<br>          *(_DWORD *)v4 = <span class="hljs-number">0</span>;<br>          *(_DWORD *)v4 = *((_DWORD *)&amp;v13 - <span class="hljs-number">4</span>) + <span class="hljs-number">1</span>;<br>          v16 = &amp;v13 - <span class="hljs-number">2</span>;<br>          v5 = <span class="hljs-built_in">printf</span>(&amp;byte_404030);<br>          v6 = <span class="hljs-number">-329192939</span>;<br>          v30 = *(_DWORD *)v16 &gt;= <span class="hljs-number">1</span>;<br>          <span class="hljs-keyword">if</span> ( y_3 &lt; <span class="hljs-number">10</span> || (((_BYTE)x_2 - <span class="hljs-number">1</span>) * (_BYTE)x_2 &amp; <span class="hljs-number">1</span>) == <span class="hljs-number">0</span> )<br>            v6 = <span class="hljs-number">1347608926</span>;<br>          v27 = v6;<br>          v15 = v5;<br>        &#125;<br>        <span class="hljs-keyword">else</span><br>        &#123;<br>          v19 = v26 - <span class="hljs-number">1347608926</span>;<br>          <span class="hljs-keyword">if</span> ( v26 == <span class="hljs-number">1347608926</span> )<br>          &#123;<br>            v7 = <span class="hljs-number">-511865542</span>;<br>            <span class="hljs-keyword">if</span> ( v30 )<br>              v7 = <span class="hljs-number">1700479422</span>;<br>            v27 = v7;<br>          &#125;<br>          <span class="hljs-keyword">else</span><br>          &#123;<br>            v18 = v26 - <span class="hljs-number">1567572003</span>;<br>            <span class="hljs-keyword">if</span> ( v26 == <span class="hljs-number">1567572003</span> )<br>            &#123;<br>              v3 = <span class="hljs-number">-329192939</span>;<br>              <span class="hljs-keyword">if</span> ( v29 || v28 )<br>                v3 = <span class="hljs-number">191033970</span>;<br>              v27 = v3;<br>            &#125;<br>            <span class="hljs-keyword">else</span><br>            &#123;<br>              v17 = v26 - <span class="hljs-number">1700479422</span>;<br>              <span class="hljs-keyword">if</span> ( v26 == <span class="hljs-number">1700479422</span> )<br>              &#123;<br>                exec();<br>                v27 = <span class="hljs-number">-511865542</span>;<br>              &#125;<br>            &#125;<br>          &#125;<br>        &#125;<br>      &#125;<br>    &#125;<br>  &#125;<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>以上成功实现代码混淆</p>
<h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><p><a target="_blank" rel="noopener" href="http://ac.inf.elte.hu/Vol_030_2009/003.pdf">Obfuscating C++ programs via control flow flattening </a></p>
<h2 id="去除符号表"><a href="#去除符号表" class="headerlink" title="去除符号表"></a>去除符号表</h2><p>查看符号表</p>
<p>  readelf -s test</p>
<p>采用strip工具对符号表进行去除</p>
<p>.symtab因为是在调试和链接时有用的，所以，可以从生产的二进制执行文件中移除。可以使用strip。strip是可以移除符号以及节的工具。</p>
<ol>
<li><p>移除.symtab 符号表 以及 .strtab 符号字符串表<br>直接运行</p>
<ul>
<li><code>strip --remove-section=.symtab file_in</code></li>
<li><code>strip --remove-section=.strtab file_in</code></li>
</ul>
</li>
<li><p>想要让可执行文件没有<code>.dynsym</code>动态链接表，<code>.dynstr</code>动态链接字符表。<br>gcc编译时添加参数，从而使用静态编译。<code>gcc -static</code> 或者 <code>gcc -nostdlib</code></p>
<ul>
<li><code>gcc -nostdlib</code> ：不连接系统标准启动文件和标准库文件，只把指定的文件传递给连接器。</li>
<li><code>gcc -static</code>：在支持动态链接的系统上，阻止连接共享库。该选项在其它系统上 无效。</li>
</ul>
</li>
</ol>
<div id="paginator"></div></div><div id="post-footer"><div id="pages"><div id="footer-link" style="right: calc(50% - 1px);order: 1;border-right: 1px solid #fe2;padding-left: unset;max-width: calc(50% - 4px);"><a href="/2020/10/25/env/docker/docker_basic_cmd/">← Next Docker基本命令</a></div><div id="footer-link" style="left: 50%;order: 0;border-left: 1px solid #fe2;padding-right: unset;max-width: calc(50% - 5px);"><a href="/2020/10/18/security/ctf/compitation/wp-nu1lctf-2020/">2020 nu1lctf Pwn WP Prev →</a></div></div></div><details id="reward"><summary>打赏点小钱</summary><div id="alipay"><span>支付宝 | Alipay</span><br><img src="/img/Alipay.png"></div><div id="wechat"><span>微信 | WeChat</span><br><img src="/img/WeChat.png"></div></details><div id="Valine"></div></div><div id="bottom-btn"><a id="to-index" href="#toc-div" title="index">≡</a><a id="to-top" onClick="scrolls.scrolltop();" title="to top" style="opacity: 0; display: none;">∧</a></div></article><aside><div id="aside-top"><div id="about"><a href="/" id="logo"><img src="https://ak.hypergryph.com/assets/index/images/ak/pc/faction/1.png" alt="Logo"></a><h1 id="Dr"><a target="_blank" rel="noopener" href="https://github.com/i0gan">I0gan</a></h1><div id="description"></div></div><div id="aside-block"><div id="toc-div"><h1>INDEX</h1><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8F%8D%E9%80%86%E5%90%91%E5%88%86%E6%9E%90"><span class="toc-text">反逆向分析</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Ollvm"><span class="toc-text">Ollvm</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#0x01-Ollvm%E4%BB%8B%E7%BB%8D"><span class="toc-text">0x01 Ollvm介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x02-Ollvm%E6%B7%B7%E6%B7%86%E4%BB%8B%E7%BB%8D"><span class="toc-text">0x02 Ollvm混淆介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x03-Ollvm%E7%BC%96%E8%AF%91"><span class="toc-text">0x03 Ollvm编译</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#ollvm-til%E7%BC%96%E8%AF%91"><span class="toc-text">ollvm-til编译</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%98%E6%96%B9%E7%BC%96%E8%AF%91"><span class="toc-text">官方编译</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x4-%E5%91%BD%E4%BB%A4%E4%BB%8B%E7%BB%8D"><span class="toc-text">0x4 命令介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8E%A7%E5%88%B6%E6%B5%81%E6%89%81%E5%B9%B3%E5%8C%96"><span class="toc-text">控制流扁平化</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8C%87%E4%BB%A4%E6%9B%BF%E6%8D%A2"><span class="toc-text">指令替换</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%99%9A%E5%81%87%E6%8E%A7%E5%88%B6%E6%B5%81%E7%A8%8B"><span class="toc-text">虚假控制流程</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%B6%E4%BB%96"><span class="toc-text">其他</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BE%8B%E5%AD%90"><span class="toc-text">例子</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%82%E8%80%83"><span class="toc-text">参考</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8E%BB%E9%99%A4%E7%AC%A6%E5%8F%B7%E8%A1%A8"><span class="toc-text">去除符号表</span></a></li></ol></li></ol></div></div></div><footer><nobr><span class="text-title">ICP</span><a class="text-content" target="_blank" rel="noopener" href="https://beian.miit.gov.cn/">沪ICP备2021037250号-1  </a></nobr><nobr><span class="text-title">©</span><span class="text-content">2022 by i0gan</span></nobr><br></footer></aside></main><canvas id="canvas-dust"></canvas><div id="cursor-container"><div id="cursor-outer"></div><div id="cursor-effect"></div></div><script src="/js/search.js"></script><script class="pjax-js">reset=_=>{new Valine({
 el: '#Valine'
 , appId: 'TzNey4n3v0Sx6vdBbytYLoH9-gzGzoHsz'
 , appKey: 'GIXXrK9zLxt0bZLww1hte0Oq' , placeholder: '此条评论委托企鹅物流发送'
});code.findCode();mermaid.init(undefined, ('.mermaid'));}</script><script src="//unpkg.com/@highlightjs/cdn-assets@11.4.0/highlight.min.js"></script><script src="/js/arknights.js"></script><script>window.addEventListener("load",()=>{reset()})</script></body></html>