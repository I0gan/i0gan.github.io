<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>awd pwn attack script | I0gan's blog</title><script src="//unpkg.com/valine/dist/Valine.min.js"></script><script>var config = {"root":"/","path":""}</script><script src="//unpkg.com/mermaid@8.13.5/dist/mermaid.min.js"></script><script>mermaid.initialize({
 startOnLoad: true
 , theme: 'dark'
});</script><link rel="stylesheet" href="/css/arknights.css"><link rel="stylesheet" href="//unpkg.com/@highlightjs/cdn-assets@11.4.0/styles/atom-one-dark-reasonable.min.css"><style>@font-face {
 font-family: BenderLight;
 src: local('Bender'), url("/font/BenderLight.ttf");
}
@font-face {
 font-family: 'JetBrains Mono';
 src: local('JetBrains Mono'), url('/font/JetBrainsMono-Regular.woff2') format('woff2');
}</style><meta name="generator" content="Hexo 6.3.0"></head><body style="background-image:url(https://ak.hypergryph.com/assets/index/images/ak/pc/bk.jpg);"><main><header class="closed"><nav><div class="navBtn"><i class="navBtnIcon"><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span></i></div><ol class="navContent"><li class="navItem" id="search-header"><span class="navItemTitle"><input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="Search" spellcheck="false" maxlength="50" type="text" id="search-input"></span></li><li class="navItem"><a class="navBlock" href="/"><span class="navItemTitle">Home</span></a></li><li class="navItem"><a class="navBlock" href="/about/"><span class="navItemTitle">About</span></a></li><li class="navItem" matchdata="categories,tags"><a class="navBlock" href="/archives/"><span class="navItemTitle">Archives</span></a></li><li class="navItem"><a class="navBlock" href="/shell/"><span class="navItemTitle">Shell</span></a></li></ol></nav><div class="search-popup"><div id="search-result"></div></div></header><article><div id="post-bg"><div id="post-title"><h1>awd pwn attack script</h1><div id="post-info"><span>First Post: <div class="control"><time datetime="2020-09-13T01:45:21.000Z" id="date"> 2020-09-13</time></div></span><br><span>Last Update: <div class="control"><time datetime="2022-10-24T08:53:59.797Z" id="updated"> 2022-10-24</time></div></span><br><span>Word Count: <div class="control">1.4k</div></span><br><span>Read Time: <div class="control">8 min</div></span></div></div><hr><div id="post-content"><h1 id="AWD-PWN"><a href="#AWD-PWN" class="headerlink" title="AWD PWN"></a>AWD PWN</h1><p>打了好几次awd, 始终都没好好弄个批量攻击脚本与批量提交flag, 今天它来了, 环境是pwn docker</p>
<h2 id="AWD-WAF"><a href="#AWD-WAF" class="headerlink" title="AWD WAF"></a>AWD WAF</h2><p>awd waf方便抓取对方攻打的流量</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">/*</span><br><span class="hljs-comment"> * orignal author: yangshuangfu</span><br><span class="hljs-comment"> * github link: https://github.com/yangshuangfu/PwnWAF</span><br><span class="hljs-comment"> * modified author: i0gan</span><br><span class="hljs-comment"> * github link: https://github.com/i0gan/pwn/env/awd/waf.c</span><br><span class="hljs-comment"> * modified time  : 2020-09-18</span><br><span class="hljs-comment"> */</span><br><br><span class="hljs-comment">// complie:</span><br><span class="hljs-comment">// gcc waf.c -o waf</span><br><span class="hljs-comment">// before you use it, you should backup your binary file, then rename waf as binary name</span><br><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;fcntl.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;unistd.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;error.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;sys/wait.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;sys/ptrace.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;sys/syscall.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;sys/user.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;sys/types.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;sys/stat.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;string.h&gt;</span></span><br><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> FILENAME <span class="hljs-string">&quot;./pwn&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> LOGNAME <span class="hljs-string">&quot;./log&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> MACHINE 64</span><br><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> NEW_CONNECT_SHOW_STR <span class="hljs-string">&quot;\n************** new attack *************\n&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> READ_SHOW_STR        <span class="hljs-string">&quot;\nread:\n&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> WRITE_SHOW_STR       <span class="hljs-string">&quot;\nwrite:\n&quot;</span></span><br><br><span class="hljs-class"><span class="hljs-keyword">enum</span> <span class="hljs-title">SYSTYPE</span> &#123;</span><br>	READ,<br>	WRITE<br>&#125;;<br><br><span class="hljs-type">int</span> state = <span class="hljs-number">-1</span>;<br><br><span class="hljs-type">int</span> <span class="hljs-title function_">check_standard</span><span class="hljs-params">(<span class="hljs-type">int</span> fd)</span>&#123;<br>	<span class="hljs-keyword">return</span> fd == <span class="hljs-number">1</span> || fd == <span class="hljs-number">0</span>;<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">write_log</span><span class="hljs-params">(<span class="hljs-type">pid_t</span> pid, <span class="hljs-type">char</span>* addr, <span class="hljs-type">int</span> size, <span class="hljs-keyword">enum</span> SYSTYPE flag)</span>&#123;<br><br>	<span class="hljs-type">int</span> fd = open(LOGNAME, O_CREAT|O_APPEND|O_WRONLY, <span class="hljs-number">0666</span>);<br>	<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>,j = <span class="hljs-number">0</span>;<br>	<span class="hljs-type">char</span> data;<br>	<span class="hljs-type">char</span>* buf = (<span class="hljs-type">char</span>*)<span class="hljs-built_in">malloc</span>(size + <span class="hljs-number">1</span>);<br><br>	<span class="hljs-keyword">for</span>(i = <span class="hljs-number">0</span>; i &lt; size; i++)&#123;<br>		data = ptrace(PTRACE_PEEKDATA, pid, addr + i, <span class="hljs-literal">NULL</span>);<br>		buf[i] = data;<br>	&#125;<br><br>	<span class="hljs-comment">// 判断是否状态是否发生变化,发生变化就写入不同的状态</span><br>	<span class="hljs-keyword">if</span>(state != flag)	&#123;<br>		<span class="hljs-keyword">if</span>(flag == READ)<br>			write(fd, READ_SHOW_STR, <span class="hljs-keyword">sizeof</span>(READ_SHOW_STR));<br>		<span class="hljs-keyword">else</span><br>			write(fd, WRITE_SHOW_STR, <span class="hljs-keyword">sizeof</span>(WRITE_SHOW_STR));<br>		state = flag;<br>	&#125;<br><br>	write(fd, buf, size);<br>	close(fd);<br>	<span class="hljs-built_in">free</span>(buf);<br>&#125;<br><br><br><span class="hljs-type">void</span> <span class="hljs-title function_">write_new_attack</span><span class="hljs-params">()</span> &#123;<br>	<span class="hljs-comment">// 分割每次攻打的符号</span><br>	<span class="hljs-type">int</span> fd = open(LOGNAME, O_CREAT|O_APPEND|O_WRONLY, <span class="hljs-number">0666</span>);<br>	write(fd, NEW_CONNECT_SHOW_STR, <span class="hljs-keyword">sizeof</span>(NEW_CONNECT_SHOW_STR));<br>	close(fd);<br>&#125;<br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">char</span>* argv[])</span>&#123;<br>	setvbuf(<span class="hljs-built_in">stdin</span>,<span class="hljs-number">0</span>,<span class="hljs-number">2</span>,<span class="hljs-number">0</span>);<br>	setvbuf(<span class="hljs-built_in">stdout</span>,<span class="hljs-number">0</span>,<span class="hljs-number">2</span>,<span class="hljs-number">0</span>);<br>	<span class="hljs-type">pid_t</span> pid;<br>	<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">user_regs_struct</span> <span class="hljs-title">regs</span>;</span><br>	<span class="hljs-type">int</span> status;<br>	<span class="hljs-type">int</span> insyscall = <span class="hljs-number">0</span>;<br>	<span class="hljs-type">int</span> first_time = <span class="hljs-number">1</span>;<br>	pid = fork();<br>	<span class="hljs-type">int</span> sys_num;<br>	<span class="hljs-class"><span class="hljs-keyword">enum</span> <span class="hljs-title">SYSTYPE</span> <span class="hljs-title">sys_status</span>;</span><br>	<span class="hljs-comment">// we use child process to exec </span><br>	<span class="hljs-keyword">if</span>(pid == <span class="hljs-number">0</span>)&#123;<br>		ptrace(PTRACE_TRACEME, <span class="hljs-number">0</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>);<br>		argv[<span class="hljs-number">1</span>] = FILENAME;<br>		status = execvp(FILENAME, argv+<span class="hljs-number">1</span>);<br>		<span class="hljs-keyword">if</span>(status&lt;<span class="hljs-number">0</span>)&#123;<br>			perror(<span class="hljs-string">&quot;ERROR EXEC\n&quot;</span>);<br>			<span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br>		&#125;<br>	&#125;<br>	<span class="hljs-comment">// parent to get child syscall</span><br>	<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (pid &gt; <span class="hljs-number">0</span>)&#123;<br>		write_new_attack();<br>		<span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>)&#123;<br>			wait(&amp;status);<br>			<span class="hljs-keyword">if</span>(WIFEXITED(status))<br>				<span class="hljs-keyword">break</span>;<br>			<span class="hljs-comment">// get rax to ensure witch syscall</span><br>			ptrace(PTRACE_GETREGS, pid, <span class="hljs-literal">NULL</span>, &amp;regs);<br><span class="hljs-meta">#<span class="hljs-keyword">if</span> MACHINE == 64</span><br>			sys_num = regs.orig_rax;<br><span class="hljs-meta">#<span class="hljs-keyword">elif</span> MACHINE == 32</span><br>			sys_num = regs.orig_eax;<br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br>			<span class="hljs-keyword">if</span> (sys_num != SYS_read &amp;&amp; sys_num != SYS_write)&#123;<br>				ptrace(PTRACE_SYSCALL, pid, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>);<br>				<span class="hljs-keyword">continue</span>;<br>			&#125;<br>			<span class="hljs-keyword">if</span> (insyscall==<span class="hljs-number">0</span>)&#123;<br>				insyscall = <span class="hljs-number">1</span>;<br>				ptrace(PTRACE_SYSCALL, pid, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);<br>			&#125;<br>			<span class="hljs-keyword">else</span>&#123;<br>				<span class="hljs-comment">// we should ignor the first time</span><br>				<span class="hljs-comment">// checl it is standard pipe or not</span><br>				<span class="hljs-type">int</span> is_standard = <span class="hljs-number">0</span>;<br><span class="hljs-meta">#<span class="hljs-keyword">if</span> MACHINE == 64</span><br>				is_standard = check_standard(regs.rdi);<br><span class="hljs-meta">#<span class="hljs-keyword">elif</span> MACHINE == 32</span><br>				is_standard = check_standard(regs.ebx);<br><span class="hljs-meta">#<span class="hljs-keyword">endif</span> </span><br>				<span class="hljs-keyword">if</span>(!is_standard)&#123;<br>					first_time = <span class="hljs-number">0</span>;<br>					ptrace(PTRACE_SYSCALL, pid, <span class="hljs-literal">NULL</span> ,<span class="hljs-literal">NULL</span>);<br>					insyscall ^= <span class="hljs-number">1</span>;<br>					<span class="hljs-keyword">continue</span>;<br>				&#125;<br>				<span class="hljs-keyword">if</span>(sys_num == SYS_read)<br>					sys_status = READ;<br>				<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (sys_num == SYS_write)<br>					sys_status = WRITE;<br>				<span class="hljs-type">int</span> size = <span class="hljs-number">0</span>;<br>				<span class="hljs-type">char</span>* addr = <span class="hljs-literal">NULL</span>;<br><span class="hljs-meta">#<span class="hljs-keyword">if</span> MACHINE == 64</span><br>				size = regs.rdx;<br>				<span class="hljs-comment">// size = (size + sizeof(long)-1)/sizeof(long) * sizeof(long) +1;</span><br>				addr = (<span class="hljs-type">char</span>*)regs.rsi;<br>				<span class="hljs-comment">// printf(&quot; the addr is %lx with size %lx&quot;, addr, size);</span><br><span class="hljs-meta">#<span class="hljs-keyword">elif</span> MACHINE == 32</span><br>				size = regs.edx;<br>				addr = (<span class="hljs-type">char</span>*)regs.ecx;<br><br><span class="hljs-meta">#<span class="hljs-keyword">endif</span> </span><br>				write_log(pid, addr, size, sys_status);<br>				insyscall = <span class="hljs-number">0</span>;<br>				ptrace(PTRACE_SYSCALL, pid, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>);<br>			&#125;<br>		&#125;<br>		<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>	&#125;<br>	<span class="hljs-keyword">else</span>&#123;<br>		perror(<span class="hljs-string">&quot;ERROR FORK!\n&quot;</span>);<br>		<span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br>	&#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>





<h2 id="AWD-EXP"><a href="#AWD-EXP" class="headerlink" title="AWD EXP"></a>AWD EXP</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/env python3</span><br><span class="hljs-comment">#-*- coding:utf-8 -*-</span><br><span class="hljs-comment"># author: i0gan</span><br><span class="hljs-comment"># a script for awd exp</span><br><span class="hljs-comment"># env: pwndocker [skysider/pwndocker (v: 2020/09/09)]</span><br><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">import</span> os<br><br>r   =  <span class="hljs-keyword">lambda</span> x : io.recv(x)<br>ra  =  <span class="hljs-keyword">lambda</span>   : io.recvall()<br>rl  =  <span class="hljs-keyword">lambda</span>   : io.recvline(keepends = <span class="hljs-literal">True</span>)<br>ru  =  <span class="hljs-keyword">lambda</span> x : io.recvuntil(x, drop = <span class="hljs-literal">True</span>)<br>s   =  <span class="hljs-keyword">lambda</span> x : io.send(x)<br>sl  =  <span class="hljs-keyword">lambda</span> x : io.sendline(x)<br>sa  =  <span class="hljs-keyword">lambda</span> x, y : io.sendafter(x, y)<br>sla =  <span class="hljs-keyword">lambda</span> x, y : io.sendlineafter(x, y)<br>ia  =  <span class="hljs-keyword">lambda</span> : io.interactive()<br>c   =  <span class="hljs-keyword">lambda</span> : io.close()<br>li    = <span class="hljs-keyword">lambda</span> x : log.info(<span class="hljs-string">&#x27;\x1b[01;38;5;214m&#x27;</span> + x + <span class="hljs-string">&#x27;\x1b[0m&#x27;</span>)<br><br>elf_path  = <span class="hljs-string">&#x27;pwn&#x27;</span><br>arch = <span class="hljs-string">&#x27;64&#x27;</span><br>libc_v = <span class="hljs-string">&#x27;2.27&#x27;</span><br>MODIFY_LD = <span class="hljs-number">0</span><br>LOCAL = <span class="hljs-number">0</span><br>LIBC  = <span class="hljs-number">0</span><br><br><span class="hljs-keyword">if</span>(<span class="hljs-built_in">len</span>(sys.argv) &lt; <span class="hljs-number">3</span>):<br>	LOCAL = <span class="hljs-number">1</span><br>	context.log_level=<span class="hljs-string">&#x27;debug&#x27;</span><br><span class="hljs-keyword">else</span>:<br>	server_ip = sys.argv[<span class="hljs-number">1</span>]<br>	server_port = <span class="hljs-built_in">int</span>(sys.argv[<span class="hljs-number">2</span>], <span class="hljs-number">10</span>)<br><br>ld_path   = <span class="hljs-string">&#x27;/glibc/&#x27;</span> + libc_v + <span class="hljs-string">&#x27;/&#x27;</span> + arch + <span class="hljs-string">&#x27;/lib/ld-linux-x86-64.so.2&#x27;</span><br>libs_path = <span class="hljs-string">&#x27;/glibc/&#x27;</span> + libc_v + <span class="hljs-string">&#x27;/&#x27;</span> + arch + <span class="hljs-string">&#x27;/lib&#x27;</span><br>libc_path = <span class="hljs-string">&#x27;/glibc/&#x27;</span> + libc_v + <span class="hljs-string">&#x27;/&#x27;</span> + arch + <span class="hljs-string">&#x27;/lib/libc.so.6&#x27;</span><br><br>libc_path = <span class="hljs-string">&#x27;./libc.so.6&#x27;</span><br><br><span class="hljs-comment"># change ld path </span><br><span class="hljs-keyword">if</span>(MODIFY_LD):<br>	change_ld_cmd = <span class="hljs-string">&#x27;patchelf  --set-interpreter &#x27;</span> + ld_path +<span class="hljs-string">&#x27; &#x27;</span> + elf_path<br>	os.system(change_ld_cmd)<br>	li(<span class="hljs-string">&#x27;modify ld ok!&#x27;</span>)<br>	exit(<span class="hljs-number">0</span>)<br><br><span class="hljs-comment">#--------------------------func-----------------------------</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">db</span>():<br>	<span class="hljs-keyword">if</span>(LOCAL):<br>		gdb.attach(io)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">cat_flag</span>(<span class="hljs-params">io</span>):<br>	sleep(<span class="hljs-number">1</span>)<br>	sl(<span class="hljs-string">&#x27;cat flag&#x27;</span>)<br>	flag = <span class="hljs-string">b&#x27;flag&#123;&#x27;</span>  + ru(<span class="hljs-string">&#x27;&#125;&#x27;</span>) + <span class="hljs-string">b&#x27;&#125;&#x27;</span><br>	wd  = flag<br>	wd += <span class="hljs-string">b&#x27;\n&#x27;</span><br>	fd = <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;./flags&#x27;</span>, <span class="hljs-string">&#x27;a&#x27;</span>)<br>	fd.write(wd.decode())<br>	fd.close()<br><br><span class="hljs-comment">#--------------------------exploit--------------------------</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">exploit</span>():<br>	li(<span class="hljs-string">&#x27;exploit...&#x27;</span>)<br>	<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">finish</span>():<br>	ia()<br>	c()<br><br><span class="hljs-comment">#--------------------------main-----------------------------</span><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>	<br>	<span class="hljs-keyword">if</span> LOCAL:<br>		elf = ELF(elf_path)<br>		<span class="hljs-keyword">if</span> LIBC:<br>			libc = ELF(libc_path)<br>			io = elf.process(env = &#123;<span class="hljs-string">&quot;LD_LIBRARY_PATH&quot;</span> : libs_path, <span class="hljs-string">&quot;LD_PRELOAD&quot;</span> : libc_path&#125; )<br>		<span class="hljs-keyword">else</span>:<br>			io = elf.process(env = &#123;<span class="hljs-string">&quot;LD_LIBRARY_PATH&quot;</span> : libs_path&#125; )<br>	<br>	<span class="hljs-keyword">else</span>:<br>		elf = ELF(elf_path)<br>		io = remote(server_ip, server_port)<br>		<span class="hljs-keyword">if</span> LIBC:<br>			libc = ELF(libc_path)<br><br>	exploit()<br>	finish()<br><br></code></pre></td></tr></table></figure>

<p>该脚本攻打成功后, 会在.&#x2F;flags文件中追加获得的flag</p>
<h2 id="AWD-实现批量攻击"><a href="#AWD-实现批量攻击" class="headerlink" title="AWD 实现批量攻击"></a>AWD 实现批量攻击</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/env python3</span><br><span class="hljs-comment">#-*- coding:utf-8 -*-</span><br><span class="hljs-comment"># author: i0gan </span><br><span class="hljs-comment"># script for awd mode</span><br><span class="hljs-comment"># env: pwndocker [skysider/pwndocker (v: 2020/09/09)]</span><br><br><span class="hljs-keyword">import</span> threading<br><span class="hljs-keyword">import</span> sys,os<br><span class="hljs-keyword">import</span> queue<br><br>li = <span class="hljs-keyword">lambda</span> x : <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;\x1b[01;38;5;214m&#x27;</span> + x + <span class="hljs-string">&#x27;\x1b[0m&#x27;</span>)<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Exploit</span>(threading.Thread):<br>	<span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self,ips, ports</span>):<br>		threading.Thread.__init__(self)<br>		self.ips_ = ips<br>		self.ports_ = ports<br>	<span class="hljs-keyword">def</span> <span class="hljs-title function_">run</span>(<span class="hljs-params">self</span>):<br>		<span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>			<span class="hljs-keyword">if</span> self.ips_.empty():<br>				<span class="hljs-keyword">break</span><br>			<span class="hljs-keyword">try</span>:<br>				<span class="hljs-comment"># scrpt for it</span><br>				ip   = self.ips_.get(timeout=<span class="hljs-number">0.5</span>)<br>				port = self.ports_.get(timeout=<span class="hljs-number">0.5</span>)<br>				os.system(<span class="hljs-string">&#x27;python3 ./exp.py&#x27;</span>) <span class="hljs-comment"># run exp</span><br>				li(<span class="hljs-string">&#x27;ip: &#x27;</span> + ip + <span class="hljs-string">&#x27; : &#x27;</span> + <span class="hljs-built_in">str</span>(port))<br>			<span class="hljs-keyword">except</span>:<br>				<span class="hljs-keyword">continue</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">attack</span>():<br>	li(<span class="hljs-string">&#x27;start loop attack...&#x27;</span>)<br>	thread_count = <span class="hljs-number">8</span>  <span class="hljs-comment"># thread number</span><br>	threads = []<br>	ips = queue.Queue()<br>	ports = queue.Queue()<br>	f = <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;./hosts&quot;</span>,<span class="hljs-string">&#x27;r&#x27;</span>) <span class="hljs-comment"># read ip and port from hosts file</span><br>	lines = f.readlines()<br>	f.close()<br><br>	<span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> lines:<br>		get_line = line.strip(<span class="hljs-string">&#x27;\n&#x27;</span>)<br>		info = get_line.split(<span class="hljs-string">&#x27;:&#x27;</span>, <span class="hljs-number">1</span>)<br>		<span class="hljs-comment">#print(info)</span><br>		ips.put(info[<span class="hljs-number">0</span>])<br>		ports.put(<span class="hljs-built_in">int</span>(info[<span class="hljs-number">1</span>], <span class="hljs-number">10</span>))<br> <br>	<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(thread_count):<br>		threads.append(Exploit(ips, ports))<br><br>	<span class="hljs-keyword">for</span> t <span class="hljs-keyword">in</span> threads:<br>		t.start()<br><br>	<span class="hljs-keyword">for</span> t <span class="hljs-keyword">in</span> threads:<br>		t.join()<br> <br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>	attack()<br></code></pre></td></tr></table></figure>

<p>该脚本从.&#x2F;hosts文件中读取ip 和port, 同时攻打</p>
<h2 id="AWD-实现批量提交flag"><a href="#AWD-实现批量提交flag" class="headerlink" title="AWD 实现批量提交flag"></a>AWD 实现批量提交flag</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/env python3</span><br><span class="hljs-comment">#-*- coding:utf-8 -*-</span><br><span class="hljs-comment"># auto submit flag script for fack awd</span><br><br><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> json<br><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> time<br><br>li = <span class="hljs-keyword">lambda</span> x : <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;\x1b[01;38;5;214m&#x27;</span> + x + <span class="hljs-string">&#x27;\x1b[0m&#x27;</span>)<br><br>csrf_token = <span class="hljs-string">&#x27;a9e17a178bfcdf29291c495fd0e3175a138c8ae6555cba89c7c9d0a56dd23293&#x27;</span><br>cookie = <span class="hljs-string">&#x27;session=5dd2b2c8-261f-4337-bce2-3885ab7de331&#x27;</span><br>ip = <span class="hljs-string">&#x27;http://ltalk.co:1024&#x27;</span><br>submit_dir = <span class="hljs-string">&#x27;/api/v1/challenges/attempt&#x27;</span><br>url = ip + submit_dir<br>flag_file = <span class="hljs-string">&#x27;./flags&#x27;</span><br>sleep_time = <span class="hljs-number">120</span><br>challenge_id = <span class="hljs-number">8</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">submit</span>():<br>	<span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(flag_file) <span class="hljs-keyword">as</span> flag_txt:<br>		flags = flag_txt.readlines()<br>		<span class="hljs-keyword">for</span> flag <span class="hljs-keyword">in</span> flags:<br>			flag = flag.strip()<br>			dic = &#123;<span class="hljs-string">&#x27;challenge_id&#x27;</span>: challenge_id,<span class="hljs-string">&#x27;submission&#x27;</span>:flag&#125;<br>			json_flag = json.dumps(dic)<br>			<span class="hljs-built_in">print</span>(json_flag)<br>			<span class="hljs-keyword">try</span>:<br>				header = &#123;<span class="hljs-string">&#x27;Cookie&#x27;</span>:cookie,<span class="hljs-string">&#x27;CSRF-Token&#x27;</span>:csrf_token,<span class="hljs-string">&#x27;Content-Type&#x27;</span>:<span class="hljs-string">&#x27;application/json&#x27;</span>&#125;<br>				res = requests.post(url,data=json_flag,headers=header,timeout=<span class="hljs-number">1</span>)<br>				li(res.text)<br>			<span class="hljs-keyword">except</span>:<br>				li(<span class="hljs-string">&#x27;connect fail!&#x27;</span>)<br>				<span class="hljs-keyword">continue</span><br><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>	submit()<br>	time.sleep(sleep_time)<br><br></code></pre></td></tr></table></figure>

<p>该脚本从.&#x2F;flags文件中读取flag, 依次提交至平台</p>
<div id="paginator"></div></div><div id="post-footer"><div id="pages"><div id="footer-link" style="right: calc(50% - 1px);order: 1;border-right: 1px solid #fe2;padding-left: unset;max-width: calc(50% - 4px);"><a href="/2020/09/13/security/kernel-pwn-env/">← Next kernel pwn环境搭建</a></div><div id="footer-link" style="left: 50%;order: 0;border-left: 1px solid #fe2;padding-right: unset;max-width: calc(50% - 5px);"><a href="/2020/09/12/security/ctf/pwn/pwn-for-beginner/">pwn for beginner Prev →</a></div></div></div><details id="reward"><summary>打赏点小钱</summary><div id="alipay"><span>支付宝 | Alipay</span><br><img src="/img/Alipay.png"></div><div id="wechat"><span>微信 | WeChat</span><br><img src="/img/WeChat.png"></div></details><div id="Valine"></div></div><div id="bottom-btn"><a id="to-index" href="#toc-div" title="index">≡</a><a id="to-top" onClick="scrolls.scrolltop();" title="to top" style="opacity: 0; display: none;">∧</a></div></article><aside><div id="aside-top"><div id="about"><a href="/" id="logo"><img src="https://ak.hypergryph.com/assets/index/images/ak/pc/faction/1.png" alt="Logo"></a><h1 id="Dr"><a target="_blank" rel="noopener" href="https://github.com/i0gan">I0gan</a></h1><div id="description"></div></div><div id="aside-block"><div id="toc-div"><h1>INDEX</h1><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#AWD-PWN"><span class="toc-text">AWD PWN</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#AWD-WAF"><span class="toc-text">AWD WAF</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#AWD-EXP"><span class="toc-text">AWD EXP</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#AWD-%E5%AE%9E%E7%8E%B0%E6%89%B9%E9%87%8F%E6%94%BB%E5%87%BB"><span class="toc-text">AWD 实现批量攻击</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#AWD-%E5%AE%9E%E7%8E%B0%E6%89%B9%E9%87%8F%E6%8F%90%E4%BA%A4flag"><span class="toc-text">AWD 实现批量提交flag</span></a></li></ol></li></ol></div></div></div><footer><nobr><span class="text-title">ICP</span><a class="text-content" target="_blank" rel="noopener" href="https://beian.miit.gov.cn/">沪ICP备2021037250号-1  </a></nobr><nobr><span class="text-title">©</span><span class="text-content">2022 by i0gan</span></nobr><br></footer></aside></main><canvas id="canvas-dust"></canvas><div id="cursor-container"><div id="cursor-outer"></div><div id="cursor-effect"></div></div><script src="/js/search.js"></script><script class="pjax-js">reset=_=>{new Valine({
 el: '#Valine'
 , appId: 'TzNey4n3v0Sx6vdBbytYLoH9-gzGzoHsz'
 , appKey: 'GIXXrK9zLxt0bZLww1hte0Oq' , placeholder: '此条评论委托企鹅物流发送'
});code.findCode();mermaid.init(undefined, ('.mermaid'));}</script><script src="//unpkg.com/@highlightjs/cdn-assets@11.4.0/highlight.min.js"></script><script src="/js/arknights.js"></script><script>window.addEventListener("load",()=>{reset()})</script></body></html>